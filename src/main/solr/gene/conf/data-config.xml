<dataConfig>
	<script type='text/javascript'><![CDATA[
	
		function fetch_human_symbol(row){
			if ( row.get('mouse2human_symbol') ){				
				aList = row.get('mouse2human_symbol').toString().split('___');			
				row.put('human_gene_symbol', aList[1]);  						
				}              
		
	   		return row; 
		}
		function hasQc(row){
			if (row.get('qcGene')){
				row.put('hasQc', 1); 
			}									        		
	   		return row; 
		}
		
    ]]></script>

    <dataSource name="gene2_core" type="HttpDataSource" baseUrl="http://ikmc.vm.bytemark.co.uk:8983/solr/gene2/search?" encoding="UTF-8"  connectionTimeout="10000" readTimeout="10000"/>
	<dataSource name="experiment_core" type="HttpDataSource" baseUrl="http://wwwdev.ebi.ac.uk/mi/impc/dev/solr/experiment/select?" encoding="UTF-8"  connectionTimeout="10000" readTimeout="10000"/>	
 	<dataSource name="human2mouse_symbol_core" type="HttpDataSource" baseUrl="http://ves-ebi-d0.ebi.ac.uk:8090/build_indexes_ci/human2mouse_symbol" encoding="UTF-8"  connectionTimeout="10000" readTimeout="10000"/>
   
	<document name="docs">
		<entity dataSource="gene2_core" name="doc" stream="true" url="q=*:*&amp;fl=MGI,marker_symbol,marker_name,marker_synonym,marker_type,imits_report_phenotyping_complete_date,imits_report_genotype_confirmed_date,imits_report_mi_plan_status,escell,imits_consortium,ikmc_project,latest_project_status,imits_phenotype_started,imits_phenotype_complete,colony_prefix,imits_phenotype_colony_name,imits_phenotype_allele_type,imits_phenotype_status,imits_phenotype_is_active&amp;rows=50000&amp;wt=normal"
			processor="XPathEntityProcessor" forEach="/response/result/doc/" >			

			<field column="mgi_accession_id" xpath="/response/result/doc/str[@name='MGI']" />
	
			<!-- check if this gene has been indexed in experiment core, if yes we could use this field to replace 'not applicable' with 'QC data' for phenotyping status -->
			<entity dataSource="experiment_core" name="qcCheck" stream="true"
				url="q=gene_accession:&quot;${doc.mgi_accession_id}&quot;&amp;wt=normal&amp;fl=gene_accession&amp;rows=1"
				processor="XPathEntityProcessor" forEach="/response/result/doc/" transformer="script:hasQc" >				

				<field column="qcGene" xpath="/response/result/doc/str[@name='gene_accession']" />	
				<field column="hasQc" name="hasQc" />		
			</entity>
		
			<field column="marker_symbol" xpath="/response/result/doc/str[@name='marker_symbol']" />

			<!-- mouse to human gene symbol mapping: multiple human name can be mapped to one mouse symbol -->
			<entity dataSource="human2mouse_symbol_core" name="symbol_mapping" stream="true"
				url="/select?q=${doc.marker_symbol}*&amp;wt=normal&amp;fl=mouse2human_symbol"
				processor="XPathEntityProcessor" forEach="/response/result/doc/"
				transformer="script:fetch_human_symbol">

				<field column="mouse2human_symbol" xpath="/response/result/doc/str[@name='mouse2human_symbol']" />
				<field column="human_gene_symbol" name="human_gene_symbol" />
			</entity>

			<field column="marker_name" xpath="/response/result/doc/arr[@name='marker_name']/str" />
			<field column="marker_synonym" xpath="/response/result/doc/arr[@name='marker_synonym']/str" />
			<field column="marker_type" xpath="/response/result/doc/str[@name='marker_type']" />

			<field column="imits_report_phenotyping_complete_date" xpath="/response/result/doc/arr[@name='imits_report_phenotyping_complete_date']/str" />
			<field column="imits_report_genotype_confirmed_date" xpath="/response/result/doc/arr[@name='imits_report_genotype_confirmed_date']/str" />
			<field column="imits_report_mi_plan_status" xpath="/response/result/doc/arr[@name='imits_report_mi_plan_status']/str" />
			<field column="escell" xpath="/response/result/doc/arr[@name='escell']/str" />
			<field column="ikmc_project" splitBy="," xpath="/response/result/doc/arr[@name='ikmc_project']/str" />
			<field column="imits_consortium" xpath="/response/result/doc/str[@name='imits_consortium']" />
			<field column="status" xpath="/response/result/doc/str[@name='latest_project_status']" />
			<field column="imits_phenotype_started" xpath="/response/result/doc/arr[@name='imits_phenotype_started']/str" />

			<field column="imits_phenotype_complete" xpath="/response/result/doc/arr[@name='imits_phenotype_complete']/str" />
			<field column="colony_prefix" xpath="/response/result/doc/arr[@name='colony_prefix']/str" />
			<field column="imits_phenotype_colony_name" xpath="/response/result/doc/arr[@name='imits_phenotype_colony_name']/str" />
			<field column="imits_phenotype_allele_type" xpath="/response/result/doc/arr[@name='imits_phenotype_allele_type']/str" />
			<field column="imits_phenotype_status" xpath="/response/result/doc/arr[@name='imits_phenotype_status']/str" />
			<field column="imits_phenotype_is_active" xpath="/response/result/doc/arr[@name='imits_phenotype_is_active']/str" />			

		</entity>
	</document>
</dataConfig>