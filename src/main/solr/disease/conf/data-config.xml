  <dataConfig>	
	
	<dataSource name="phenodigmdb" jndiName="java:comp/env/jdbc/phenodigmDataSource" />
	<!--<dataSource name="phenodigm_core" type="HttpDataSource" baseUrl="http://solr-slave-sanger.sanger.ac.uk/solr451/phenodigm/select?" encoding="UTF-8" connectionTimeout="10000" readTimeout="10000"/>-->	
	
	<dataSource name="gene2_core" type="HttpDataSource" baseUrl="http://ikmc.vm.bytemark.co.uk:8983/solr/gene2/select?" encoding="UTF-8"  connectionTimeout="10000" readTimeout="10000"/>	

	<document name="docs">

		<!-- root entity -->
		<!-- around 65,000 diseases -->	
		<!-- test with 	dmga.disease_id='OMIM:607225' -->
		<entity dataSource="phenodigmdb" name="doc" transformer="RegexTransformer" query="select distinct 'disease' as type, ds.disease_id, ds.disease_term, ds.disease_alts, CASE ds.disease_classes when '' THEN 'unclassified' ELSE ds.disease_classes END as disease_classes, ds.human_curated, ds.mouse_curated, ds.mgi_predicted, ds.impc_predicted, ds.mgi_predicted_in_locus, ds.impc_predicted_in_locus, dmga.mgi_gene_id from disease_summary ds, disease_mouse_genotype_associations dmga where ds.disease_id=dmga.disease_id">       			
			
            <field column="type" name="type"/>
            <field column="disease_id" name="disease_id"/>
            <field column="disease_source" regex="([A-Z]+):[0-9]+" sourceColName="disease_id"/>
            <field column="disease_term" name="disease_term"/>
            <field column="disease_alts" splitBy="\|" name="disease_alts"/>
            <field column="disease_classes" splitBy="," name="disease_classes"/>
            <field column="human_curated" name="human_curated"/>
            <field column="mouse_curated" name="mouse_curated"/>
            <field column="mgi_predicted" name="mgi_predicted"/>
            <field column="impc_predicted" name="impc_predicted"/>
            <field column="mgi_predicted_in_locus" name="mgi_predicted_in_locus"/>
            <field column="impc_predicted_in_locus" name="impc_predicted_in_locus"/>

            <entity dataSource="phenodigmdb" name="disease_phenotypes" query="select concat(dh.hp_id, '_' , hp.name) as phenotype from disease_hp dh join hp_term_infos hp on hp.term_id = dh.hp_id where dh.disease_id = '${doc.disease_id}';">
                <field column="phenotype" name="disease_human_phenotypes"/>
            </entity>

 			<field column="mgi_gene_id" name="mgi_accession_id"/>
				
			<!-- genes associated with this disease -->
			 <entity dataSource="gene2_core" name="genedoc" stream="true" url="q=mgi_accession_id:&quot;${doc.mgi_gene_id}&quot;&amp;fl=MGI,marker_symbol,marker_name,marker_synonym,marker_type,imits_report_phenotyping_complete_date,imits_report_genotype_confirmed_date,imits_report_mi_plan_status,escell,imits_consortium,ikmc_project,latest_project_status,imits_phenotype_started,imits_phenotype_complete,colony_prefix,imits_phenotype_colony_name,imits_phenotype_allele_type,imits_phenotype_status,imits_phenotype_is_active&amp;rows=50000&amp;wt=normal"
                processor="XPathEntityProcessor" forEach="/response/result/doc/"		
                readTimeout="10000" connectionTimeout="10000"  >					
                
				<field column="marker_symbol" xpath="/response/result/doc/str[@name='marker_symbol']" />							
				<field column="marker_name" xpath="/response/result/doc/arr[@name='marker_name']/str" />
				<field column="marker_synonym" xpath="/response/result/doc/arr[@name='marker_synonym']/str" />
							
			</entity>					

		</entity>
	</document>
</dataConfig>
