 <dataConfig>   

        <dataSource name="phenodigmdb" jndiName="java:comp/env/jdbc/phenodigmDataSource" />
        <dataSource name="mp_core" type="HttpDataSource" baseUrl="http://ves-ebi-d1.ebi.ac.uk:8090/build-indexes/mp/select?" encoding="UTF-8" connectionTimeout="10000" readTimeout="10000"/>
        <dataSource name="gene2_core" type="HttpDataSource" baseUrl="http://ikmc.vm.bytemark.co.uk:8983/solr/gene2/select?" encoding="UTF-8"  connectionTimeout="10000" readTimeout="10000"/>        
 
 <document name="docs">

        <!-- root entity -->
        <!-- around 65,000 diseases --> 
        <!-- test with  dmga.disease_id='OMIM:607225' -->
        <!--<entity dataSource="phenodigmdb" name="doc" transformer="RegexTransformer" query="select distinct @s:=@s+1 id, 'disease' as type, ds.disease_id, ds.disease_term, ds.disease_alts, CASE ds.disease_classes when '' THEN 'unclassified' ELSE ds.disease_classes END as disease_classes, ds.human_curated, ds.mouse_cu
rated, ds.mgi_predicted, ds.impc_predicted, ds.mgi_predicted_in_locus, ds.impc_predicted_in_locus, dmga.mgi_gene_id from disease_summary ds, disease_mouse_genotype_associations dmga, (SELECT @s:= 0) AS s where ds.disease_id=dmga.disease_id"> -->

      	<entity dataSource="phenodigmdb" name="doc" transformer="RegexTransformer" query="select distinct 'disease' as type, ds.disease_id, ds.disease_term, ds.disease_alts, CASE ds.disease_classes when '' THEN 'unclassified' ELSE ds.disease_classes END as disease_classes, ds.human_curated, ds.mouse_curated, ds.mgi_predicted, ds.impc_predicted, ds.mgi_predicted_in_locus, ds.impc_predicted_in_locus, dmga.mgi_gene_id from disease_summary ds, disease_mouse_genotype_associations dmga where ds.disease_id=dmga.disease_id">
  
            <field column="type" name="dataType"/>                                                      
            <field column="type" name="type"/>
            <field column="disease_id" name="disease_id"/>
            <field column="disease_source" regex="([A-Z]+):[0-9]+" sourceColName="disease_id"/>
            <field column="disease_term" name="disease_term"/>
            <field column="disease_alts" splitBy="\|" name="disease_alts"/>
            <field column="disease_classes" splitBy="," name="disease_classes"/>
            <field column="human_curated" name="human_curated"/>
            <field column="mouse_curated" name="mouse_curated"/>
            <field column="mgi_predicted" name="mgi_predicted"/>
            <field column="impc_predicted" name="impc_predicted"/>
            <field column="mgi_predicted_in_locus" name="mgi_predicted_in_locus"/>
            <field column="impc_predicted_in_locus" name="impc_predicted_in_locus"/>

            <entity dataSource="phenodigmdb" name="disease_phenotypes" query="select concat(dh.hp_id, '_' , hp.name) as phenotype from disease_hp dh join hp_term_infos hp on hp.term_id = dh.hp_id where dh.disease_id = '${doc.disease_id}';">
                <field column="phenotype" name="disease_human_phenotypes"/>
            </entity>

            <field column="mgi_gene_id" name="mgi_accession_id"/>                   
            
            <!-- genes associated with this disease -->
            <entity dataSource="gene2_core" name="genedoc" stream="true" url="q=mgi_accession_id:&quot;${doc.mgi_gene_id}&quot;&amp;fl=MGI,marker_symbol,marker_name,marker_synonym,marker_type,imits_report_phenotyping_complete_date,imits_report_genotype_confirmed_date,imits_report_mi_plan_status,escell,imits_consortium,ikmc_project,latest_project_status,imits_phenotype_started,imits_phenotype_complete,colony_prefix,imits_phenotype_colony_name,imits_phenotype_allele_type,imits_phenotype_status,imits_phenotype_is_active&amp;rows=50000&amp;wt=normal"
    processor="XPathEntityProcessor" forEach="/response/result/doc/"                
    readTimeout="10000" connectionTimeout="10000"  >                                        
    
                    <field column="marker_symbol" xpath="/response/result/doc/str[@name='marker_symbol']" />                                                        
                    <field column="marker_name" xpath="/response/result/doc/arr[@name='marker_name']/str" />
                    <field column="marker_synonym" xpath="/response/result/doc/arr[@name='marker_synonym']/str" />
                    <field column="marker_type" xpath="/response/result/doc/str[@name='marker_type']" />
                    <field column="imits_report_phenotyping_complete_date" xpath="/response/result/doc/arr[@name='imits_report_phenotyping_complete_date']/str" />
                    <field column="imits_report_genotype_confirmed_date" xpath="/response/result/doc/arr[@name='imits_report_genotype_confirmed_date']/str" />
                    <field column="imits_report_mi_plan_status" xpath="/response/result/doc/arr[@name='imits_report_mi_plan_status']/str" />
                    <field column="escell" xpath="/response/result/doc/arr[@name='escell']/str" />
                    <field column="ikmc_project" splitBy="," xpath="/response/result/doc/arr[@name='ikmc_project']/str" />  
                    <field column="imits_consortium" xpath="/response/result/doc/str[@name='imits_consortium']" />                                   
                    <field column="status" xpath="/response/result/doc/str[@name='latest_project_status']" />
                    <field column="imits_phenotype_started" xpath="/response/result/doc/arr[@name='imits_phenotype_started']/str" />
        
                    <field column="imits_phenotype_complete" xpath="/response/result/doc/arr[@name='imits_phenotype_complete']/str" />
                    <field column="colony_prefix" xpath="/response/result/doc/arr[@name='colony_prefix']/str" />
                    <field column="imits_phenotype_colony_name" xpath="/response/result/doc/arr[@name='imits_phenotype_colony_name']/str" />
                    <field column="imits_phenotype_allele_type" xpath="/response/result/doc/arr[@name='imits_phenotype_allele_type']/str" />
                    <field column="imits_phenotype_status" xpath="/response/result/doc/arr[@name='imits_phenotype_status']/str" />
                    <field column="imits_phenotype_is_active" xpath="/response/result/doc/arr[@name='imits_phenotype_is_active']/str" />
            </entity>

            <!-- MP terms associated with this disease -->                  
            <entity dataSource="phenodigmdb" name="disease" transformer="RegexTransformer" query="select distinct mmm.mp_id from disease_mouse_genotype_associations dmga, mp_mouse_models mmm where   dmga.mouse_model_id=mmm.mouse_model_id and dmga.disease_id='${doc.disease_id}' and mmm.mp_id != 'MP:0005395' ">   <!-- skip other phenotype: huge and too vague -->                          
                                        
                <field column="mp_id" name="mp_id"/>

                <entity dataSource="mp_core" name="mpCore" stream="true" url="q=mp_id:&quot;${disease.mp_id}&quot;&amp;wt=normal&amp;rows=99999"
                        processor="XPathEntityProcessor" forEach="/response/result/doc/" onError="continue"                                                     
                        readTimeout="10000" connectionTimeout="10000"  >
                                        
                        <field column="mp_term" xpath="/response/result/doc/str[@name='mp_term']" />
                        <field column="mp_definition" xpath="/response/result/doc/str[@name='mp_definition']" />
                        <field column="mp_term_synonym" xpath="/response/result/doc/arr[@name='mp_term_synonym']/str" />                                                        
                        <field column="ontology_subset" xpath="/response/result/doc/arr[@name='ontology_subset']/str" />
                        <field column="top_level_mp_id" xpath="/response/result/doc/arr[@name='top_level_mp_id']/str" />
                        <field column="top_level_mp_term" xpath="/response/result/doc/arr[@name='top_level_mp_term']/str" />                                                    
                        <field column="top_level_mp_definition" xpath="/response/result/doc/arr[@name='top_level_mp_definition']/str" />
                        
                        <field column="inferred_ma_id" xpath="/response/result/doc/arr[@name='inferred_ma_id']/str" />  
                        <field column="inferred_ma_term" xpath="/response/result/doc/arr[@name='inferred_ma_term']/str" />
                        <field column="inferred_selected_top_level_ma_id" xpath="/response/result/doc/arr[@name='inferred_selected_top_level_ma_id']/str" />
                        <field column="inferred_selected_top_level_ma_term" xpath="/response/result/doc/arr[@name='inferred_selected_top_level_ma_term']/str" />                                      
                </entity>
			</entity>  
  		</entity>
	</document>
	
</dataConfig>