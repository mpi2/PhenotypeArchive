var BAM_MAGIC=21840194,BAI_MAGIC=21578050;function BamFile(){}function Vob(a,b){this.block=a;this.offset=b}Vob.prototype.toString=function(){return""+this.block+":"+this.offset};function Chunk(a,b){this.minv=a;this.maxv=b}
function makeBam(a,b,c){var d=new BamFile;d.data=a;d.bai=b;d.data.slice(0,65536).fetch(function(a){if(!a)return dlog("Couldn't access BAM");a=unbgzf(a);a=new Uint8Array(a);readInt(a,0);for(var b=readInt(a,4),j="",i=0;i<b;++i)j+=String.fromCharCode(a[i+8]);j=readInt(a,b+8);b+=12;d.chrToIndex={};d.indexToChr=[];for(i=0;i<j;++i){for(var l=readInt(a,b),m="",o=0;o<l-1;++o)m+=String.fromCharCode(a[b+4+o]);readInt(a,b+l+4);d.chrToIndex[m]=i;0==m.indexOf("chr")?d.chrToIndex[m.substring(3)]=i:d.chrToIndex["chr"+
m]=i;d.indexToChr.push(m);b=b+8+l}if(d.indices)return c(d)});d.bai.fetch(function(a){if(!a)return dlog("Couldn't access BAI");var b=new Uint8Array(a);if(readInt(b,0)!=BAI_MAGIC)return dlog("Not a BAI file");var j=readInt(b,4);d.indices=[];for(var i=8,l=0;l<j;++l){for(var m=i,o=readInt(b,i),i=i+4,q=0;q<o;++q){readInt(b,i);var r=readInt(b,i+4),i=i+(8+16*r)}q=readInt(b,i);i+=4;i+=8*q;0<o&&(d.indices[l]=new Uint8Array(a,m,i-m))}if(d.chrToIndex)return c(d)})}
BamFile.prototype.blocksForRange=function(a,b,c){var d=this.indices[a];if(!d)return[];for(var a=reg2bins(b,c),e=[],h=0;h<a.length;++h)e[a[h]]=!0;for(var a=[],j=[],h=readInt(d,0),i=4,l=0;l<h;++l){var m=readInt(d,i),o=readInt(d,i+4),i=i+8;if(e[m])for(var q=0;q<o;++q){var r=readVob(d,i),s=readVob(d,i+8);(4681>m?j:a).push(new Chunk(r,s));i+=16}else i+=16*o}h=readInt(d,i);e=null;b=Math.min(b>>14,h-1);c=Math.min(c>>14,h-1);for(h=b;h<=c;++h)if((b=readVob(d,i+4+8*h))&&(!e||b.block<e.block||b.offset<e.offset))e=
b;d=[];if(null!=e)for(h=0;h<j.length;++h)c=j[h],c.maxv.block>=e.block&&c.maxv.offset>=e.offset&&d.push(c);j=d;d=[];for(h=0;h<j.length;++h)d.push(j[h]);for(h=0;h<a.length;++h)d.push(a[h]);d.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});a=[];if(0<d.length){j=d[0];for(h=1;h<d.length;++h)c=d[h],c.minv.block==j.maxv.block?j=new Chunk(j.minv,c.maxv):(a.push(j),j=c);a.push(j)}return a};
BamFile.prototype.fetch=function(a,b,c,d){function e(){if(m>=i.length)return d(l);if(o){var a=new Uint8Array(o);h.readBamRecords(a,i[m].minv.offset,l,b,c,j);o=null;++m;return e()}var r=i[m],a=r.minv.block;h.data.slice(a,r.maxv.block+65536-a).fetch(function(a){o=unbgzf(a,r.maxv.block-r.minv.block+1);return e()})}var h=this,j=this.chrToIndex[a],i;void 0===j?i=[]:(i=this.blocksForRange(j,b,c))||d(null,"Error in index fetch");var l=[],m=0,o;e()};
var SEQRET_DECODER="=ACxGxxxTxxxxxxN".split(""),CIGAR_DECODER="MIDNSHP=X???????".split("");function BamRecord(){}
BamFile.prototype.readBamRecords=function(a,b,c,d,e,h){for(;;){var j=readInt(a,b),j=b+j+4;if(j>=a.length)return c;var i=new BamRecord,l=readInt(a,b+4),m=readInt(a,b+8),o=readInt(a,b+12),q=(o&65280)>>8,r=o&255,s=readInt(a,b+16)&65535,o=readInt(a,b+20);readInt(a,b+24);readInt(a,b+28);readInt(a,b+32);for(var t="",p=0;p<r-1;++p)t+=String.fromCharCode(a[b+36+p]);b=b+36+r;p="";for(r=0;r<s;++r)var u=readInt(a,b),p=p+(u>>4)+CIGAR_DECODER[u&15],b=b+4;i.cigar=p;s="";r=o+1>>1;for(p=0;p<r;++p)u=a[b+p],s+=SEQRET_DECODER[(u&
240)>>4],s+=SEQRET_DECODER[u&15];b+=r;i.seq=s;s="";for(p=0;p<o;++p)s+=String.fromCharCode(a[b+p]);b+=o;i.quals=s;i.pos=m;i.mq=q;i.readName=t;for(i.segment=this.indexToChr[l];b<j;){m=String.fromCharCode(a[b])+String.fromCharCode(a[b+1]);q=String.fromCharCode(a[b+2]);if("A"==q)q=String.fromCharCode(a[b+3]),b+=4;else if("i"==q||"I"==q)q=readInt(a,b+3),b+=7;else if("c"==q||"C"==q)q=a[b+3],b+=4;else if("s"==q||"S"==q)q=readShort(a,b+3),b+=5;else{if("f"==q)throw"FIXME need floats";if("Z"==q){b+=3;for(q=
"";!(t=a[b++],0==t);)q+=String.fromCharCode(t)}else throw"Unknown type "+q;}i[m]=q}if(!d||i.pos<=e&&i.pos+o>=d)(void 0===h||l==h)&&c.push(i);b=j}};function readInt(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function readShort(a,b){return a[b+1]<<8|a[b]}function readVob(a,b){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),d=a[b+1]<<8|a[b];return 0==c&&0==d?null:new Vob(c,d)}
function unbgzf(a,b){for(var b=Math.min(b||1,a.byteLength-100),c=[],d=[0],e=0;d[0]<b;){var h=new Uint8Array(a,d[0],100),h=h[11]<<8|h[10],h=jszlib_inflate_buffer(a,12+h+d[0],Math.min(65536,a.byteLength-12-h-d[0]),d);d[0]+=8;e+=h.byteLength;c.push(h)}if(1==c.length)return c[0];d=new Uint8Array(e);for(h=e=0;h<c.length;++h){var j=new Uint8Array(c[h]);arrayCopy(j,0,d,e,j.length);e+=j.length}return d.buffer}
function reg2bin(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}var MAX_BIN=37449;function reg2bins(a,b){var c,d=[];--b;d.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)d.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)d.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)d.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)d.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)d.push(c);return d}
var BIG_WIG_MAGIC=-2003829722,BIG_BED_MAGIC=-2021002517,BIG_WIG_TYPE_GRAPH=1,BIG_WIG_TYPE_VSTEP=2,BIG_WIG_TYPE_FSTEP=3;function BigWig(){}
BigWig.prototype.readChromTree=function(a){var b=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var c=this.unzoomedDataOffset,c=c+4-(c-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var e=new Uint8Array(c),h=new Int16Array(c),j=new Int32Array(c),i=j[2],l=function(a){for(var c=e[a],d=h[a/2+1],a=a+4,r=0;r<d;++r)if(0==c){var a=a+i,s=j[a/4]<<32|j[a/4+1],a=a+8,s=s-b.chromTreeOffset;l(s)}else{for(var s="",t=0;t<i;++t){var p=e[a++];0!=p&&
(s+=String.fromCharCode(p))}t=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a+0];a+=8;b.chromsToIDs[s]=t;0==s.indexOf("chr")&&(b.chromsToIDs[s.substr(3)]=t);b.idsToChroms[t]=s;b.maxID=Math.max(b.maxID,t)}};l(32);a(b)})};function BigWigView(a,b,c,d){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=c;this.isSummary=d}BED_COLOR_REGEXP=/^[0-9]+,[0-9]+,[0-9]+/;BigWigView.prototype.readWigData=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(void 0===a)return d([]);this.readWigDataById(a,b,c,d)};
BigWigView.prototype.readWigDataById=function(a,b,c,d){var e=this;if(this.cirHeader){var h=[],j=0;Date.now();var i=function(a,b){j+=a.length;for(var c=4+32*e.cirBlockSize,d,h=0;h<a.length;++h){var i=new Range(a[h],a[h]+c);d=d?union(d,i):i}c=d.ranges();for(d=0;d<c.length;++d)l(a,c[d],b)},l=function(d,l,r){l.max();l.min();e.bwg.data.slice(l.min(),l.max()-l.min()).fetch(function(e){for(var t=0;t<d.length;++t)if(l.contains(d[t])){var p=e,u=d[t]-l.min(),v=r,w=new Int8Array(p),x=new Int16Array(p),p=new Int32Array(p),
w=w[u],x=x[u/2+1],u=u+4;if(0!=w)for(w=0;w<x;++w){var A=u/4,E=p[A],y=p[A+1],G=p[A+2],B=p[A+3],F=p[A+4]<<32|p[A+5],v=p[A+6]<<32|p[A+7];(0>a||E<a||E==a&&y<=c)&&(0>a||G>a||G==a&&B>=b)&&h.push({offset:F,size:v});u+=32}else{for(var C=[],w=0;w<x;++w)A=u/4,E=p[A],y=p[A+1],G=p[A+2],B=p[A+3],F=p[A+4]<<32|p[A+5],(0>a||E<a||E==a&&y<=c)&&(0>a||G>a||G==a&&B>=b)&&C.push(F),u+=24;0<C.length&&i(C,v+1)}--j;0==j&&m()}})},m=function(){h.sort(function(a,b){return(a.offset|0)-(b.offset|0)});if(0==h.length)d([]);else{var i=
[],j=function(a,b,c,d){d||(d={});var h=new DASFeature;h._chromId=a;h.segment=e.bwg.idsToChroms[a];h.min=b;h.max=c;h.type="bigwig";for(k in d)h[k]=d[k];i.push(h)},l=function(d,e,h,i){(0>a||d==a)&&(e<=c&&h>=b)&&j(d,e,h,i)},m=function(){if(0==h.length)Date.now(),d(i);else{var t=h[0];if(t.data){var p=new Uint8Array(t.data);if(e.isSummary)for(var u=new Int16Array(t.data),v=new Int32Array(t.data),w=new Float32Array(t.data),p=t.data.byteLength/32,u=0;u<p;++u){var t=v[8*u],x=v[8*u+1],A=v[8*u+2],E=v[8*u+3],
y=w[8*u+5],G=w[8*u+6];if(0>a||t==a)E={type:"bigwig",score:G/E,maxScore:y},"bigbed"==e.bwg.type&&(E.type="density"),l(t,x+1,A,E)}else if("bigwig"==e.bwg.type)if(u=new Int16Array(t.data),v=new Int32Array(t.data),w=new Float32Array(t.data),t=v[0],x=v[1],E=v[3],A=v[4],y=p[20],p=u[11],y==BIG_WIG_TYPE_FSTEP)for(u=0;u<p;++u)y=w[u+6],l(t,x+u*E+1,x+u*E+A,{score:y});else if(y==BIG_WIG_TYPE_VSTEP)for(u=0;u<p;++u)x=v[2*u+6],y=w[2*u+7],l(t,x+1,x+A,{score:y});else if(y==BIG_WIG_TYPE_GRAPH)for(u=0;u<p;++u)x=v[3*
u+6],A=v[3*u+7],y=w[3*u+8],x>A&&(x=A),l(t,x+1,A,{score:y});else dlog("Currently not handling bwgType="+y);else if("bigbed"==e.bwg.type)for(v=0;v<p.length;){t=p[v+3]<<24|p[v+2]<<16|p[v+1]<<8|p[v+0];x=p[v+7]<<24|p[v+6]<<16|p[v+5]<<8|p[v+4];A=p[v+11]<<24|p[v+10]<<16|p[v+9]<<8|p[v+8];v+=12;for(u="";;)if(w=p[v++],0!=w)u+=String.fromCharCode(w);else break;var w={},B=u.split("\t");0<B.length&&(w.label=B[0]);1<B.length&&(w.score=stringToInt(B[1]));2<B.length&&(w.orientation=B[2]);5<B.length&&(u=B[5],BED_COLOR_REGEXP.test(u)&&
(w.override_color="rgb("+u+")"));if(9>B.length||12>e.bwg.definedFieldCount)t==a&&l(t,x+1,A,w);else if(t==a&&x<=c&&A>=b){A=B[3]|0;u=B[4]|0;E=B[6]|0;y=B[7].split(",");G=B[8].split(",");w.type="bb-transcript";var F=new DASGroup;F.id=B[0];F.type="bb-transcript";F.notes=[];w.groups=[F];if(10<B.length){var F=B[9],B=B[10],C=new DASGroup;C.id=F;C.label=B;C.type="gene";w.groups.push(C)}B=null;for(F=0;F<E;++F)C=(G[F]|0)+x,C=new Range(C,C+(y[F]|0)),B=B?union(B,C):C;y=B.ranges();for(x=0;x<y.length;++x)E=y[x],
j(t,E.min()+1,E.max(),w);if(u>A&&(x=intersection(B,new Range(A,u)))){w.type="bb-translation";A=x.ranges();for(x=0;x<A.length;++x)E=A[x],j(t,E.min()+1,E.max(),w)}}}else dlog("Don't know what to do with "+e.bwg.type);h.splice(0,1);m()}else{for(var p=t.offset,I=t.size,t=1;t<h.length&&h[t].offset==p+I;)I+=h[t].size,++t;e.bwg.data.slice(p,I).fetch(function(a){for(var b=0,c=0;b<I;){var d=h[c],i;0<e.bwg.uncompressBufSize?i=jszlib_inflate_buffer(a,b+2,d.size-2):(i=new Uint8Array(d.size),arrayCopy(new Uint8Array(a,
b,d.size),0,i,0,d.size),i=i.buffer);d.data=i;b+=d.size;++c}m()})}}};m()}};i([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(h){e.cirHeader=h;h=new Int32Array(e.cirHeader);e.cirBlockSize=h[1];e.readWigDataById(a,b,c,d)})};BigWigView.prototype.getFirstAdjacent=function(a,b,c,d){a=this.bwg.chromsToIDs[a];if(void 0===a)return d([]);this.getFirstAdjacentById(a,b,c,d)};
BigWigView.prototype.getFirstAdjacentById=function(a,b,c,d){var e=this;if(this.cirHeader){var h=null,j=-1,i=-1,l=0;Date.now();var m=function(a,b){l+=a.length;for(var c=4+32*e.cirBlockSize,d,h=0;h<a.length;++h){var i=new Range(a[h],Math.min(a[h]+c,e.cirTreeOffset+e.cirTreeLength));d=d?union(d,i):i}c=d.ranges();for(d=0;d<c.length;++d)o(a,c[d],b)},o=function(d,o,t){o.max();o.min();e.bwg.data.slice(o.min(),o.max()-o.min()).fetch(function(p){for(var u=0;u<d.length;++u)if(o.contains(d[u])){var v=p,w=d[u]-
o.min(),x=t,A=new Int8Array(v),E=new Int16Array(v),v=new Int32Array(v),A=A[w],E=E[w/2+1],w=w+4;if(0!=A)for(A=0;A<E;++A){var y=w/4,G=v[y],B=v[y+1],F=v[y+2],C=v[y+3],I=v[y+4]<<32|v[y+5],x=v[y+6]<<32|v[y+7];if((0>c&&(G<a||G==a&&B<=b)||0<c&&(F>a||F==a&&C>=b))&&!/_random/.exec(e.bwg.idsToChroms[G]))if(null==h||0>c&&(F>j||F==j&&C>i)||0<c&&(G<j||G==j&&B<i))h={offset:I,size:x},i=0>c?C:B,j=0>c?F:G;w+=32}else{for(var M=-1,D=-1,A=0;A<E;++A){y=w/4;G=v[y];B=v[y+1];F=v[y+2];C=v[y+3];I=v[y+4]<<32|v[y+5];if(0>c&&
(G<a||G==a&&B<=b)&&F>=a||0<c&&(F>a||F==a&&C>=b)&&G<=a)if(0>M||C>D)M=I,D=0>c?C:B;w+=24}0<=M&&m([M],x+1)}--l;0==l&&q()}})},q=function(){if(null==h)return dlog("got nothing");var i=[h];i.sort(function(a,b){return(a.offset|0)-(b.offset|0)});if(0==i.length)d([]);else{var j=null,l=-1,m=-1,o=function(d,h,i,o){if(0>c&&(d<a||i<b)||0<c&&(d>a||h>b)){o||(o={});var q=new DASFeature;q.segment=e.bwg.idsToChroms[d];q.min=h;q.max=i;q.type="bigwig";for(k in o)q[k]=o[k];if(null==j||0>c&&(d>l||i>m)||0<c&&(d<l||h<m))j=
q,m=0>c?i:h,l=d}},q=function(){if(0==i.length)Date.now(),d([j]);else{var a=i[0];if(a.data){var b=new Uint8Array(a.data);if(e.isSummary)for(var c=new Int16Array(a.data),h=new Int32Array(a.data),l=new Float32Array(a.data),b=a.data.byteLength/32,c=0;c<b;++c){var a=h[8*c],m=h[8*c+1],p=h[8*c+2],t={type:"bigwig",score:l[8*c+6]/h[8*c+3]};"bigbed"==e.bwg.type&&(t.type="density");o(a,m+1,p,t)}else if("bigwig"==e.bwg.type){var c=new Int16Array(a.data),h=new Int32Array(a.data),l=new Float32Array(a.data),a=h[0],
m=h[1],t=h[3],p=h[4],C=b[20],b=c[11];if(C==BIG_WIG_TYPE_FSTEP)for(c=0;c<b;++c)C=l[c+6],o(a,m+c*t+1,m+c*t+p,{score:C});else if(C==BIG_WIG_TYPE_VSTEP)for(c=0;c<b;++c)m=h[2*c+6],C=l[2*c+7],o(m+1,m+p,{score:C});else if(C==BIG_WIG_TYPE_GRAPH)for(c=0;c<b;++c)m=h[3*c+6]+1,p=h[3*c+7],C=l[3*c+8],m>p&&(m=p),o(m+1,p,{score:C});else dlog("Currently not handling bwgType="+C)}else if("bigbed"==e.bwg.type)for(h=0;h<b.length;){a=b[h+3]<<24|b[h+2]<<16|b[h+1]<<8|b[h+0];m=b[h+7]<<24|b[h+6]<<16|b[h+5]<<8|b[h+4];p=b[h+
11]<<24|b[h+10]<<16|b[h+9]<<8|b[h+8];h+=12;for(l="";;)if(c=b[h++],0!=c)l+=String.fromCharCode(c);else break;c={};l=l.split("\t");0<l.length&&(c.label=l[0]);1<l.length&&(c.score=100);2<l.length&&(c.orientation=l[2]);o(a,m+1,p,c)}else dlog("Don't know what to do with "+e.bwg.type);i.splice(0,1);q()}else{for(var b=a.offset,I=a.size,a=1;a<i.length&&i[a].offset==b+I;)I+=i[a].size,++a;e.bwg.data.slice(b,I).fetch(function(a){for(var b=0,c=0;b<I;){var d=i[c],h;0<e.bwg.uncompressBufSize?h=jszlib_inflate_buffer(a,
b+2,d.size-2):(h=new Uint8Array(d.size),arrayCopy(new Uint8Array(a,b,d.size),0,h,0,d.size),h=h.buffer);d.data=h;b+=d.size;++c}q()})}}};q()}};m([e.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(b){e.cirHeader=b;b=new Int32Array(e.cirHeader);e.cirBlockSize=b[1];e.readWigDataById(a,min,max,d)})};BigWig.prototype.readWigData=function(a,b,c,d){this.getUnzoomedView().readWigData(a,b,c,d)};
BigWig.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new BigWigView(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};BigWig.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new BigWigView(this,a.indexOffset,4E3,!0));return a.view};function makeBwgFromURL(a,b,c){makeBwg(new URLFetchable(a,{credentials:c}),b,a)}
function makeBwgFromFile(a,b){makeBwg(new BlobFetchable(a),b,"file")}
function makeBwg(a,b,c){var d=new BigWig;d.data=a;d.name=c;d.data.slice(0,512).fetch(function(a){if(!a)return b(null,"Couldn't fetch file");var c=new Int16Array(a),a=new Int32Array(a);a[0]==BIG_WIG_MAGIC?d.type="bigwig":a[0]==BIG_BED_MAGIC?d.type="bigbed":b(null,"Not a supported format");d.version=c[2];d.numZoomLevels=c[3];d.chromTreeOffset=a[2]<<32|a[3];d.unzoomedDataOffset=a[4]<<32|a[5];d.unzoomedIndexOffset=a[6]<<32|a[7];d.fieldCount=c[16];d.definedFieldCount=c[17];d.asOffset=a[9]<<32|a[10];d.totalSummaryOffset=
a[11]<<32|a[12];d.uncompressBufSize=a[13];d.extHeaderOffset=a[14]<<32|a[15];d.zoomLevels=[];for(c=0;c<d.numZoomLevels;++c)d.zoomLevels.push({reduction:a[6*c+16],dataOffset:a[6*c+18]<<32|a[6*c+19],indexOffset:a[6*c+20]<<32|a[6*c+21]});d.readChromTree(function(){return b(d)})})}
BigWig.prototype._tsFetch=function(a,b,c,d,e){var h=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var j=[],i=this.topLevelReductionCache,l=0;l<i.length;++l)i[l]._chromId==b&&j.push(i[l]);return e(j)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(i){h.topLevelReductionCache=i;return h._tsFetch(a,b,c,d,e)})}else return this.getZoomedView(a).readWigDataById(b,c,d,e)};
BigWig.prototype.thresholdSearch=function(a,b,c,d,e){function h(){if(0==i.length)return e(null);i.sort(function(a,b){var d=a.zoom-b.zoom;if(0!=d)return d;d=a.chrOrd-b.chrOrd;return 0!=d?d:a.min-b.min*c});var a=i.splice(0,1)[0];j._tsFetch(a.zoom,a.chr,a.min,a.max,function(j){var l=0<c?0:3E8;a.fromRef&&(l=b);for(var m=0;m<j.length;++m){var t=j[m];if(0<c){if(t.maxScore>d)if(0==a.zoom){if(t.min>l)return e(t)}else t.max>l&&i.push({chr:a.chr,chrOrd:a.chrOrd,zoom:Math.max(0,a.zoom-2),min:t.min,max:t.max,
fromRef:a.fromRef})}else if(t.maxScore>d)if(0==a.zoom){if(t.max<l)return e(t)}else t.min<l&&i.push({chr:a.chr,chrOrd:a.chrOrd,zoom:Math.max(0,a.zoom-2),min:t.min,max:t.max,fromRef:a.fromRef})}h()})}for(var c=0>c?-1:1,j=this,a=this.chromsToIDs[a],i=[{chrOrd:0,chr:a,zoom:j.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],l=1;l<=this.maxID+1;++l){var m=(a+c*l)%(this.maxID+1);0>m&&(m+=this.maxID+1);i.push({chrOrd:l,chr:m,zoom:j.zoomLevels.length-1,min:0,max:3E8})}h()};
BigWig.prototype.getExtraIndices=function(a){thisB=this;if(4>this.version||0==this.extHeaderOffset)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(b){if(!b)return a(null,"Couldn't fetch extension header");var c=new Int16Array(b),b=new Int32Array(b),d=c[1],b=b[1]<<32|b[2];console.log("extHeaderSize = "+c[0]);console.log("extraIndexCount = "+d);console.log("extraIndexListOffset = "+b);thisB.data.slice(b,20*d).fetch(function(b){if(!b)return a(null,"Couldn't fetch index info");
for(var c=new Int16Array(b),b=new Int32Array(b),j=[],i=0;i<d;++i)j.push({type:c[10*i],fieldCount:c[10*i+1],offset:b[5*i+1]<<32|b[5*i+2],field:c[10*i+8]});a(j)})})};function BlobFetchable(a){this.blob=a}BlobFetchable.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new BlobFetchable(c)};
BlobFetchable.prototype.fetch=function(a){var b=new FileReader;b.onloadend=function(){a(bstringToBuffer(b.result))};b.readAsBinaryString(this.blob)};function URLFetchable(a,b,c,d){d||("object"===typeof b?(d=b,b=void 0):d={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=d}URLFetchable.prototype.slice=function(a,b){var c=this.start,d=this.end,c=c&&a?c+a:a||c;return new URLFetchable(this.url,c,b&&c?c+b-1:d||b-1,this.opts)};var seed=0,isIOS=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");
URLFetchable.prototype.fetch=function(a,b,c){var d=this,b=b||1;if(3<b)return a(null);var e=new XMLHttpRequest,h,j=this.url;isIOS&&(j=j+"?salt="+ ++seed);e.open("GET",j,!0);e.overrideMimeType("text/plain; charset=x-user-defined");this.end&&(e.setRequestHeader("Range","bytes="+this.start+"-"+this.end),h=this.end-this.start+1);e.responseType="arraybuffer";e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200||e.status==206){if(e.response){var i=e.response.byteLength;return h&&h!=i&&(!c||
i!=c)?d.fetch(a,b+1,i):a(e.response)}if(e.mozResponseArrayBuffer)return a(e.mozResponseArrayBuffer);i=e.responseText;return h&&h!=i.length&&(!c||i.length!=c)?d.fetch(a,b+1,i.length):a(bstringToBuffer(e.responseText))}return d.fetch(a,b+1)}};this.opts.credentials&&(e.withCredentials=!0);e.send("")};function bstringToBuffer(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}
var NS_SVG="http://www.w3.org/2000/svg",NS_HTML="http://www.w3.org/1999/xhtml",NS_XLINK="http://www.w3.org/1999/xlink";function Region(a,b,c){this.min=b;this.max=c;this.chr=a}
function Browser(a){a||(a={});this.uiPrefix="http://www.biodalliance.org/release-0.10/";this.sources=[];this.tiers=[];this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.karyoEndpoint=new DASSource("http://www.derkholm.net:8080/das/hsa_54_36p/");this.registry="http://www.dasregistry.org/das/sources";this.coordSystem={speciesName:"Human",taxon:9606,auth:"NCBI",
version:"36",ucscName:"hg18"};this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.zoomMin=10;this.zoomMax;this.origin=0;this.targetQuantRes=5;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.autoSizeTiers=!1;this.guidelineStyle="foreground";this.guidelineSpacing=75;this.fgGuide=null;this.positionFeedback=!1;this.selectedTiers=[1];this.placards=[];
this.maxViewWidth=5E5;this.reverseScrolling=!1;this.rulerLocation="center";this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=30;this.browserLinks={Ensembl:"http://ncbi36.ensembl.org/Homo_sapiens/Location/View?r=${chr}:${start}-${end}",UCSC:"http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg18&position=chr${chr}:${start}-${end}"};this.availableSources=new Observed;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new SourceCache;for(var b in a)this[b]=
a[b];var c=this;window.addEventListener("load",function(){c.realInit()},!1)}
Browser.prototype.realInit=function(){this.supportsBinary=!0;this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(var a=0;a<this.sources.length;++a)this.defaultSources.push(this.sources[a]);this.restoreStatus&&this.restoreStatus();var b=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolder=makeElement("div",null,{tabIndex:-1},{outline:"none",display:"inline-block",width:"100%"});removeChildren(this.browserHolderHolder);
this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=makeElement("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.tierHolder=makeElement("div",null,{className:"tier-holder"});this.svgHolder.appendChild(this.tierHolder);this.bhtmlRoot=makeElement("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(makeElement("span",["Powered by ",makeElement("a","Dalliance",{href:"http://www.biodalliance.org/"})," "+VERSION],{className:"powered-by"}));
this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(){b.resizeViewer()},!1);this.ruler=makeElement("div",null,{className:"guideline"});this.svgHolder.appendChild(this.ruler);setTimeout(function(){b.realInit2()},1)};
Browser.prototype.realInit2=function(){var a=this;this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolder.addEventListener("mousewheel",function(b){if(b.wheelDeltaX){b.stopPropagation();b.preventDefault();b=b.wheelDeltaX/5;a.reverseScrolling||
(b=-b);a.move(b)}},!1);this.tierHolder.addEventListener("MozMousePixelScroll",function(b){if(b.axis==1){b.stopPropagation();b.preventDefault();if(b.detail!=0){b=b.detail/4;a.reverseScrolling&&(b=-b);a.move(b)}}},!1);var b=function(b){if(b.keyCode==13){for(var c=false,b=0;b<a.tiers.length;++b){var d=a.tiers[b];if(d.wantedLayoutHeight&&d.wantedLayoutHeight!=d.layoutHeight){d.layoutHeight=d.wantedLayoutHeight;d.placard=null;d.clipTier();c=true}}c&&a.arrangeTiers()}else if(b.keyCode==32||b.charCode==
32){if(a.isSnapZooming){a.isSnapZooming=false;c=a.savedZoom||10}else{a.isSnapZooming=true;c=a.savedZoom||1}a.savedZoom=a.zoomSliderValue;a.zoomSliderValue=c;a.zoom(Math.exp(1*c/a.zoomExpt));a.snapZoomLockout=true;b.stopPropagation();b.preventDefault()}else if(b.keyCode==39){b.stopPropagation();b.preventDefault();if(b.ctrlKey){var e=0;b.shiftKey&&(e=1);var m=(a.viewStart+a.viewEnd+1)/2|0,b=a.getSelectedTier();b<0||a.tiers[b].findNextFeature(a.chr,m,-1,e,function(b){if(b){var c=b.min,d=b.max;if(e)if(d<
m-1){d++;c=d}else d=c;var h=a.viewEnd-a.viewStart+1;parseFloat(h/2)==parseInt(h/2)&&h--;c=(c+d-h)/2+1;a.setLocation(b.segment,c,c+h-1)}else alert("no next feature")})}else a.move(b.shiftKey?100:25)}else if(b.keyCode==37){b.stopPropagation();b.preventDefault();if(b.ctrlKey){e=0;b.shiftKey&&(e=1);m=(a.viewStart+a.viewEnd+1)/2|0;b=a.getSelectedTier();b<0||a.tiers[b].findNextFeature(a.chr,m,1,e,function(b){if(b){var c=b.min,d=b.max;if(e)if(c>m+1)d=c;else{d++;c=d}var h=a.viewEnd-a.viewStart+1;parseFloat(h/
2)==parseInt(h/2)&&h--;c=(c+d-h)/2+1;a.setLocation(b.segment,c,c+h-1)}else alert("no next feature")})}else a.move(b.shiftKey?-100:-25)}else if(b.keyCode==38||b.keyCode==87){b.stopPropagation();b.preventDefault();if(b.shiftKey){b=a.getSelectedTier();if(!(b<0)){c=a.tiers[b];b=c.forceHeight||c.subtiers[0].height;if(b>=40){c.forceHeight=b-10;c.draw()}}}else if(b.ctrlKey){b=a.getSelectedTier();if(!(b<0)){c=a.tiers[b];if(c.quantLeapThreshold){var d=c.subtiers[0].height,o=c.subtiers[0].quant;if(o){b=1*o.min;
o=1*o.max;d=(o-b)/d;c.quantLeapThreshold=b+((Math.round((c.quantLeapThreshold-b)/d)|0)+1)*d;c.draw()}}}}else{b=a.getSelectedTier();b>0?a.setSelectedTier(b-1):a.notifyTierSelectionWrap(-1)}}else if(b.keyCode==40||b.keyCode==83){b.stopPropagation();b.preventDefault();if(b.shiftKey){b=a.getSelectedTier();if(!(b<0)){c=a.tiers[b];b=c.forceHeight||c.subtiers[0].height;c.forceHeight=b+10;c.draw()}}else if(b.ctrlKey){b=a.getSelectedTier();if(!(b<0)){c=a.tiers[b];if(c.quantLeapThreshold){d=c.subtiers[0].height;
if(o=c.subtiers[0].quant){b=1*o.min;o=1*o.max;d=(o-b)/d;o=Math.round((c.quantLeapThreshold-b)/d)|0;if(o>1){c.quantLeapThreshold=b+(o-1)*d;c.draw()}}}}}else{b=a.getSelectedTier();b<a.tiers.length-1&&a.setSelectedTier(b+1)}}else if(b.keyCode==187||b.keyCode==61){b.stopPropagation();b.preventDefault();a.zoomStep(-10)}else if(b.keyCode==189||b.keyCode==173){b.stopPropagation();b.preventDefault();a.zoomStep(10)}else if(b.keyCode==73||b.keyCode==105){b.stopPropagation();b.preventDefault();b=a.getSelectedTier();
if(!(b<0)){d=a.tiers[b];if(d.infoVisible){d.infoElement.style.display="none";d.updateHeight();d.infoVisible=false}else{d.infoElement.style.display="block";d.updateHeight();d.infoVisible=true}}}else if(b.keyCode==84||b.keyCode==116)if(b.shiftKey){b.stopPropagation();b.preventDefault();for(b=0;b<a.tiers.length;++b){d=a.tiers[b];if(d.dasSource.collapseSuperGroups){c===void 0&&(c=!d.bumped);d.bumped=c;d.layoutWasDone=false;d.draw();d.updateLabel()}}}else{if(!b.ctrlKey&&!b.metaKey){b.stopPropagation();
b.preventDefault();b=a.getSelectedTier();if(!(b<0)){d=a.tiers[b];if(d.dasSource.collapseSuperGroups){c===void 0&&(c=!d.bumped);d.bumped=c;d.layoutWasDone=false;d.draw();d.updateLabel()}}}}else if(b.keyCode==77||b.keyCode==109){b.stopPropagation();b.preventDefault();a.selectedTiers.length>1&&a.mergeSelectedTiers()}};this.browserHolder.addEventListener("focus",function(){a.browserHolder.addEventListener("keydown",b,false)},!1);this.browserHolder.addEventListener("blur",function(){a.browserHolder.removeEventListener("keydown",
b,false)},!1);this.hPopupHolder=makeElement("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var c=0;c<this.sources.length;++c){var d=this.sources[c];d.bwgURI&&!this.supportsBinary?this.binaryWarningGiven||(this.popit({clientX:300,clientY:100},"Warning",makeElement("p","your browser does not support binary data formats, some track(s) not loaded.  We currently recommend Google Chrome 9 or later, or Firefox 4 or later.")),
this.binaryWarningGiven=!0):this.makeTier(d)}a.arrangeTiers();a.refresh();a.setSelectedTier(1);a.positionRuler();for(d=0;d<this.tiers.length;++d)if(c=this.tiers[d],c.sequenceSource){c.sequenceSource.getSeqInfo(this.chr,function(b){if(b)a.currentSeqMax=b.length});break}this.queryRegistry();for(var e in this.chains)this.queryRegistry(e,!0);if(this.hubs)for(c=0;c<this.hubs.length;++c)connectTrackHub(this.hubs[c],function(b,c){c?console.log(c):a.hubObjects.push(b)})};
Browser.prototype.touchStartHandler=function(a){a.stopPropagation();a.preventDefault();this.touchOriginX=a.touches[0].pageX;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};
Browser.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var b=a.touches[0].pageX;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginX=b}else if(this.zooming&&2==a.touches.length){b=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){var a=(a.touches[0].pageX+a.touches[1].pageX)/2,c=this.viewStart+a/this.scale|0;this.scale=this.zoomInitialScale*(b/this.zoomInitialSep);this.viewStart=c-a/this.scale|
0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};Browser.prototype.touchEndHandler=function(a){a.stopPropagation();a.preventDefault()};Browser.prototype.touchCancelHandler=function(){};Browser.prototype.makeTier=function(a){try{this.realMakeTier(a)}catch(b){console.log(b.stack)}};
Browser.prototype.realMakeTier=function(a){var b=this,c=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length],d=makeElement("canvas",null,{width:""+((this.featurePanelWidth|0)+2E3),height:"50",className:"viewport"}),e=makeElement("canvas",null,{width:+((this.featurePanelWidth|0)+2E3),height:"50",className:"viewport-overlay"}),h=makeElement("span",""),j=makeElement("div",[makeElement("i",null,{className:"icon-warning-sign"})," ",h],{className:"placard"}),i=makeElement("div",
[d,e],{className:"view-holder"});i.style.background=c;i.addEventListener("touchstart",function(a){return b.touchStartHandler(a)},!1);i.addEventListener("touchmove",function(a){return b.touchMoveHandler(a)},!1);i.addEventListener("touchend",function(a){return b.touchEndHandler(a)},!1);i.addEventListener("touchcancel",function(a){return b.touchCancelHandler(a)},!1);var l=new DasTier(this,a,d,i,e,j,h);l.oorigin=this.viewStart;l.background=c;l.quantOverlay=makeElement("canvas",null,{width:"50",height:"56",
className:"quant-overlay"});l.holder.appendChild(l.quantOverlay);var m=!1,o,q,r,s=function(a,c){var d=l.subtiers;if(d){for(var e=0,c=c-MIN_PADDING;e<d.length&&c>d[e].height&&e<d.length-1;)c=c-d[e].height-MIN_PADDING,++e;if(!(e>=d.length))return d=d[e].glyphs,a-=(l.glyphCacheOrigin-b.viewStart)*b.scale,glyphLookup(d,a)}},t=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;"sequence"!==l.dasSource.tier_type&&a!=q&&(b.move(a-q),q=a);b.isDragging=!0},p=function(){window.removeEventListener("mousemove",
t,!0);window.removeEventListener("mouseup",p,!0)};i.addEventListener("mousedown",function(a){b.browserHolder.focus();a.preventDefault();i.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",t,!0);window.addEventListener("mouseup",p,!0);o=q=a;b.isDragging=!1},!1);i.addEventListener("mousemove",function(a){var c=i.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top;r&&clearTimeout(r);m||(r=setTimeout(function(){var c=s(d,e);c&&0<c.length&&b.notifyFeatureHover(a,c[c.length-
1],c,l)},1E3))});var u=null;i.addEventListener("mouseup",function(a){var c=i.getBoundingClientRect(),d=a.clientX-c.left,c=a.clientY-c.top,e=s(d,c);e&&(0<e.length&&!b.isDragging)&&(u?(clearTimeout(u),u=null,b.featureDoubleClick(e,d,c)):u=setTimeout(function(){u=null;b.notifyFeature(a,e[e.length-1],e,l)},500));if(b.isDragging&&d!=o&&"sequence"===l.dasSource.tier_type){var c=b.viewStart+d/b.scale,h=b.viewStart+o/b.scale;c<h?(d=c|0,c=h|0):(d=h|0,c|=0);b.notifyRegionSelect(b.chr,d,c)}b.isDragging=!1},
!1);i.addEventListener("mouseout",function(){m=!1});l.removeButton=makeElement("i",null,{className:"icon-remove"});l.bumpButton=makeElement("i",null,{className:"icon-plus-sign"});l.loaderButton=makeElement("img",null,{src:this.uiPrefix+"img/loader.gif"},{display:"none"});l.infoElement=makeElement("div",l.dasSource.desc,{},{display:"none",maxWidth:"200px",whiteSpace:"normal",color:"rgb(100,100,100)"});l.nameButton=makeElement("a",[],{className:"tier-tab"});l.nameButton.appendChild(l.removeButton);
a.pennant&&l.nameButton.appendChild(makeElement("img",null,{src:a.pennant,width:"16",height:"16"}));l.nameButton.appendChild(makeElement("span",[a.name,l.infoElement],{},{display:"inline-block",marginLeft:"5px",marginRight:"5px"}));l.nameButton.appendChild(l.bumpButton);l.nameButton.appendChild(l.loaderButton);l.label=makeElement("span",[l.nameButton],{className:"btn-group"},{zIndex:1001,position:"absolute",left:"2px",top:"2px",opacity:0.8,display:"inline-block"});c=makeElement("div",[i,j,l.label],
{},{position:"relative",display:"block"});l.row=c;l.removeButton.addEventListener("click",function(c){c.stopPropagation();c.preventDefault();b.removeTier(a)},!1);l.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){for(var a=-1,c=0;c<b.tiers.length;++c)if(b.tiers[c]===l){a=c;break}0<=a&&(c=b.selectedTiers.indexOf(a),0<=c?b.selectedTiers.splice(c,1):(b.selectedTiers.push(a),b.selectedTiers.sort()),b.markSelectedTiers(),0<b.selectedTiers.length?b.browserHolder.focus():
b.notifyTierSelectionWrap(-1))}else{for(c=0;c<b.tiers.length;++c)if(b.tiers[c]===l&&(b.browserHolder.focus(),1!=b.selectedTiers.length||b.selectedTiers[0]!=c)){b.setSelectedTier(c);return}l.infoVisible?(l.infoElement.style.display="none",l.updateHeight(),l.infoVisible=!1):(l.infoElement.style.display="block",l.updateHeight(),l.infoVisible=!0)}},!1);l.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var b;l.dasSource.collapseSuperGroups&&(void 0===b&&(b=!l.bumped),
l.bumped=b,l.layoutWasDone=!1,l.draw(),l.updateLabel())},!1);var v,w,x,A=!1,E=function(a){var c=l.label;a.stopPropagation();a.preventDefault();if(!v){v=c.cloneNode(!0);v.style.cursor="pointer";b.svgHolder.appendChild(v);c.style.visibility="hidden";for(var d=0;d<b.tiers.length;++d)if(b.tiers[d]===l){w=d;break}x=a.clientY}d=b.svgHolder.getBoundingClientRect();v.style.left=c.getBoundingClientRect().left-d.left+"px";v.style.top=a.clientY-d.top-10+"px";c=a.clientY-b.tierHolder.getBoundingClientRect().top;
for(d=0;d<b.tiers.length;++d){var e=b.tiers[d].row.getBoundingClientRect(),c=c-(e.bottom-e.top);if(0>c){if(d<w&&a.clientY<x||d>w&&a.clientY>x){c=[];for(e=0;e<b.selectedTiers.length;++e)c.push(b.tiers[b.selectedTiers[e]]);b.tiers.splice(w,1);b.tiers.splice(d,0,l);e=b.sources[w];b.sources.splice(w,1);b.sources.splice(d,0,e);b.selectedTiers=[];for(e=0;e<b.tiers.length;++e)0<=c.indexOf(b.tiers[e])&&b.selectedTiers.push(e);w=d;x=a.clientY;removeChildren(b.tierHolder);for(a=0;a<b.tiers.length;++a)b.tierHolder.appendChild(b.tiers[a].row);
b.tierHolder.appendChild(b.ruler);A=!0;b.arrangeTiers()}break}}},y=function(a){var c=l.label;a.stopPropagation();a.preventDefault();v&&(v.style.cursor="auto",b.svgHolder.removeChild(v),v=null,c.style.visibility=null);document.removeEventListener("mousemove",E,!1);document.removeEventListener("mouseup",y,!1);if(A){for(a=0;a<b.tiers.length;++a)if(b.tiers[a]==l){b.setSelectedTier(a);break}b.notifyTier()}};l.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();A=!1;document.addEventListener("mousemove",
E,!1);document.addEventListener("mouseup",y,!1)},!1);this.tierHolder.appendChild(c);this.tiers.push(l);l.init();l.currentlyHeight=50;this.updateHeight();l.updateLabel();l.featureSource&&l.featureSource.addActivityListener&&l.featureSource.addActivityListener(function(a){l.loaderButton.style.display=0<a?"inline-block":"none"})};Browser.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};
Browser.prototype.arrangeTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a];b.background=this.tierBackgroundColors[a%this.tierBackgroundColors.length];b.holder.style.background=b.background}};
Browser.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,c=(this.viewStart+this.viewEnd)/2,d=c-this.origin;this.origin=c;this.scaleAtLastRedraw=this.scale;for(c=0;c<this.tiers.length;++c){var e=d;this.tiers[c].originHaxx&&(e+=this.tiers[c].originHaxx);this.tiers[c].originHaxx=e}d=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);e=Math.max(1,(this.viewStart|
0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){for(var h=null,j=0;j<this.tiers.length;++j)if(this.tiers[j].sequenceSource){h=this.tiers[j].sequenceSource;break}this.knownSpace=new KnownSpace(this.tiers,this.chr,e,b,d,h)}(h=this.knownSpace.bestCacheOverlapping(this.chr,c,a))&&h.min<=c&&h.max>=a?(this.drawnStart=Math.max(h.min,e),this.drawnEnd=Math.min(h.max,b)):(this.drawnStart=e,this.drawnEnd=b);this.knownSpace.viewFeatures(this.chr,
this.drawnStart,this.drawnEnd,d);this.drawOverlays()};function setSources(a,b,c){if(c)for(var d=0;d<b.length;++d)b[d].mapping=c;a.set(b)}
Browser.prototype.queryRegistry=function(a,b){var c,d;a?(c=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new Observed),d=this.mappableSources[a]):(c=this.coordSystem,d=this.availableSources);var e=hex_sha1(miniJSONify(c));if(b){var h=localStorage["dalliance.registry."+e+".last_queried"];if(h)try{if(setSources(d,JSON.parse(localStorage["dalliance.registry."+e+".sources"]),a),432E5>(Date.now()|0)-(h|0))return}catch(j){console.log("Bad registry cache: "+j)}}(new DASRegistry(this.registry)).sources(function(b){for(var h=
[],j=0;j<b.length;++j){var o=b[j];if(o.coords&&o.coords.length!=0){var q=o.coords[0];q.taxon!=c.taxon||(q.auth!=c.auth||q.version!=c.version)||h.push(o)}}localStorage["dalliance.registry."+e+".sources"]=JSON.stringify(h);localStorage["dalliance.registry."+e+".last_queried"]=""+Date.now();setSources(d,h,a)},function(){},c)};
Browser.prototype.move=function(a){var b=this.viewEnd-this.viewStart;this.viewStart-=a/this.scale;this.viewEnd=this.viewStart+b;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b);1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b);this.notifyLocation();for(a=0;a<this.tiers.length;++a)this.tiers[a].viewport.style.left=""+((-((this.viewStart-this.tiers[a].norigin)*this.scale)|0)-1E3)+"px",this.tiers[a].overlay.style.left=
""+((-((this.viewStart-this.tiers[a].oorigin)*this.scale)|0)-1E3)+"px";this.spaceCheck()};Browser.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue,a=b+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=b&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};
Browser.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-
this.viewStart);this.refresh()};Browser.prototype.spaceCheck=function(){if(!this.knownSpace||this.knownSpace.chr!==this.chr)this.refresh();else{var a=100/this.scale|0;((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()}};
Browser.prototype.resizeViewer=function(a){var b=this.featurePanelWidth;this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;b!=this.featurePanelWidth&&(this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,b=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.positionRuler(),a||this.spaceCheck(),
this.notifyLocation())};Browser.prototype.addTier=function(a){this.sources.push(a);this.makeTier(a);this.positionRuler();this.notifyTier()};function sourceDataURI(a){return a.uri?a.uri:a.bwgBlob?"file:"+a.bwgBlob.name:a.bamBlob?"file:"+a.bamBlob.name:a.bwgURI||a.bamURI||a.jbURI||a.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function sourceStyleURI(a){return a.stylesheet_uri?a.stylesheet_uri:"sequence"==a.tier_type?"http://www.biodalliance.org/magic/sequence":sourceDataURI(a)}
function sourcesAreEqual(a,b){if(sourceDataURI(a)!=sourceDataURI(b)||sourceStyleURI(a)!=sourceStyleURI(b))return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var c=0;c<a.overlay.length;++c)if(!sourcesAreEqual(a.overlay[c],b.overlay[c]))return!1}else if(b.overlay)return!1;return!0}
Browser.prototype.removeTier=function(a){var b=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)b=a.index;else for(var c=0;c<this.tiers.length;++c)if(sourcesAreEqual(a,this.tiers[c].dasSource)){b=c;break}if(0>b)throw"Couldn't find requested tier";this.tierHolder.removeChild(this.tiers[b].row);this.tiers.splice(b,1);this.sources.splice(b,1);a=[];for(c=0;c<this.selectedTiers.length;++c){var d=this.selectedTiers[c];d<b?a.push(d):d>b&&a.push(d-1)}this.selectedTiers=a;this.markSelectedTiers();
this.arrangeTiers();this.notifyTier()};
Browser.prototype.setLocation=function(a,b,c,d){d||(d=function(a){if(a)throw a;});var e=this;if(!a||a==this.chr)return this._setLocation(null,b,c,null,d);for(var h,j=0;j<this.tiers.length;++j)if(this.tiers[j].sequenceSource){h=this.tiers[j].sequenceSource;break}if(!h)return d("Need a sequence source");h.getSeqInfo(a,function(i){if(i)return e._setLocation(a,b,c,i,d);var j;j=0==a.indexOf("chr")?a.substr(3):"chr"+a;h.getSeqInfo(j,function(h){return h?e._setLocation(j,b,c,h,d):d("Couldn't find sequence '"+
a+"'")})})};
Browser.prototype._setLocation=function(a,b,c,d,e){a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr=a,this.currentSeqMax=d.length);b|=0;c|=0;a=Math.max(10,c-b+1);1>b&&(b=1,c=b+a-1);c>this.currentSeqMax&&(c=this.currentSeqMax,b=Math.max(1,c-a+1));this.viewStart=b;this.viewEnd=c;b=this.featurePanelWidth/(this.viewEnd-this.viewStart);c=1.0E-4<Math.abs(b-this.scale);this.scale=b;this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.isSnapZooming=!1;this.savedZoom=
null;this.notifyLocation();if(c)this.refresh();else for(b=0;b<this.tiers.length;++b)this.tiers[b].viewport.style.left=""+((-((this.viewStart-this.tiers[b].norigin)*this.scale)|0)-1E3)+"px",this.tiers[b].overlay.style.left=""+((-((this.viewStart-this.tiers[b].oorigin)*this.scale)|0)-1E3)+"px";this.spaceCheck();return e()};Browser.prototype.addFeatureListener=function(a){this.featureListeners.push(a)};
Browser.prototype.notifyFeature=function(a,b,c,d){for(var e=0;e<this.featureListeners.length;++e)try{this.featureListeners[e](a,b,c,d)}catch(h){console.log(h.stack)}};Browser.prototype.addFeatureHoverListener=function(a){this.featureHoverListeners.push(a)};Browser.prototype.notifyFeatureHover=function(a,b,c,d){for(var e=0;e<this.featureHoverListeners.length;++e)try{this.featureHoverListeners[e](a,b,c,d)}catch(h){console.log(h.stack)}};Browser.prototype.addViewListener=function(a){this.viewListeners.push(a)};
Browser.prototype.notifyLocation=function(){for(var a=0;a<this.viewListeners.length;++a)try{this.viewListeners[a](this.chr,this.viewStart|0,this.viewEnd|0,this.zoomSliderValue,{current:this.zoomSliderValue,min:this.zoomMin,max:this.zoomMax})}catch(b){console.log(b.stack)}};Browser.prototype.addTierListener=function(a){this.tierListeners.push(a)};Browser.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(b){console.log(b.stack)}};
Browser.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};Browser.prototype.notifyRegionSelect=function(a,b,c){for(var d=0;d<this.regionSelectListeners.length;++d)try{this.regionSelectListeners[d](a,b,c)}catch(e){console.log(e.stack)}};Browser.prototype.highlightRegion=function(a,b,c){this.highlights.push(new Region(a,b,c));var d=this.viewStart-1E3/this.scale,e=this.viewEnd+1E3/this.scale;a==this.chr&&(b<e&&c>d)&&this.drawOverlays()};
Browser.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};Browser.prototype.featuresInRegion=function(a,b,c){var d=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var e=this.tiers[a].currentFeatures||[],h=0;h<e.length;++h){var j=e[h];j.min<=c&&j.max>=b&&d.push(j)}return d};Browser.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};
Browser.prototype.setSelectedTier=function(a){this.selectedTiers=[a];this.markSelectedTiers()};Browser.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?b.classList.add("active"):b.classList.remove("active")}0<this.selectedTiers.length&&this.browserHolder.focus()};Browser.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};
Browser.prototype.notifyTierSelectionWrap=function(a){for(var b=0;b<this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(c){console.log(c.stack)}};
Browser.prototype.positionRuler=function(){var a="none",b="",c="";"center"==this.rulerLocation?(a="block",b=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",b="0px"):"right"==this.rulerLocation?(a="block",c="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=b;this.ruler.style.right=c;for(var d=0;d<this.tiers.length;++d){var e=this.tiers[d].quantOverlay;e&&(e.style.display=a,e.style.left=b,e.style.right=c)}};
Browser.prototype.featureDoubleClick=function(a,b){if(a&&0!=a.length&&(f=a[a.length-1],f.min&&f.max)){var c=((f.min|0)-(this.viewStart|0))*this.scale,d=(f.max-f.min+1)*this.scale,e=((f.min|0)+(f.max|0))/2;10<d&&(c=1*(b-c)/d,0.3>c?e=f.min|0:0.7<c&&(e=(f.max|0)+1));c=this.viewEnd-this.viewStart;this.setLocation(null,e-c/2,e+c/2)}};Browser.prototype.updateHeight=function(){for(var a=0,b=0;b<this.tiers.length;++b)a+=this.tiers[b].currentHeight||30;this.svgHolder.style.maxHeight=""+Math.max(a,500)+"px"};
function glyphLookup(a,b,c){for(var c=c||[],d=0;d<a.length;++d){var e=a[d];if(!e.notSelectable&&e.min()<=b&&e.max()>=b){e.feature?c.push(e.feature):e.group&&c.push(e.group);if(e.glyphs)return glyphLookup(e.glyphs,b,c);if(e.glyph)return glyphLookup([e.glyph],b,c);break}}return c}var TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;Browser.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
function FeatureInfo(a,b,c){var d=pick(c.type,b.type),e=pick(b.label,c.label,c.id,b.id);e&&0!=e.indexOf("__dazzle")&&(d=d+": "+e);this.hit=a;this.feature=b;this.group=c;this.title=d;this.sections=[]}FeatureInfo.prototype.setTitle=function(a){this.title=a};FeatureInfo.prototype.add=function(a,b){"string"===typeof b&&(b=makeElement("span",b));this.sections.push({label:a,info:b})};
Browser.prototype.featurePopup=function(a,b,c,d){var b=c.length,e=0<=--b?c[b]:{},h=0<=--b?c[b]:{},c=new FeatureInfo(c,e,h),b=this.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(j){console.log(j.stack||j)}b=d.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(i){console.log(i.stack||i)}this.removeAllPopups();d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";b=0;if(e.method){var l=
makeElement("tr",[makeElement("th","Method"),makeElement("td",e.method)]);d.appendChild(l);++b}l=h.segment?h:e;l=makeElement("tr",[makeElement("th","Location"),makeElement("td",l.segment+":"+l.min+"-"+l.max)]);l.style.backgroundColor=this.tierBackgroundColors[b%this.tierBackgroundColors.length];d.appendChild(l);++b;void 0!==e.score&&(null!==e.score&&"-"!=e.score)&&(l=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+e.score)]),d.appendChild(l),++b);if((l=maybeConcat(h.links,e.links))&&
0<l.length)l=makeElement("tr",[makeElement("th","Links"),makeElement("td",l.map(function(a){return makeElement("div",makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(l),++b;e=maybeConcat(h.notes,e.notes);for(h=0;h<e.length;++h){var l="Note",m=e[h],o=m.match(TAGVAL_NOTE_RE);o&&(l=o[1],m=o[2]);l=makeElement("tr",[makeElement("th",l),makeElement("td",m)]);d.appendChild(l);++b}for(b=0;b<c.sections.length;++b)e=c.sections[b],d.appendChild(makeElement("tr",[makeElement("th",e.label),
makeElement("td",e.info)]));this.popit(a,c.title,d,{width:400})};function Chainset(a,b,c,d){this.uri=a;this.srcTag=b;this.destTag=c;this.coords=d;this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={}}function parseCigar(a){for(var b=[],c=RegExp("([0-9]*)([MID])","g"),d;null!=(d=c.exec(a));){var e=d[1];0==e.length&&(e=1);b.push({cnt:e|0,op:d[2]})}return b}
Chainset.prototype.fetchChainsTo=function(a){var b=this;(new DASSource(this.uri)).alignments(a,{},function(c){b.chainsByDest[a]||(b.chainsByDest[a]=[]);for(var d=0;d<c.length;++d)for(var e=c[d],h=0;h<e.blocks.length;++h){for(var j=e.blocks[h],i,l,m=0;m<j.segments.length;++m){var o=j.segments[m],q=e.objects[o.object];q.dbSource===b.srcTag?i=o:q.dbSource===b.destTag&&(l=o)}if(i&&l){for(var j={srcChr:e.objects[i.object].accession,srcMin:i.min|0,srcMax:i.max|0,srcOri:i.strand,destChr:e.objects[l.object].accession,
destMin:l.min|0,destMax:l.max|0,destOri:l.strand,blocks:[]},m=parseCigar(i.cigar),o=parseCigar(l.cigar),r=q=0,s=0,t=0;s<m.length&&t<o.length;)if("M"==m[s].op&&"M"==o[t].op){var p=Math.min(m[s].cnt,o[t].cnt);j.blocks.push([q,r,p]);m[s].cnt==p?++s:m[s].cnt-=p;o[t].cnt==p?++t:o[t]-=p;q+=p;r+=p}else"I"==m[s].op?r+=m[s++].cnt:"I"==o[t].op&&(q+=o[t++].cnt);pusho(b.chainsBySrc,j.srcChr,j);pusho(b.chainsByDest,j.destChr,j)}}if(b.postFetchQueues[a]){c=b.postFetchQueues[a];for(d=0;d<c.length;++d)c[d]();b.postFetchQueues[a]=
null}})};Chainset.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.srcMin&&b<=e.srcMax){var h;h="-"==e.srcOri?e.srcMax-b:b-e.srcMin;for(var j=e.blocks,i=0;i<j.length;++i){var l=j[i],m=l[0],o=l[1],l=l[2];if(h>=m&&h<=m+l)return c=h-m,{seq:e.destChr,pos:"-"==e.destOri?e.destMax-o-c:c+o+e.destMin,flipped:e.srcOri!=e.destOri}}}}return null};
Chainset.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],d=0;d<c.length;++d){var e=c[d];if(b>=e.destMin&&b<=e.destMax){for(var d="-"==e.srcOri?e.destMax-b:b-e.destMin,h=e.blocks,j=0;j<h.length;++j){var i=h[j],c=i[0],l=i[1],i=i[2];if(d>=l&&d<=l+i)return d-=l,h=d+c+e.srcMin,h="-"==e.destOri?e.srcMax-c-d:d+c+e.srcMin,{seq:e.srcChr,pos:h,flipped:e.srcOri!=e.destOri}}break}}return null};
Chainset.prototype.sourceBlocksForRange=function(a,b,c,d){if(this.chainsByDest[a]){var e=this.unmapPoint(a,b),h=this.unmapPoint(a,c);!e||!h||e.seq!=h.seq?d([]):d([new DASSegment(e.seq,e.pos,h.pos)])}else{var e=!this.postFetchQueues[a],j=this;pusho(this.postFetchQueues,a,function(){j.sourceBlocksForRange(a,b,c,d)});e&&this.fetchChainsTo(a)}};function DColour(a,b,c,d){this.red=a|0;this.green=b|0;this.blue=c|0;d&&(this.name=d)}
DColour.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};var palette={red:new DColour(255,0,0,"red"),green:new DColour(0,255,0,"green"),blue:new DColour(0,0,255,"blue"),yellow:new DColour(255,255,0,"yellow"),white:new DColour(255,255,255,"white"),black:new DColour(0,0,0,"black")},COLOR_RE=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,CSS_COLOR_RE=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;
function dasColourForName(a){var b=palette[a];b||((b=COLOR_RE.exec(a))?b=new DColour("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(b=CSS_COLOR_RE.exec(a))?b=new DColour(b[1]|0,b[2]|0,b[3]|0,a):(console.log("couldn't handle color: "+a),b=palette.black),palette[a]=b);return b}
function makeGradient(a,b,c,d){var e=[],b=dasColourForName(b),c=dasColourForName(c);if(d)for(var d=dasColourForName(d),h=0;h<a;++h){var j=1*h/(a-1),i,l;0.5>j?(i=b,l=c,j*=2):(i=c,l=d,j=2*j-1);i=(new DColour(i.red*(1-j)+l.red*j|0,i.green*(1-j)+l.green*j|0,i.blue*(1-j)+l.blue*j|0)).toSvgString();e.push(i)}else for(h=0;h<a;++h)j=1*h/(a-1),i=(new DColour(b.red*(1-j)+c.red*j|0,b.green*(1-j)+c.green*j|0,b.blue*(1-j)+c.blue*j|0)).toSvgString(),e.push(i);return e}
var dasLibErrorHandler=function(a){alert(a)},dasLibRequestQueue=[];function DASSegment(a,b,c,d){this.name=a;this.start=b;this.end=c;this.description=d}DASSegment.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};DASSegment.prototype.isBounded=function(){return this.start&&this.end};DASSegment.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};
function DASSource(a,b){var c;"string"==typeof a?(this.uri=a,c=b||{}):c=a||{};for(var d in c)"function"!=typeof c[d]&&(this[d]=c[d]);this.coords||(this.coords=[]);this.props||(this.props={});if((this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1))this.dasBaseURI+="/"}function DASCoords(){}function coordsMatch(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}
DASSource.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);for(var c=[],b=b.getElementsByTagName("SEGMENT"),d=0;d<b.length;++d){var e=b[d],h=e.getAttribute("id"),j=e.getAttribute("size"),i;j?(i=1,j|=0):((i=e.getAttribute("start"))&&(i|=0),(j=e.getAttribute("stop"))&&(j|=0));var l=null;e.firstChild&&(l=e.firstChild.nodeValue);c.push(new DASSegment(h,i,j,l))}a(c)})};
function DASSequence(a,b,c,d,e){this.name=a;this.start=b;this.end=c;this.alphabet=d;this.seq=e}
DASSource.prototype.sequence=function(a,b){this.doCrossDomainRequest(this.dasBaseURI+"sequence?"+a.toDASQuery(),function(a){if(a){for(var d=[],a=a.getElementsByTagName("SEQUENCE"),e=0;e<a.length;++e){var h=a[e],j=h.getAttribute("id"),i=h.getAttribute("start"),l=h.getAttribute("stop"),m=null;if(h.firstChild)for(var h=h.firstChild.nodeValue,m="",o=0;;){var q=h.indexOf("\n",o);if(0<=q)m+=h.substring(o,q),o=q+1;else{m+=h.substring(o);break}}d.push(new DASSequence(j,i,l,"DNA",m))}b(d)}else b([])})};
function DASFeature(){}function DASGroup(){}function DASLink(a,b){this.desc=a;this.uri=b}
DASSource.prototype.features=function(a,b,c){var b=b||{},d;if(this.features_uri)d=this.features_uri;else{var e=[];if(a)e.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)e.push("group_id="+a);else for(var h=0;h<a.length;++h)e.push("group_id="+a[h]);if(b.adjacent){a=b.adjacent;"string"==typeof a&&(a=[a]);for(h=0;h<a.length;++h)e.push("adjacent="+a[h])}if(b.type)if("string"==typeof b.type)e.push("type="+b.type);else for(a=0;a<b.type.length;++a)e.push("type="+b.type[a]);b.maxbins&&
e.push("maxbins="+b.maxbins);0<e.length?d=this.dasBaseURI+"features?"+e.join(";"):c([],"No filters specified")}this.doCrossDomainRequest(d,function(a,b){if(a){for(var d=[],e={},h=a.getElementsByTagName("SEGMENT"),q=0;q<h.length;++q){var r=h[q],s=r.getAttribute("id");e[s]={min:r.getAttribute("start"),max:r.getAttribute("stop")};for(var r=r.getElementsByTagName("FEATURE"),t=0;t<r.length;++t){var p=r[t],u=new DASFeature;u.segment=s;u.id=p.getAttribute("id");u.label=p.getAttribute("label");var v=elementValue(p,
"START"),w=elementValue(p,"END");(v|0)>(w|0)?(u.min=w|0,u.max=v|0):(u.min=v|0,u.max=w|0);v=p.getElementsByTagName("TYPE");0<v.length&&(v=v[0],v.firstChild&&(u.type=v.firstChild.nodeValue),u.typeId=v.getAttribute("id"),u.typeCv=v.getAttribute("cvId"));u.type=elementValue(p,"TYPE");!u.type&&u.typeId&&(u.type=u.typeId);u.method=elementValue(p,"METHOD");(v=elementValue(p,"ORIENTATION"))||(v="0");u.orientation=v;u.score=elementValue(p,"SCORE");u.links=dasLinksOf(p);u.notes=dasNotesOf(p);v=p.getElementsByTagName("GROUP");
for(w=0;w<v.length;++w){var x=v[w],A=new DASGroup;A.type=x.getAttribute("type");A.id=x.getAttribute("id");A.links=dasLinksOf(x);A.notes=dasNotesOf(x);u.groups?u.groups.push(A):u.groups=Array(A)}if(u.notes)for(v=0;v<u.notes.length;++v)w=u.notes[v],0==w.indexOf("Genename=")&&(x=new DASGroup,x.type="gene",x.id=w.substring(9),u.groups?u.groups.push(x):u.groups=Array(x));v=p.getElementsByTagName("PART");if(0<v.length){x=[];for(w=0;w<v.length;++w)x.push(v[w].getAttribute("id"));u.parts=x}v=p.getElementsByTagName("PARENT");
if(0<v.length){p=[];for(w=0;w<v.length;++w)p.push(v[w].getAttribute("id"));u.parents=p}d.push(u)}}c(d,void 0,e)}else c([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){c([],a)})};function DASAlignment(a){this.type=a;this.objects={};this.blocks=[]}
DASSource.prototype.alignments=function(a,b,c){var d=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(d,function(a){if(a){for(var b=[],a=a.getElementsByTagName("alignment"),j=0;j<a.length;++j){for(var i=a[j],l=new DASAlignment(i.getAttribute("alignType")),m=i.getElementsByTagName("alignObject"),o=0;o<m.length;++o){var q=m[o],q={id:q.getAttribute("intObjectId"),accession:q.getAttribute("dbAccessionId"),version:q.getAttribute("objectVersion"),dbSource:q.getAttribute("dbSource"),dbVersion:q.getAttribute("dbVersion")};
l.objects[q.id]=q}i=i.getElementsByTagName("block");for(m=0;m<i.length;++m){for(var q=i[m],o={order:q.getAttribute("blockOrder"),segments:[]},q=q.getElementsByTagName("segment"),r=0;r<q.length;++r){var s=q[r],s={object:s.getAttribute("intObjectId"),min:s.getAttribute("start"),max:s.getAttribute("end"),strand:s.getAttribute("strand"),cigar:elementValue(s,"cigar")};o.segments.push(s)}l.blocks.push(o)}b.push(l)}c(b)}else c([],"Failed request "+d)})};function DASStylesheet(){this.styles=[]}
DASStylesheet.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=shallowCopy(a);b&&(a.zoom=b);a.style=c;this.styles.push(a)};function DASStyle(){}
DASSource.prototype.stylesheet=function(a,b){var c,d=this.credentials;this.stylesheet_uri?(c=this.stylesheet_uri,d=!1):c=this.dasBaseURI+"stylesheet";doCrossDomainRequest(c,function(c){if(c){for(var d=new DASStylesheet,c=c.getElementsByTagName("TYPE"),j=0;j<c.length;++j){var i=c[j],l={};l.type=i.getAttribute("id");l.label=i.getAttribute("label");l.method=i.getAttribute("method");for(var i=i.getElementsByTagName("GLYPH"),m=0;m<i.length;++m){var o=i[m],q=o.getAttribute("zoom"),r=childElementOf(o),o=
new DASStyle;o.glyph=r.localName;for(r=r.firstChild;r;){if(r.nodeType==Node.ELEMENT_NODE)o[r.localName]=r.firstChild.nodeValue;r=r.nextSibling}d.pushStyle(l,q,o)}}a(d)}else b&&b()},d)};function DASRegistry(a,b){b=b||{};this.uri=a;this.opts=b}
DASRegistry.prototype.sources=function(a,b,c){c||(c={});var d=[];c.taxon&&d.push("organism="+c.taxon);c.auth&&d.push("authority="+c.auth);c.version&&d.push("version="+c.version);c=this.uri;0<d.length&&(c=c+"?"+d.join("&"));doCrossDomainRequest(c,function(c){if(!c&&b)b();else{for(var d=[],c=c.getElementsByTagName("SOURCE"),j=0;j<c.length;++j){var i=c[j],l=i.getElementsByTagName("VERSION");if(!(1>l.length)){for(var m=l[0],o=m.getElementsByTagName("COORDINATES"),l=[],q=0;q<o.length;++q){var r=o[q],s=
new DASCoords;s.auth=r.getAttribute("authority");s.taxon=r.getAttribute("taxid");s.version=r.getAttribute("version");l.push(s)}for(var o=[],r=m.getElementsByTagName("CAPABILITY"),t,q=0;q<r.length;++q)s=r[q],o.push(s.getAttribute("type")),"das1:features"==s.getAttribute("type")&&(t=s.getAttribute("query_uri"),t=t.substring(0,t.length-8));q={};m=m.getElementsByTagName("PROP");for(r=0;r<m.length;++r)pusho(q,m[r].getAttribute("name"),m[r].getAttribute("value"));t&&(i=new DASSource(t,{source_uri:i.getAttribute("uri"),
name:i.getAttribute("title"),desc:i.getAttribute("description"),coords:l,props:q,capabilities:o}),d.push(i))}}a(d)}})};function elementValue(a,b){var c=a.getElementsByTagName(b);return 0<c.length&&c[0].firstChild?c[0].firstChild.nodeValue:null}function childElementOf(a){if(a.hasChildNodes()){a=a.firstChild;do{if(a.nodeType==Node.ELEMENT_NODE)return a;a=a.nextSibling}while(null!=a)}return null}
function dasLinksOf(a){for(var b=[],c=a.getElementsByTagName("LINK"),d=0;d<c.length;++d){var e=c[d];e.parentNode==a&&b.push(new DASLink(e.firstChild?e.firstChild.nodeValue:"Unknown",e.getAttribute("href")))}return b}function dasNotesOf(a){for(var b=[],a=a.getElementsByTagName("NOTE"),c=0;c<a.length;++c)a[c].firstChild&&b.push(a[c].firstChild.nodeValue);return b}
function doCrossDomainRequest(a,b,c,d){if(window.XDomainRequest){var e=new XDomainRequest;e.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(e.responseText);b(a)};e.open("get",a)}else Date.now(),e=new XMLHttpRequest,e.onreadystatechange=function(){4==e.readyState&&(200<=e.status||0==e.status)&&b(e.responseXML,e)},e.open("get",a,!0),c&&(e.withCredentials=!0),d&&e.setRequestHeader("X-DAS-Authorisation",d),e.setRequestHeader("Accept","application/xml,*/*");e.send("")}
DASSource.prototype.doCrossDomainRequest=function(a,b,c){var d;this.xUser&&(d="Basic "+btoa(this.xUser+":"+this.xPass));try{return doCrossDomainRequest(a,b,this.credentials,d)}catch(e){if(c)c(e);else throw e;}};Browser.prototype.removeAllPopups=function(){removeChildren(this.hPopupHolder);removeChildren(this.popupHolder)};
Browser.prototype.makeTooltip=function(a,b){var c=!1,d=this,e=null,h;h=function(){c=!1;e&&(clearTimeout(e),e=null);a.removeEventListener("mouseout",h,!1)};var j;j=function(h){var l=h.clientX+window.scrollX,m=h.clientY+window.scrollY;e||(e=setTimeout(function(){var h=makeElement("div",[makeElement("div",null,{className:"tooltip-arrow"}),makeElement("div",b,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(m+20)+"px",left:""+Math.max(l-30,20)+"px"});d.hPopupHolder.appendChild(h);
var i;i=function(b){try{d.hPopupHolder.removeChild(h)}catch(e){}window.removeEventListener("mousemove",i,!1);c&&null!=a.offsetParent&&j(b)};window.addEventListener("mousemove",i,!1);e=null},1E3))};a.addEventListener("mouseover",function(b){c=!0;a.addEventListener("mouseout",h,!1);j(b)},!1);a.addEventListener("DOMNodeRemovedFromDocument",function(){c=!1;e&&(clearTimeout(e),e=null)},!1)};
Browser.prototype.popit=function(a,b,c,d){var e=this;d||(d={});a||(a={});var h=d.width||200,j;a.clientX?(d=a.clientX,j=a.clientY):(d=500,j=50);d+=document.documentElement.scrollLeft||document.body.scrollLeft;j+=document.documentElement.scrollTop||document.body.scrollTop;var i=window.innerWidth,l=j+20,m=Math.min(d-h/2,i-h-30),o=makeElement("div");o.className="popover fade "+(a.clientX?"bottom ":"")+"in";o.style.display="block";o.style.position="absolute";o.style.top=""+l+"px";o.style.left=""+m+"px";
o.style.width=h+"px";276<h&&(o.style.maxWidth=h+"px");o.appendChild(makeElement("div",null,{className:"arrow"}));if(b){var q=makeElement("button","",{className:"close"});q.innerHTML="&times;";q.addEventListener("mouseover",function(){q.style.color="red"},!1);q.addEventListener("mouseout",function(){q.style.color="black"},!1);q.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();e.removeAllPopups()},!1);var a=makeElement("h4",[makeElement("span",b,null,{maxWidth:"200px"}),q],
{},{paddingLeft:"10px",paddingRight:"10px"}),r,s,t,p;t=function(a){a.stopPropagation();a.preventDefault();m=m+(a.clientX-r);m<8&&(m=8);m>i-h-32&&(m=i-h-26);l=l+(a.clientY-s);l=Math.max(10,l);o.style.top=""+l+"px";o.style.left=""+Math.min(m,i-h-10)+"px";r=a.clientX;s=a.clientY};p=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",t,false);window.removeEventListener("mouseup",p,false)};a.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();
r=a.clientX;s=a.clientY;window.addEventListener("mousemove",t,false);window.addEventListener("mouseup",p,false)},!1);o.appendChild(a)}o.appendChild(makeElement("div",c,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(o);var u={node:o,displayed:!0};o.addEventListener("DOMNodeRemoved",function(a){if(a.target==o)u.displayed=false},!1);return u};
function makeTreeTableSection(a,b,c){function d(){c?(e.className="icon-chevron-down",b.style.display="table"):(e.className="icon-chevron-right",b.style.display="none")}var e=makeElement("i");d();e.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c=!c;d()},!1);a=makeElement("h6",[e," ",a],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return makeElement("div",[a,b],{})}function dlog(a){console.log(a)}
var MIN_PADDING=3,DEFAULT_SUBTIER_MAX=25;function isDasBooleanTrue(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function SubTier(){this.glyphs=[];this.height=0;this.quant=null}SubTier.prototype.add=function(a){this.glyphs.push(a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};SubTier.prototype.hasSpaceFor=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];if(c.min()<=a.max()&&c.max()>=a.min())return!1}return!0};var GLOBAL_GC;
function drawFeatureTier(a){GLOBAL_GC=a.viewport.getContext("2d");sortFeatures(a);var b=[],c;for(c in a.ungroupedFeatures){var d=a.ungroupedFeatures[c],e=a.styleForFeature(d[0]);if(e)if("LINEPLOT"==e.glyph)b.push(makeLineGlyph(d,e,a));else for(var h=0;h<d.length;++h)if(e=d[h],!e.parts){var j=glyphForFeature(e,0,a.styleForFeature(e),a);j&&b.push(j)}}if(a.dasSource.collapseSuperGroups&&!a.bumped)for(var i in a.superGroups){c=a.superGroups[i];a.groups[i].type=a.groups[c[0]].type;d={};for(j=0;j<c.length;++j){for(var l=
a.groupedFeatures[c[j]],h=0;h<l.length;++h)e=l[h],pusho(d,e.type,e);if(a.groups[i]&&!a.groups[i].links||0==a.groups[i].links.length)a.groups[i].links=a.groups[c[0]].links;delete a.groupedFeatures[c[j]]}for(var m in d){for(var l=d[m],o=l[0],q=null,h=0;h<l.length;++h)e=l[h],e=new Range(e.min,e.max),q=q?union(q,e):e;for(var q=q.ranges(),r=0;r<q.length;++r){for(var s=q[r],t=((s.max()|0)-(s.min()|0)+1)*c.length,p=0,h=0;h<l.length;++h)if(e=l[h],(e.min|0)<=s.max()&&(e.max|0)>=s.min())var u=Math.max(e.min|
0,s.min()),e=Math.min(e.max|0,s.max()),p=p+(e-u+1);e=new DASFeature;for(k in o)e[k]=o[k];e.min=s.min();e.max=s.max();e.label&&1<c.length&&(e.label+=" ("+c.length+" vars)");e.visualWeight=1*p/t;pusho(a.groupedFeatures,i,e)}}delete a.superGroups[i]}c=[];for(var v in a.groupedFeatures)c.push(v);c.sort(function(b,c){var d=a.groupedFeatures[b][0].score-a.groupedFeatures[c][0].score;return 0<d?-1:0==d?0:1});m={};for(e=0;e<c.length;++e)if(v=c[e],j=glyphsForGroup(a.groupedFeatures[v],0,a.groups[v],a,a.dasSource.collapseSuperGroups&&
!a.bumped?"collapsed_gene":"tent"))j.group=a.groups[v],m[v]=j;for(i in a.superGroups){c=a.superGroups[i];v=[];e=1E10;d=-1E10;for(h=0;h<c.length;++h)l=m[c[h]],m[c[h]]=null,l&&(v.push(l),e=Math.min(e,l.min()),d=Math.max(d,l.max()));for(h=0;h<v.length;++h)l=v[h],b.push(new PaddedGlyph(l,e,d))}for(j in m)(l=m[j])&&b.push(l);i=new SubTier;v=[];c=a.dasSource.subtierMax||DEFAULT_SUBTIER_MAX;m=0;a:for(;m<b.length;++m)if(j=b[m],j.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(e=0;e<v.length;++e)if(d=
v[e],d.hasSpaceFor(j)){d.add(j);continue a}v.length>=c?a.status="Too many overlapping features, truncating at "+c:(d=new SubTier,d.add(j),v.push(d))}else i.add(j);0<i.glyphs.length&&(v=[i].concat(v));for(e=0;e<v.length;++e)d=v[e],d.quant&&d.glyphs.unshift(new GridGlyph(d.height));for(e=0;e<v.length;++e)d=v[e],d.glyphs.sort(function(a,b){return(a.zindex||0)-(b.zindex||0)});a.subtiers=v;a.glyphCacheOrigin=a.browser.viewStart}
function formatQuantLabel(a){var a=""+a,b=a.indexOf(".");if(0>b)return a;var c=2;"-"==a.substring(0,1)&&++c;return b>=c?a.substring(0,b):a.substring(0,b+2)}
DasTier.prototype.paint=function(){var a=this.subtiers;if(a){var b=this.viewport.width|0;b<this.browser.featurePanelWidth+1950&&(this.viewport.width=b=(this.browser.featurePanelWidth|0)+2E3);for(var c=MIN_PADDING,d=0;d<a.length;++d)c=c+a[d].height+MIN_PADDING;c+=6;this.viewport.setAttribute("height",c);this.viewport.style.left="-1000px";this.holder.style.height=""+Math.max(c,this.browser.minTierHeight)+"px";this.updateHeight();this.drawOverlay();this.norigin=this.browser.viewStart;var e=this.viewport.getContext("2d");
e.fillStyle=this.background;e.clearRect(0,0,b,Math.max(c,200));e.restore();e.save();c=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;e.translate(c,MIN_PADDING);for(d=0;d<a.length;++d){for(var h=null,j=a[d].glyphs,i=0;i<j.length;++i){var l=j[i];l.min()<b-c&&l.max()>-c&&(l=j[i],l.draw(e),l.quant&&(h=l.quant))}e.translate(0,a[d].height+MIN_PADDING)}e.restore();h&&(this.quantLeapThreshold&&this.featureSource&&sourceAdapterIsCapable(this.featureSource,"quantLeap"))&&(a=3+a[0].height*
(1-(this.quantLeapThreshold-h.min)/(h.max-h.min)),e.save(),e.strokeStyle="red",e.lineWidth=0.3,e.moveTo(0,a),e.lineTo(5E3,a),e.stroke(),e.restore());this.paintQuant()}};
DasTier.prototype.paintQuant=function(){var a;this.subtiers&&0<this.subtiers.length&&(a=this.subtiers[0].quant);if(a&&this.quantOverlay){var b=this.subtiers[0].height,c=this.quantOverlay.width;this.quantOverlay.height=this.viewport.height;var d=this.quantOverlay.getContext("2d");d.fillStyle="white";d.globalAlpha=0.6;"right"==this.browser.rulerLocation?(d.fillRect(c-30,0,30,20),d.fillRect(c-30,b-20+2*MIN_PADDING,30,20)):(d.fillRect(0,0,30,20),d.fillRect(0,b-20+2*MIN_PADDING,30,20));d.globalAlpha=1;
d.strokeStyle="black";d.lineWidth=1;d.beginPath();"right"==this.browser.rulerLocation?(d.moveTo(c-8,MIN_PADDING),d.lineTo(c,MIN_PADDING),d.lineTo(c,b+MIN_PADDING),d.lineTo(c-8,b+MIN_PADDING)):(d.moveTo(8,MIN_PADDING),d.lineTo(0,MIN_PADDING),d.lineTo(0,b+MIN_PADDING),d.lineTo(8,b+MIN_PADDING));d.stroke();d.fillStyle="black";"right"==this.browser.rulerLocation?(d.textAlign="right",d.fillText(formatQuantLabel(a.max),c-8,10),d.fillText(formatQuantLabel(a.min),c-8,b+MIN_PADDING-2)):(d.textAlign="left",
d.fillText(formatQuantLabel(a.max),8,10),d.fillText(formatQuantLabel(a.min),8,b+MIN_PADDING-2))}};
function glyphsForGroup(a,b,c,d){for(var e=d.styleForFeature(c),h,j=[],b=null,i=0;i<a.length;++i){var l=a[i];l.orientation&&null==b&&(b=l.orientation);!h&&l.label&&(h=l.label);var m=d.styleForFeature(l);m&&!l.parts&&(l=glyphForFeature(l,0,m,d,null,!0))&&j.push(l)}if(0==j.length)return null;a="flat";d.dasSource.collapseSuperGroups&&!d.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-");d=null;if(h||e&&(e.LABEL||e.LABELS))d=c.label||h;c=new GroupGlyph(j,a);d&&
("+"===b?d=">"+d:"-"===b&&(d="<"+d),c=new LabelledGlyph(c,d));c.bump=!0;return c}
function glyphForFeature(a,b,c,d,e,h){var j=d.browser.scale,i=d.browser.viewStart,l=c.glyph||"BOX",m=a.min,o=a.max,q=a.orientation,r=a.score,s=a.label,t=(m-i)*j,p=Math.max((o-i+1)*j,t+1),i=d.forceHeight||c.HEIGHT||e||12,u=i*=1,j=c.BUMP&&isDasBooleanTrue(c.BUMP),v;if("CROSS"===l||"EX"===l||"TRIANGLE"===l||"DOT"===l||"SQUARE"===l||"STAR"===l){if(m=c.FGCOLOR||"black",u=c.BGCOLOR||"none",i=d.forceHeight||c.HEIGHT||e||12,o=c.SIZE||i,u=1*i,o*=1,i=(t+p)/2,t=o/2,"EX"===l?p=new ExGlyph(i,o,m):"TRIANGLE"===
l?p=new TriangleGlyph(i,o,c.DIRECTION||"N",c.LINEWIDTH||o,m):"DOT"===l?p=new DotGlyph(i,o,m):"SQUARE"===l?p=new BoxGlyph(i-t,0,o,o,m,null):"STAR"===l?(p=5,c.POINTS&&(p=c.POINTS|0),p=new StarGlyph(i,t,p,m,null)):p=new CrossGlyph(i,o,m),isDasBooleanTrue(c.SCATTER))m=d.dasSource.forceMin||c.MIN||d.currentFeaturesMinScore,(o=d.dasSource.forceMax||c.MAX||d.currentFeaturesMaxScore)||(o=0>m?0:10),m||(m=0),1*r<1*m&&(r=m),1*r>1*o&&(r=o),d=(1*r-m)/(o-m),r=-1*m/(o-m),d>=r?(i=Math.max(1,(d-r)*u),b=b+(1-r)*u-
i):(Math.max(1,(d-r)*u),b+=(1-r)*u),v={min:m,max:o},p=new TranslatedGlyph(p,0,b-t,u)}else if("HISTOGRAM"===l||"GRADIENT"===l&&"undefined"!==r)m=d.dasSource.forceMin||c.MIN||d.currentFeaturesMinScore,(o=d.dasSource.forceMax||c.MAX||d.currentFeaturesMaxScore)||(o=0>m?0:10),m||(m=0),1*r<1*m&&(r=m),1*r>1*o&&(r=o),d=(1*r-m)/(o-m),r=-1*m/(o-m),"HISTOGRAM"===l&&(d>=r?(i=Math.max(1,(d-r)*u),b=b+(1-r)*u-i):(i=Math.max(1,(r-d)*u),b+=(1-r)*u),v={min:m,max:o}),m=c.FGCOLOR||null,u=a.override_color||c.BGCOLOR||
c.COLOR1||"green",r=c.ALPHA?1*c.ALPHA:null,c.COLOR2&&(l=c._gradient,l||(l=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=l),d=d*l.length|0,0>d&&(d=0),d>=l.length&&(d=l.length-1),u=l[d]),p=new BoxGlyph(t,b,p-t,i,u,m,r);else if("HIDDEN"===l)p=new PaddedGlyph(null,t,p),h=!0;else if("ARROW"===l)b=c.FGCOLOR||"purple",d=isDasBooleanTrue(c.PARALLEL),r=isDasBooleanTrue(c.SOUTHWEST),l=isDasBooleanTrue(c.NORTHEAST),p=new ArrowGlyph(t,p,i,b,d,r,l);else if("ANCHORED_ARROW"===l)m=c.FGCOLOR||"none",u=
c.BGCOLOR||"green",p=new AArrowGlyph(t,p,i,u,m,q),p.bump=!0;else if("SPAN"===l)m=c.FGCOLOR||"black",p=new SpanGlyph(t,p,i,m);else if("LINE"===l)m=c.FGCOLOR||"black",p=new LineGlyph(t,p,i,c.STYLE||"solid",q,m);else if("PRIMERS"===l)m=c.FGCOLOR||"black",u=c.BGCOLOR||"red",p=new PrimersGlyph(t,p,i,u,m);else if("TEXT"===l)b=c.STRING||"text",u=c.FGCOLOR||"black",p=new TextGlyph(t,p,i,u,b);else if("TOOMANY"===l)m=c.FGCOLOR||"gray",u=c.BGCOLOR||"orange",p=new TooManyGlyph(t,p,i,u,m);else if("POINT"===l)i=
d.forceHeight||c.HEIGHT||30,m=d.dasSource.forceMin||c.MIN||d.currentFeaturesMinScore||0,o=d.dasSource.forceMax||c.MAX||d.currentFeaturesMaxScore||10,d=(1*r-m)/(o-m),b=(r-1*m)*(1*i/(o-m))|0,v={min:m,max:o},u=a.override_color||c.FGCOLOR||c.COLOR1||"black",c.COLOR2&&(l=c._gradient,l||(l=makeGradient(50,c.COLOR1,c.COLOR2,c.COLOR3),c._gradient=l),d=d*l.length|0,0>d&&(d=0),d>=l.length&&(d=l.length-1),u=l[d]),p=new PointGlyph((t+p)/2,i-b,i,u);else if("__SEQUENCE"===l)b=null,d.currentSequence&&(r=d.currentSequence.start|
0,l=d.currentSequence.end|0,r<m&&l>o&&(b=d.currentSequence.seq.substr(m-r,o-m+1))),p=new SequenceGlyph(t,p,i,a.seq,b);else{if("__NONE"===l)return null;m=c.FGCOLOR||null;u=a.override_color||c.BGCOLOR||c.COLOR1||"green";p=new BoxGlyph(t,0,p-t,i,u,m)}isDasBooleanTrue(c.LABEL)&&(s&&!h)&&(p=new LabelledGlyph(p,s));j&&(p.bump=!0);p.feature=a;v&&(p.quant=v);c.ZINDEX&&(p.zindex=c.ZINDEX|0);return p}
DasTier.prototype.styleForFeature=function(a){var b=a._cachedStyle;if(b)return b;b=zoomForScale(this.browser.scale);if(!this.stylesheet)return null;for(var c=null,d=this.stylesheet.styles,e=0;e<d.length;++e){var h=d[e];if(!(h.zoom&&h.zoom!=b)){var j=h._labelRE;if(!j||!j.test)j=RegExp("^"+h.label+"$"),h._labelRE=j;if(!h.label||j.test(a.label)){j=h._methodRE;if(!j||!j.test)j=RegExp("^"+h.method+"$"),h._methodRE=j;if(!h.method||j.test(a.method)){if(h.type)if("default"==h.type){c||(c=h.style);continue}else if(h.type!=
a.type)continue;return a._cachedStyle=h.style}}}}return a._cachedStyle=c};
function makeLineGlyph(a,b,c){for(var d=c.browser.viewStart,e=c.browser.scale,h=c.forceHeight||b.HEIGHT||30,j=c.dasSource.forceMin||b.MIN||c.currentFeaturesMinScore||0,c=c.dasSource.forceMax||b.MAX||c.currentFeaturesMaxScore||10,i=1*h/(c-j),b=b.FGCOLOR||b.COLOR1||"black",l=[],m=0;m<a.length;++m){var o=a[m],q=h-((o.score-1*j)*i|0);l.push((((o.min|0)+(o.max|0))/2-d)*e);l.push(q)}a=new LineGraphGlyph(l,b,h);a.quant={min:j,max:c};return a}
var MIN_TILE=100,rulerTileColors=["black","white"],baseColors={A:"green",C:"blue",G:"black",T:"red"},steps=[1,2,5];function tileSizeForScale(a,b){b||(b=MIN_TILE);for(var c=steps.length;a*steps[c%steps.length]*Math.pow(10,c/steps.length|0)<b;)++c;return steps[c%steps.length]*Math.pow(10,c/steps.length|0)}
function drawSeqTier(a,b){var c=a.browser.scale,d=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,h=a.browser.currentSeqMax,j=a.viewport.width|0;j<a.browser.featurePanelWidth+1950&&(a.viewport.width=j=(a.browser.featurePanelWidth|0)+2E3);var i=50;b&&b.seq&&(i+=25);a.viewport.height=i;a.holder.style.height=""+i+"px";a.updateHeight();i=a.viewport.getContext("2d");i.clearRect(0,0,j,a.viewport.height);i.translate(1E3,0);j=e;0<h&&h<e&&(j=h);for(var l=tileSizeForScale(c),m=Math.max(0,(d/l|0)*l),h=
a.browser.viewStart;m<=j;)i.fillStyle=0==m/l%2?"white":"black",i.strokeStyle="black",i.fillRect((m-h)*c,8,l*c,3),i.strokeRect((m-h)*c,8,l*c,3),i.fillStyle="black",i.fillText(formatLongInt(m),(m-h)*c,22),m+=l;if(b&&b.seq)for(;d<=e;++d)d>=b.start&&d<=b.end&&(j=b.seq.substr(d-b.start,1).toUpperCase(),(l=baseColors[j])||(l="gray"),i.fillStyle=l,8<=c?i.fillText(j,(d-h)*c,52):i.fillRect((d-h)*c,42,c,12));a.norigin=a.browser.viewStart;a.viewport.style.left="-1000px"}
function svgSeqTier(a,b){var c=a.browser.scale,d=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,h=a.browser.currentSeqMax,j=e;0<h&&h<e&&(j=h);for(var i=tileSizeForScale(c),l=Math.max(0,(d/i|0)*i),h=a.browser.viewStart,m=makeElementNS(NS_SVG,"g",[],{fontSize:"8pt"});l<=j;)m.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(l-h)*c,y:8,width:i*c,height:3,fill:0==l/i%2?"white":"black",stroke:"black"})),m.appendChild(makeElementNS(NS_SVG,"text",formatLongInt(l),{x:(l-h)*c,y:28,fill:"black",stroke:"none"})),
l+=i;if(b&&b.seq)for(;d<=e;++d)d>=b.start&&d<=b.end&&(j=b.seq.substr(d-b.start,1).toUpperCase(),(i=baseColors[j])||(i="gray"),8<=c?m.appendChild(makeElementNS(NS_SVG,"text",j,{x:(d-h)*c,y:52,fill:i})):m.appendChild(makeElementNS(NS_SVG,"rect",null,{x:(d-h)*c,y:42,width:c,height:12,fill:i})));return m}
function sortFeatures(a){for(var b={},c={},d={},e={},h={},j=[],i,l,m,o=function(){m={};for(var b=0;b<a.currentFeatures.length;++b){var c=a.currentFeatures[b];c.id&&(m[c.id]=c)}},q=function(a){var b=[];if(a.parents)for(var c=0;c<a.parents.length;++c){var d=a.parents[c],e=m[d];e&&"SO:0000704"==e.typeCv&&pushnew(b,d)}return b},r=0;r<a.currentFeatures.length;++r){var s=a.currentFeatures[r];if(!s.parts)if(!s.min||!s.max)j.push(s);else{if(s.score&&"."!=s.score&&"-"!=s.score){sc=1*s.score;if(!i||sc<i)i=
sc;if(!l||sc>l)l=sc}var t=[],p=null;if(s.groups)for(var u=0;u<s.groups.length;++u){var v=s.groups[u],w=v.id;"gene"==v.type?(p=w,d[w]=shallowCopy(v)):"translation"!=v.type&&(pusho(c,w,s),d[w]=shallowCopy(v),t.push(w))}if(s.parents){m||o();for(u=0;u<s.parents.length;++u)if(v=s.parents[u],w=m[v])if(w.parts||(w.parts=[s]),pushnewo(c,v,w),pusho(c,v,s),d[v]||(d[v]={type:w.type,id:w.id,label:w.label||w.id}),t.push(v),v=q(w),0<v.length)p=v[0],w=m[v[0]],d[v[0]]={type:w.type,id:w.id,label:w.label||w.id},a.dasSource.collapseSuperGroups||
(a.dasSource.collapseSuperGroups=!0)}if(0==t.length)pusho(b,s.type,s);else if(p)for(v=0;v<t.length;++v)w=t[v],pushnewo(e,p,w),h[w]=p}}a.ungroupedFeatures=b;a.groupedFeatures=c;a.groups=d;a.superGroups=e;a.groupsToSupers=h;i&&(0<i?i=0:0>l&&(l=0),a.currentFeaturesMinScore=i,a.currentFeaturesMaxScore=l)}TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;Browser.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
function FeatureInfo(a,b,c){var d=pick(c.type,b.type),e=pick(b.label,c.label,c.id,b.id);e&&0!=e.indexOf("__dazzle")&&(d=d+": "+e);this.hit=a;this.feature=b;this.group=c;this.title=d;this.sections=[]}FeatureInfo.prototype.setTitle=function(a){this.title=a};FeatureInfo.prototype.add=function(a,b){"string"===typeof b&&(b=makeElement("span",b));this.sections.push({label:a,info:b})};
Browser.prototype.featurePopup=function(a,b,c,d){var b=c.length,e=0<=--b?c[b]:{},h=0<=--b?c[b]:{},c=new FeatureInfo(c,e,h),b=this.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(j){console.log(j.stack||j)}b=d.featureInfoPlugins||[];for(fipi=0;fipi<b.length;++fipi)try{b[fipi](e,c)}catch(i){console.log(i.stack||i)}this.removeAllPopups();d=makeElement("table",null,{className:"table table-striped table-condensed"});d.style.width="100%";d.style.margin="0px";b=0;if(e.method){var l=
makeElement("tr",[makeElement("th","Method"),makeElement("td",e.method)]);d.appendChild(l);++b}l=h.segment?h:e;l=makeElement("tr",[makeElement("th","Location"),makeElement("td",l.segment+":"+l.min+"-"+l.max)]);l.style.backgroundColor=this.tierBackgroundColors[b%this.tierBackgroundColors.length];d.appendChild(l);++b;void 0!==e.score&&(null!==e.score&&"-"!=e.score)&&(l=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+e.score)]),d.appendChild(l),++b);if((l=maybeConcat(h.links,e.links))&&
0<l.length)l=makeElement("tr",[makeElement("th","Links"),makeElement("td",l.map(function(a){return makeElement("div",makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),d.appendChild(l),++b;e=maybeConcat(h.notes,e.notes);for(h=0;h<e.length;++h){var l="Note",m=e[h],o=m.match(TAGVAL_NOTE_RE);o&&(l=o[1],m=o[2]);l=makeElement("tr",[makeElement("th",l),makeElement("td",m)]);d.appendChild(l);++b}for(b=0;b<c.sections.length;++b)e=c.sections[b],d.appendChild(makeElement("tr",[makeElement("th",e.label),
makeElement("td",e.info)]));this.popit(a,c.title,d,{width:400})};function Karyoscape(a,b){this.browser=a;this.dsn=b;this.svg=makeElementNS(NS_SVG,"g");this.width=250}Karyoscape.prototype.update=function(a,b,c){this.start=b;this.end=c;if(!this.chr||a!=this.chr){this.chr=a;removeChildren(this.svg);var d=this;this.dsn.features(new DASSegment(a),{type:"karyotype"},function(b,c,j){d.chrLen=j&&j[a]&&j[a].max?j[a].max:null;d.karyos=b||[];d.redraw()})}else this.setThumb()};
var karyo_palette={gneg:"white",gpos25:"rgb(200,200,200)",gpos33:"rgb(180,180,180)",gpos50:"rgb(128,128,128)",gpos66:"rgb(100,100,100)",gpos75:"rgb(64,64,64)",gpos100:"rgb(0,0,0)",gpos:"rgb(0,0,0)",gvar:"rgb(100,100,100)",acen:"rgb(100,100,100)",stalk:"rgb(100,100,100)"};
Karyoscape.prototype.redraw=function(){removeChildren(this.svg);this.karyos=this.karyos.sort(function(a,b){return(a.min|0)-(b.min|0)});0<this.karyos.length?this.chrLen||(this.chrLen=this.karyos[this.karyos.length-1].max):(this.chrLen||(alert("Warning: insufficient data to set up spatial navigator"),this.chrLen=2E8),this.karyos.push({min:1,max:this.chrLen,label:"gneg"}));for(var a=null,b=0;b<this.karyos.length;++b){var c=this.karyos[b],d=1*c.min/this.chrLen*this.width,e=1*c.max/this.chrLen*this.width,
h=karyo_palette[c.label];h&&e>d&&(d=makeElementNS(NS_SVG,"rect",null,{x:d,y:"stalk"==c.label||"acen"==c.label?5:0,width:e-d,height:"stalk"==c.label||"acen"==c.label?5:15,stroke:"none",fill:h}),"g"==c.label.substring(0,1)&&(e=new Range(c.min,c.max),a=null==a?e:union(a,e)),this.browser.makeTooltip(d,c.id),this.svg.appendChild(d))}if(a){for(var a=a.ranges(),b="M 0 10 L 0 0",c="M 0 5 L 0 15",j=h=0;j<a.length;++j)e=a[j],d=1*e.min()/this.chrLen*this.width,e=1*e.max()/this.chrLen*this.width,0.75<d-h&&(b+=
" M "+d+" 0",c+=" M "+d+" 15"),b+=" L "+e+" 0",c+=" L "+e+" 15",h=e;0.75<this.width-h?(b+=" M "+this.width+" 0",c+=" M "+this.width+" 15"):(b+=" L "+this.width+" 0",c+=" L "+this.width+" 15");b+=" L "+this.width+" 10";c+=" L "+this.width+" 5";this.svg.appendChild(makeElementNS(NS_SVG,"path",null,{d:b+" "+c,stroke:"black",strokeWidth:2,fill:"none"}))}this.thumb=makeElementNS(NS_SVG,"rect",null,{x:50,y:-5,width:8,height:25,fill:"blue",fillOpacity:0.5,stroke:"none"});this.svg.appendChild(this.thumb);
this.setThumb();var i=this,l,m=function(a){a.stopPropagation();a.preventDefault();a=Math.max(-4,Math.min(a.clientX+l,i.width-4));i.thumb.setAttribute("x",a)},o=function(a){a.stopPropagation();a.preventDefault();if(i.onchange)i.onchange(1*((i.thumb.getAttribute("x")|0)+4)/i.width,true);document.removeEventListener("mousemove",m,true);document.removeEventListener("mouseup",o,true)};this.thumb.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();l=i.thumb.getAttribute("x")-
a.clientX;document.addEventListener("mousemove",m,true);document.addEventListener("mouseup",o,true)},!1)};Karyoscape.prototype.setThumb=function(){var a=1*(((this.start|0)+(this.end|0))/2)/this.chrLen*this.width;this.thumb&&this.thumb.setAttribute("x",a-4)};function FetchPool(){this.reqs=[];this.awaitedFeatures={}}FetchPool.prototype.addRequest=function(a){this.reqs.push(a)};FetchPool.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
function KSCacheBaton(a,b,c,d,e,h){this.chr=a;this.min=b;this.max=c;this.scale=d;this.features=e||[];this.status=h}KSCacheBaton.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};function KnownSpace(a,b,c,d,e,h){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=e;this.seqSource=h||new DummySequenceSource;this.viewCount=0;this.featureCache={};this.latestViews={}}
KnownSpace.prototype.bestCacheOverlapping=function(){var a=this.featureCache[this.tierMap[0]];return a?a:null};KnownSpace.prototype.viewFeatures=function(a,b,c,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=c;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new FetchPool;this.awaitedSeq=new Awaited;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap)};
function filterFeatures(a,b,c){var d=[];featuresByGroup={};for(var e=0;e<a.length;++e){var h=a[e];!h.min||!h.max?d.push(h):h.groups&&0<h.groups.length?pusho(featuresByGroup,h.groups[0].id,h):h.min<=c&&h.max>=b&&d.push(h)}for(var j in featuresByGroup){for(var a=featuresByGroup[j],i=1E11,l=-1E11,e=0;e<a.length;++e)h=a[e],i=Math.min(i,h.min),l=Math.max(l,h.max);if(i<=c||l>=b)for(e=0;e<a.length;++e)d.push(a[e])}return d}KnownSpace.prototype.invalidate=function(a){this.featureCache[a]=null;this.startFetchesForTiers([a])};
KnownSpace.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,d=!1,e=0;e<a.length;++e)try{this.startFetchesFor(a[e],c)&&(d=!0)}catch(h){a[e].updateStatus(h),console.log("Error fetching tier source"),console.log(h)}if(d&&!this.seqWasFetched){this.seqWasFetched=!0;var j=this.min,i=this.max;if(this.cs&&this.cs.start<=j&&this.cs.end>=i)return a=this.cs.start==j&&this.cs.end==i?this.cs:new DASSequence(this.cs.name,j,i,this.cs.alphabet,this.cs.seq.substring(j-this.cs.start,i+1-
this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,j,i,this.pool,function(a,d){if(d){if(!b.cs||j<=b.cs.start&&i>=b.cs.end||j>=b.cs.end||i<=b.cs.start||i-j>b.cs.end-b.cs.start)b.cs=d;c.provide(d)}else dlog("Noseq: "+miniJSONify(a)),c.provide(null)})}};
KnownSpace.prototype.startFetchesFor=function(a,b){var c=this,d=this.viewCount,e=a.getSource()||new DummyFeatureSource,h=a.needsSequence(this.scale),j=c.featureCache[a],i=a.getDesiredTypes(this.scale);if(void 0===i)return!1;if(j&&j.chr===this.chr&&j.min<=this.min&&j.max>=this.max){var l=j.features;if(j.min<this.min||j.max>this.max)l=filterFeatures(l,this.min,this.max);c.provision(a,j.chr,Math.max(j.min,this.min),Math.min(j.max,this.max),j.scale,i,l,j.status,h?b:null);l=e.getScales();if(j.scale<=this.scale||
!l)return h}e.instrument&&console.log("Starting  fetch "+d+" ("+this.min+", "+this.max+")");e.fetch(this.chr,this.min,this.max,this.scale,i,this.pool,function(l,o,q){e.instrument&&console.log("Finishing fetch "+d);if(!((c.latestViews[a]||-1)>d)){if(!j||c.min<j.min||c.max>j.max)c.featureCache[a]=new KSCacheBaton(c.chr,c.min,c.max,q,o,l);c.latestViews[a]=d;c.provision(a,c.chr,c.min,c.max,q,i,o,l,h?b:null)}});return h};
KnownSpace.prototype.provision=function(a,b,c,d,e,h,j,i,l){if(i)a.updateStatus(i);else{for(var i=!1,m=a.getSource();MappedFeatureSource.prototype.isPrototypeOf(m)||CachingFeatureSource.prototype.isPrototypeOf(m)||OverlayFeatureSource.prototype.isPrototypeOf(m);)m=OverlayFeatureSource.prototype.isPrototypeOf(m)?m.sources[0]:m.source;if(BWGFeatureSource.prototype.isPrototypeOf(m)||BAMFeatureSource.prototype.isPrototypeOf(m))i=!0;if(!m.opts||!m.opts.forceReduction&&!m.opts.noDownsample)if(e<this.scale/
2&&200<j.length||i&&h&&1==h.length&&0<=h.indexOf("density"))j=downsample(j,this.scale);l?l.await(function(h){a.viewFeatures(b,c,d,e,j,h)}):a.viewFeatures(b,c,d,e,j)}};var VALID_BOUND_RE=/^-?[0-9]+(\.[0-9]+)?$/;
Browser.prototype.makeQuantConfigButton=function(a,b){var c=this;a.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();c.removeAllPopups();var e=makeElement("table"),h=makeElement("input","",{value:b.min});e.appendChild(makeElement("tr",[makeElement("td","Min:"),makeElement("td",h)]));var j=makeElement("input","",{value:b.max});e.appendChild(makeElement("tr",[makeElement("td","Max:"),makeElement("td",j)]));var i=makeElement("div","Update");i.style.backgroundColor="rgb(230,230,250)";
i.style.borderStyle="solid";i.style.borderColor="blue";i.style.borderWidth="3px";i.style.padding="2px";i.style.margin="10px";i.style.width="150px";i.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();VALID_BOUND_RE.test(h.value)?VALID_BOUND_RE.test(j.value)?(b.dasSource.forceMin=h.value,b.dasSource.forceMax=j.value,c.removeAllPopups(),b.draw(),c.storeStatus()):alert("Don't understand "+j.value):alert("Don't understand "+h.value)},!1);c.popit(a,"Configure: "+b.dasSource.name,
[e,i])},!1)};var __DS_SCALES=[1,2,5];function ds_scale(a){return __DS_SCALES[a%__DS_SCALES.length]*Math.pow(10,a/__DS_SCALES.length|0)}function DSBin(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=c;this.lap=0;this.covered=null}DSBin.prototype.score=function(){return 0==this.cnt?0:this.hasScore?this.tot/this.cnt:this.lap/coverage(this.covered)};
DSBin.prototype.feature=function(a){a.score&&(this.tot+=a.score,this.hasScore=!0);var b=a.max|0,a=Math.max(this.min,a.min|0),b=Math.min(this.max,b);this.lap+=1*(b-a+1);++this.cnt;b=new Range(a,b);this.covered=this.covered?union(this.covered,b):b};
function downsample(a,b){Date.now();for(var c=0;ds_scale(c+1)<b;)++c;for(var c=ds_scale(c),d=[],e=-1E10,h=1E10,j=0;j<a.length;++j){var i=a[j];if(i.groups&&0<i.groups.length)return a;for(var l=i.min/c|0,m=i.max/c|0,e=Math.max(e,m),h=Math.min(h,l);l<=m;++l){var o=d[l];o||(o=new DSBin(c,l*c,(l+1)*c-1),d[l]=o);o.feature(i)}}j=[];for(l=h;l<=e;++l)if(o=d[l])i=new DASFeature,i.segment=a[0].segment,i.min=l*c+1,i.max=(l+1)*c,i.score=o.score(),i.type="density",j.push(i);Date.now();return j}
var hexcase=0,b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}
function any_hmac_sha1(a,b,c){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)),c)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),8*a.length))}
function rstr_hmac_sha1(a,b){var c=rstr2binb(a);16<c.length&&(c=binb_sha1(c,8*a.length));for(var d=Array(16),e=Array(16),h=0;16>h;h++)d[h]=c[h]^909522486,e[h]=c[h]^1549556828;c=binb_sha1(d.concat(rstr2binb(b)),512+8*b.length);return binb2rstr(binb_sha1(e.concat(c),672))}function rstr2hex(a){try{hexcase}catch(b){hexcase=0}for(var c=hexcase?"0123456789ABCDEF":"0123456789abcdef",d="",e,h=0;h<a.length;h++)e=a.charCodeAt(h),d+=c.charAt(e>>>4&15)+c.charAt(e&15);return d}
function rstr2b64(a){try{b64pad}catch(b){b64pad=""}for(var c="",d=a.length,e=0;e<d;e+=3)for(var h=a.charCodeAt(e)<<16|(e+1<d?a.charCodeAt(e+1)<<8:0)|(e+2<d?a.charCodeAt(e+2):0),j=0;4>j;j++)c=8*e+6*j>8*a.length?c+b64pad:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>6*(3-j)&63);return c}
function rstr2any(a,b){var c=b.length,d=[],e,h,j,i,l=Array(Math.ceil(a.length/2));for(e=0;e<l.length;e++)l[e]=a.charCodeAt(2*e)<<8|a.charCodeAt(2*e+1);for(;0<l.length;){i=[];for(e=j=0;e<l.length;e++)if(j=(j<<16)+l[e],h=Math.floor(j/c),j-=h*c,0<i.length||0<h)i[i.length]=h;d[d.length]=j;l=i}c="";for(e=d.length-1;0<=e;e--)c+=b.charAt(d[e]);d=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2)));for(e=c.length;e<d;e++)c=b[0]+c;return c}
function str2rstr_utf8(a){for(var b="",c=-1,d,e;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=d&&(56319>=d&&56320<=e&&57343>=e)&&(d=65536+((d&1023)<<10)+(e&1023),c++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b}
function str2rstr_utf16le(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b}function str2rstr_utf16be(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b}function rstr2binb(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}
function binb2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}
function binb_sha1(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,h=-1732584194,j=271733878,i=-1009589776,l=0;l<a.length;l+=16){for(var m=d,o=e,q=h,r=j,s=i,t=0;80>t;t++){c[t]=16>t?a[l+t]:bit_rol(c[t-3]^c[t-8]^c[t-14]^c[t-16],1);var p=safe_add(safe_add(bit_rol(d,5),sha1_ft(t,e,h,j)),safe_add(safe_add(i,c[t]),sha1_kt(t))),i=j,j=h,h=bit_rol(e,30),e=d,d=p}d=safe_add(d,m);e=safe_add(e,o);h=safe_add(h,q);j=safe_add(j,r);i=safe_add(i,s)}return[d,e,h,j,i]}
function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}
Browser.prototype.saveSVG=function(){var a=this,b=document.implementation.createDocument(NS_SVG,"svg",null),c=makeElementNS(NS_SVG,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});b.documentElement.appendChild(c);var d=makeElementNS(NS_SVG,"a",makeElementNS(NS_SVG,"text","Graphics from Dalliance "+VERSION,{x:(a.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fill:"black",fontSize:"12pt",textAnchor:"middle",fill:"blue"}));d.setAttribute("xmlns:xlink",NS_XLINK);d.setAttribute("xlink:href","http://www.biodalliance.org/");
c.appendChild(d);d=makeElementNS(NS_SVG,"rect",null,{x:200,y:50,width:a.featurePanelWidth,height:1E5});d=makeElementNS(NS_SVG,"clipPath",d,{id:"featureClip"});c.appendChild(d);for(var d=70,e=makeElementNS(NS_SVG,"g",null,{}),h=0;h<a.tiers.length;++h){var j=a.tiers[h],i=makeElementNS(NS_SVG,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),l=makeElementNS(NS_SVG,"g"),m=d,o=makeElementNS(NS_SVG,"rect",null,{x:0,y:m,width:"10000",height:50,fill:j.background});i.appendChild(o);if("sequence"===
j.dasSource.tier_type){var q=svgSeqTier(j,j.currentSequence);i.appendChild(makeElementNS(NS_SVG,"g",q,{transform:"translate(200, "+d+")"}));d+=80}else{if(!j.subtiers)continue;for(var q=(j.glyphCacheOrigin-a.viewStart)*a.scale,r=0;r<j.subtiers.length;++r){for(var s=j.subtiers[r],t=[],p=0;p<s.glyphs.length;++p)t.push(s.glyphs[p].toSVG());i.appendChild(makeElementNS(NS_SVG,"g",t,{transform:"translate("+(200+q)+", "+d+")"}));s.quant&&(t=s.quant,p=new SVGPath,p.moveTo(205,d),p.lineTo(200,d),p.lineTo(200,
d+s.height),p.lineTo(205,d+s.height),l.appendChild(makeElementNS(NS_SVG,"path",null,{d:p.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"})),l.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(t.max),{x:197,y:d+8,textAnchor:"end"})),l.appendChild(makeElementNS(NS_SVG,"text",formatQuantLabel(t.min),{x:197,y:d+s.height-3,textAnchor:"end"})));d+=s.height+3}d+=10}l.appendChild(makeElementNS(NS_SVG,"text",j.dasSource.name,{x:188,y:(d+m+5)/2,fontSize:"12pt",textAnchor:"end"}));o.setAttribute("height",
d-m);e.appendChild(makeElementNS(NS_SVG,"g",[i,l]))}c.appendChild(e);b.documentElement.setAttribute("width",a.featurePanelWidth+20+200);b.documentElement.setAttribute("height",d+50);b=new Blob([(new XMLSerializer).serializeToString(b)]);c=new FileReader;c.onload=function(b){window.open("data:image/svg+xml;"+b.target.result.substring(6),"Dalliance graphics","width="+(a.featurePanelWidth+20+200+"px"))};c.readAsDataURL(b)};function Range(a,b){this._min=a|0;this._max=b|0}Range.prototype.min=function(){return this._min};
Range.prototype.max=function(){return this._max};Range.prototype.contains=function(a){return a>=this._min&&a<=this._max};Range.prototype.isContiguous=function(){return!0};Range.prototype.ranges=function(){return[this]};Range.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};function _Compound(a){this._ranges=a}_Compound.prototype.min=function(){return this._ranges[0].min()};_Compound.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};
_Compound.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return!0;return!1};_Compound.prototype.isContiguous=function(){return 1<this._ranges.length};_Compound.prototype.ranges=function(){return this._ranges};_Compound.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b)0<b&&(a+=","),a+=this._ranges[b].toString();return a};
function union(a,b){for(var c=a.ranges().concat(b.ranges()).sort(rangeOrder),d=[],e=c[0],h=1;h<c.length;++h){var j=c[h];j.min()>e.max()+1?(d.push(e),e=j):j.max()>e.max()&&(e=new Range(e.min(),j.max()))}d.push(e);return 1==d.length?d[0]:new _Compound(d)}
function intersection(a,b){for(var c=a.ranges(),d=b.ranges(),e=c.length,h=d.length,j=0,i=0,l=[];j<e&&i<h;){var a=c[j],b=d[i],m=Math.max(a.min(),b.min()),o=Math.min(a.max(),b.max());o>=m&&l.push(new Range(m,o));a.max()>b.max()?++i:++j}return 0==l.length?null:1==l.length?l[0]:new _Compound(l)}function coverage(a){for(var b=0,a=a.ranges(),c=0;c<a.length;++c)var d=a[c],b=b+(d.max()-d.min()+1);return b}
function rangeOrder(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}var THUB_STANZA_REGEXP=/\n\s*\n/,THUB_PARSE_REGEXP=/(\w+) +(.+)\n?/,THUB_SUBGROUP_REGEXP=/subGroup[1-9]/,THUB_PENNANT_PREFIX="http://genome.ucsc.edu/images/";function TrackHub(a){this.genomes={};this.url=a}function TrackHubTrack(){}TrackHubTrack.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};function TrackHubDB(){}
TrackHubDB.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);textXHR(this.absURL,function(c,d){if(d)return a(null,d);var c=c.replace("\\\n"," "),e=[],h={};stanzas=c.split(THUB_STANZA_REGEXP);for(var j=0;j<stanzas.length;++j){var i=stanzas[j].split(THUB_PARSE_REGEXP),l=new TrackHubTrack;l._db=b;for(var m=0;m<i.length-2;m+=3){var o=i[m+1],q=i[m+2];if(o.match(THUB_SUBGROUP_REGEXP)){l.subgroups||(l.subgroups={});for(var o=q.split(/\s/),q=o[0],r={name:o[1],tags:[],titles:[]},
s=2;s<o.length;++s){var t=o[s].split(/=/);r.tags.push(t[0]);r.titles.push(t[1])}l.subgroups[q]=r}else if("subGroups"===o){o=q.split(/(\w+)=(\w+)/);l.sgm={};for(s=0;s<o.length-2;s+=3)l.sgm[o[s+1]]=o[s+2]}else l[i[m+1]]=i[m+2]}if(l.track&&(l.type||l.container))e.push(l),h[l.track]=l}j=[];for(i=0;i<e.length;++i){l=e[i];m=!0;if(l.parent&&(ptoks=l.parent.split(/\s+/),o=h[ptoks[0]])){l._parent=o;o.children||(o.children=[]);o.children.push(l);if(o&&(!o.compositeTrack||o.view))m=!1;"multiWig"==o.container&&
(m=!1)}l.compositeTrack&&!l.view&&(m=!1);m&&j.push(l)}b._tracks=j;return a(b._tracks,null)})};
function connectTrackHub(a,b){textXHR(a,function(c,d){if(d)return b(null,d);for(var e=c.split(THUB_PARSE_REGEXP),h=new TrackHub(a),j=0;j<e.length-2;j+=3)h[e[j+1]]=e[j+2];if(h.genomesFile){var i=relativeURL(a,h.genomesFile);textXHR(i,function(a,c){if(c)return b(null,c);stanzas=a.split(THUB_STANZA_REGEXP);for(var d=0;d<stanzas.length;++d){for(var e=stanzas[d].split(THUB_PARSE_REGEXP),j=new TrackHubDB,s=0;s<e.length-2;s+=3)j[e[s+1]]=e[s+2];j.genome&&j.trackDb&&(j.absURL=relativeURL(i,j.trackDb),h.genomes[j.genome]=
j)}b(h)})}else b(null,"No genomesFile")})}
TrackHubTrack.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel},b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant=THUB_PENNANT_PREFIX+b[0]);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var d=b[c],e=d.toDallianceSource();a.overlay.push(e);if(e.style)for(var h=0;h<e.style.length;++h){var j=e.style[h];j.method=d.shortLabel;"transparentOverlay"==this.aggregate&&(j.style.ALPHA=
0.5);a.style.push(j)}}return a}typeToks=this.type.split(/\s+/);if("bigBed"==typeToks[0])return a.bwgURI=relativeURL(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),a;if("bigWig"==typeToks[0])return a.bwgURI=relativeURL(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),a;if("bam"==typeToks[0])return a.bamURI=relativeURL(this._db.absURL,this.bigDataUrl),
a;console.log("Unsupported "+this.type)};
TrackHubTrack.prototype.bigwigStyles=function(){var a,b;3<=typeToks.length&&(a=1*typeToks[1],b=1*typeToks[2]);var c;if(this.maxHeightPixels){var d=this.maxHeightPixels.split(/:/);3==d.length?c=d[1]|0:console.log("maxHeightPixels should be of the form max:default:min")}d="bars";this.graphTypeDefault&&(d=this.graphTypeDefault);var e="black",h=null;this.color&&(e="rgb("+this.color+")");this.altColor&&(h="rgb("+this.altColor+")");var j=new DASStylesheet,i=new DASStyle;i.glyph="points"==d?"POINT":"HISTOGRAM";
h?(i.COLOR1=e,i.COLOR2=h):i.BGCOLOR=e;i.HEIGHT=c||30;if(a||b)i.MIN=a,i.MAX=b;j.pushStyle({type:"default"},null,i);return j.styles};
TrackHubTrack.prototype.bigbedStyles=function(){var a=this.get("visibility")||"full",b=this.get("color"),b=b?"rgb("+b+")":"blue",c=new DASStylesheet,d=new DASStyle;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR=b;d.HEIGHT="full"==a||"pack"==a?12:8;d.BUMP="full"==a||"pack"==a;d.LABEL="full"==a||"pack"==a;d.ZINDEX=20;c.pushStyle({type:"bigwig"},null,d);a=new DASStyle;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="red";a.HEIGHT=10;a.BUMP=!0;a.ZINDEX=20;c.pushStyle({type:"bb-translation"},null,a);a=new DASStyle;
a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="white";a.HEIGHT=10;a.ZINDEX=10;a.BUMP=!0;a.LABEL=!0;c.pushStyle({type:"bb-transcript"},null,a);return c.styles};var __tier_idSeed=0;
function DasTier(a,b,c,d,e,h,j){this.id="tier"+ ++__tier_idSeed;this.browser=a;this.dasSource=new DASSource(b);this.viewport=c;this.holder=d;this.overlay=e;this.placard=h;this.placardContent=j;this.req=null;this.layoutHeight=25;this.bumped=!0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.y=0;this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);this.initSources()}
DasTier.prototype.toString=function(){return this.id};DasTier.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
DasTier.prototype.init=function(){var a=this;if(a.dasSource.style)this.stylesheet={styles:a.dasSource.style},this.browser.refreshTier(this);else{var b;b=a.dasSource.stylesheet_uri?new DASFeatureSource(a.dasSource):a.getSource();a.status="Fetching stylesheet";b.getStyleSheet(function(b,d){if(d){a.error="No stylesheet";a.stylesheet=new DASStylesheet;var e=new DASStyle;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";a.stylesheet.pushStyle({type:"default"},null,e)}else a.stylesheet=b;a.browser.refreshTier(a)})}};
DasTier.prototype.styles=function(){return null==this.stylesheet?null:0.2<this.browser.scale?this.stylesheet.highZoomStyles:0.01<this.browser.scale?this.stylesheet.mediumZoomStyles:this.stylesheet.lowZoomStyles};DasTier.prototype.getSource=function(){return this.featureSource};
DasTier.prototype.getDesiredTypes=function(){var a=[],b=!1,c=zoomForScale(this.browser.scale);if(this.stylesheet){for(var d=this.stylesheet.styles,e=0;e<d.length;++e){var h=d[e];if(!h.zoom||h.zoom==c)if(!h.type||"default"==h.type){b=!0;break}else pushnew(a,h.type)}return b?null:a}};DasTier.prototype.needsSequence=function(a){return"sequence"===this.dasSource.tier_type&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob)&&20>a?!0:!1};DasTier.prototype.setStatus=function(a){dlog(a)};
DasTier.prototype.viewFeatures=function(a,b,c,d,e,h){this.currentFeatures=e;this.currentSequence=h;this.knownChr=a;this.knownStart=b;this.knownEnd=c;this.error=this.status=null;this.draw()};DasTier.prototype.updateStatus=function(a){a?(this.currentFeatures=[],this.currentSequence=null,this.error=a,this.placardContent.innerText=a,this.placard.style.display="block",this.holder.style.display="none"):(this.placard.style.display="none",this.holder.style.display="block");this.updateHeight()};
DasTier.prototype.draw=function(){var a=this.currentSequence;"sequence"===this.dasSource.tier_type?drawSeqTier(this,a):drawFeatureTier(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};function zoomForScale(a){return 0.2<a?"high":0.01<a?"medium":"low"}
DasTier.prototype.findNextFeature=function(a,b,c,d,e){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*c/2|0,this.featureSource.quantFindNextFeature(a,b,c,this.quantLeapThreshold,e);else{if(this.knownStart&&(b>=this.knownStart&&b<=this.knownEnd)&&this.currentFeatures){for(var h=null,j=0;j<this.currentFeatures.length;++j){var i=this.currentFeatures[j];if(i.min&&i.max&&!(i.parents&&0<i.parents.length))if(0>c)if(1==d&&i.max>=b&&i.min<b){if(!h||i.min>h.min||i.min==h.min&&
i.max<h.max)h=i}else{if(i.max<b&&(!h||i.max>h.max||i.max==h.max&&i.min<h.min||i.min==h.mmin&&h.max>=b))h=i}else if(1==d&&i.min<=b&&i.max>b){if(!h||i.max<h.max||i.max==h.max&&i.min>h.min)h=i}else if(i.min>b&&(!h||i.min<h.min||i.min==h.min&&i.max>h.max||i.max==h.max&&h.min<=b))h=i}if(h)return e(h);b=0>c?this.knownStart:this.knownEnd}this.featureSource.findNextFeature(a,b,c,e)}};
DasTier.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"icon-minus-sign":"icon-plus-sign";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};DasTier.prototype.updateHeight=function(){this.currentHeight=Math.max(this.holder.clientHeight,this.label.clientHeight+4);"none"!==this.placard.style.display&&(this.currentHeight=Math.max(this.currentHeight,this.placard.clientHeight+2));this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};
DasTier.prototype.drawOverlay=function(){var a=this.browser,b=this.overlay.getContext("2d");this.overlay.height=this.viewport.height;for(var c=a.viewStart-1E3/a.scale,d=a.viewStart-1E3/a.scale,e=a.viewEnd+1E3/a.scale,h=0;h<a.highlights.length;++h){var j=a.highlights[h];j.chr==a.chr&&(j.min<e&&j.max>d)&&(b.globalAlpha=0.3,b.fillStyle="red",b.fillRect((j.min-c)*a.scale,0,(j.max-j.min)*a.scale,this.overlay.height))}this.oorigin=a.viewStart;this.overlay.style.left="-1000px"};
Browser.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(sourcesAreEqual(this.tiers[b].dasSource,a))return!0;return!1};Browser.prototype.makeButton=function(a,b){var c=makeElement("a",a,{href:"#"});b&&this.makeTooltip(c,b);return makeElement("li",c)};function activateButton(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):d.classList.remove("active")}}
Browser.prototype.showTrackAdder=function(){function a(a){function b(){for(var a=0;a<j.length;++a){var c=j[a];c.checked=m.currentlyActive(c.dalliance_source)}}N.style.display="none";L.style.display="none";O.style.display="none";D=!1;removeChildren(z);for(var c=makeElement("div",null,{},{width:"100%"}),d=[],e=0;e<a.length;++e)d.push(a[e]);d.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});for(var a=[],h=[],e=0;e<d.length;++e){var i=d[e];
i.children&&0<i.children.length&&"multiWig"!=i.container?a.push(i):h.push(i)}0<h.length&&a.push({shortLabel:"Others",children:h});for(var j=[],d=0;d<a.length;++d){i=h=a[d];!i.dimensions&&(i._parent&&i._parent.dimensions)&&(i=i._parent);e={};if(i.dimensions)for(var l=i.dimensions.split(/(\w+)=(\w+)/),o=0;o<l.length-2;o+=3)e[l[o+1]]=l[o+2];if(e.dimX&&e.dimY){for(var p=e.dimX,q=e.dimY,e=i.subgroups[p],l=i.subgroups[q],o={},r=0;r<h.children.length;++r){var t=h.children[r],i=t.sgm[p],s=t.sgm[q];o[i]||
(o[i]={});o[i][s]=t}q=makeElement("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});i=makeElement("tr");i.appendChild(makeElement("th",null,{},{width:"150px",height:"100px"}));for(s=0;s<e.titles.length;++s)p=makeElement("th",makeElement("div",e.titles[s],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),
i.appendChild(p);q.appendChild(i);for(var u=makeElement("tbody",null,{className:"table table-striped table-condensed"}),v=0;v<l.titles.length;++v){var s=l.tags[v],w=makeElement("tr");w.appendChild(makeElement("th",l.titles[v]),{});for(var A=0;A<e.titles.length;++A){var i=e.tags[A],x=makeElement("td");if(o[i]&&o[i][s]){i=o[i][s];r=i.toDallianceSource();if(!r)continue;p=makeElement("tr");t=makeElement("td");t.style.textAlign="center";var y=makeElement("input");y.type="checkbox";y.dalliance_source=r;
K&&(y.dalliance_mapping=K);j.push(y);x.appendChild(y);y.addEventListener("change",function(a){a.target.checked?m.addTier(a.target.dalliance_source):m.removeTier(a.target.dalliance_source)})}w.appendChild(x)}u.appendChild(w)}q.appendChild(u);c.appendChild(makeTreeTableSection(h.shortLabel,q,0==d))}else{l=makeElement("tbody",null,{className:"table table-striped table-condensed"});o=makeElement("table",l,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});for(e=s=0;e<
h.children.length;++e)if(i=h.children[e],r=i.toDallianceSource())p=makeElement("tr"),t=makeElement("td",null,{},{width:"30px"}),t.style.textAlign="center",y=makeElement("input"),y.type="checkbox",y.dalliance_source=r,K&&(y.dalliance_mapping=K),j.push(y),t.appendChild(y),y.addEventListener("change",function(a){a.target.checked?m.addTier(a.target.dalliance_source):m.removeTier(a.target.dalliance_source)}),p.appendChild(t),q=makeElement("td"),q.appendChild(document.createTextNode(i.shortLabel)),i.longLabel&&
0<i.longLabel.length&&m.makeTooltip(q,i.longLabel),p.appendChild(q),l.appendChild(p),++s;c.appendChild(makeTreeTableSection(h.shortLabel,o,0==d))}}b();m.addTierListener(function(){b()});z.appendChild(c)}function b(){activateButton(q,x);D="bin";N.style.display="none";L.style.display="inline";O.style.display="none";removeChildren(z);if(m.supportsBinary){var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Add custom URL-based data"));a.appendChild(makeElement("p",
["You can add indexed binary data hosted on an web server that supports CORS (",makeElement("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(makeElement("br"));a.appendChild(document.createTextNode("URL: "));y=makeElement("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(y);a.appendChild(makeElement("br"));a.appendChild(makeElement("b","- or -"));
a.appendChild(makeElement("br"));a.appendChild(document.createTextNode("File: "));C=makeElement("input",null,{type:"file"});a.appendChild(C);a.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.'));z.appendChild(a);y.focus()}else z.appendChild(makeElement("h2","Your browser does not support binary data")),z.appendChild(makeElement("p","Browsers currently known to support this feature include Google Chrome 9 or later and Mozilla Firefox 4 or later."))}
function c(){activateButton(q,A);N.style.display="none";L.style.display="inline";O.style.display="none";D="hub-connect";N.style.visibility="hidden";removeChildren(z);var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Connect to a track hub."));a.appendChild(makeElement("p",['Enter the top-level URL (usually points to a file called "hub.txt" of a UCSC-style track hub']));y=makeElement("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},
{width:"100%"});a.appendChild(y);z.appendChild(a);y.focus()}function d(){activateButton(q,w);N.style.display="none";L.style.display="inline";O.style.display="none";D="das";removeChildren(z);var a=makeElement("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(makeElement("h3","Add custom DAS data"));a.appendChild(makeElement("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));
a.appendChild(makeElement("br"));y=makeElement("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(y);a.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));z.appendChild(a);y.focus()}function e(){if(D)if("das"===D){var e=y.value.trim();/^.+:\/\//.exec(e)||(e="http://"+e);var h=new DASSource({name:"temporary",uri:e});
R(h)}else if("bin"===D){var h={name:"temporary"},l=C.files;l&&0<l.length&&l[0]?(h.bwgBlob=l[0],h.noPersist=!0):(e=y.value.trim(),/^.+:\/\//.exec(e)||(e="http://"+e),h.bwgURI=e);h=new DASSource(h);Q(h)}else"reset"===D?d():"reset-bin"===D?b():"reset-hub"===D?c():"prompt-bai"===D?(l=C.files)&&0<l.length&&l[0]?(J.baiBlob=l[0],i(J)):j(J):"finalize"===D?(J.name=G.value,h=B.value,J.mapping="__default__"!=h?h:void 0,F&&(J.maxbins=F.checked),1<I.value.length&&1<M.value.length&&(dlog("password"),J.xUser=I.value,
J.xPass=M.value),m.addTier(J),d()):"hub-connect"===D&&(e=y.value.trim(),/^.+:\/\//.exec(e)||(e="http://"+e),console.log("hub: "+e),connectTrackHub(e,function(b,c){if(c)removeChildren(z),z.appendChild(makeElement("h2","Error connecting to track hub")),z.appendChild(makeElement("p",c)),D="reset-hub";else if(m.coordSystem.ucscName&&b.genomes[m.coordSystem.ucscName]){m.hubs.push(e);m.hubObjects.push(b);var d=u(b);E.appendChild(d);activateButton(q,d);b.genomes[m.coordSystem.ucscName].getTracks(function(b){a(b)})}else removeChildren(z),
z.appendChild(makeElement("h2","No data for this genome")),z.appendChild(makeElement("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),z.appendChild(makeElement("p","coordSystem.ucscName = "+m.coordSystem.ucscName)),D="reset-hub"}));else m.removeAllPopups()}function h(a,b){var c=a.uri;if(b){var d=/(.+)\/[^\/]+\/?/.exec(c);d&&(c=d[1]+"/sources")}(new DASRegistry(c,{credentials:a.credentials})).sources(function(c){if(!c||0==c.length)return b?
P(a):h(a,!0);var d=null;if(1==c.length)d=c[0];else for(var e=0;e<c.length;++e)if(c[e].uri===a.uri){d=c[e];break}e=c=!1;if(d&&(a.name=d.name,a.desc=d.desc,a.maxbins=d.maxbins?!0:!1,d.capabilities&&(a.capabilities=d.capabilities),e=!0,d.coords&&1==d.coords.length))if(d=d.coords[0],coordsMatch(d,m.coordSystem))c=!0;else if(m.chains)for(var i in m.chains)coordsMatch(d,m.chains[i].coords)&&(a.mapping=i,c=!0);return P(a,c,e)},function(){return b?P(a):h(a,!0)})}function j(a){N.style.display="none";L.style.display=
"inline";O.style.display="inline";removeChildren(z);D="prompt-bai";z.appendChild(makeElement("h2","Select an index file"));z.appendChild(makeElement("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file"));z.appendChild(document.createTextNode("Index file: "));
C=makeElement("input",null,{type:"file"});z.appendChild(C);J=a}function i(a){(a.baiBlob?new BlobFetchable(a.baiBlob):new URLFetchable(a.bwgURI+".bai")).slice(0,256).fetch(function(b){var c=!1;b&&(b=new Uint8Array(b),c=readInt(b,0)==BAI_MAGIC);if(c){if(b=/\/?([^/]+?)(.bam)?$/.exec(a.bwgURI||a.bwgBlob.name))a.name=b[1];a.bamURI=a.bwgURI;a.bamBlob=a.bwgBlob;a.bwgURI=void 0;a.bwgBlob=void 0;return P(a,!1,!1,!0)}return l("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}
function l(a){N.style.display="none";L.style.display="inline";O.style.display="inline";removeChildren(z);a=a||"Custom data format not recognized";z.appendChild(makeElement("h2","Error adding custom data"));z.appendChild(makeElement("p",a));z.appendChild(makeElement("p","Currently supported formats are bigBed, bigWig, and BAM."));D="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var m=this,o=makeElement("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",
boxSizing:"border-box",MozBoxSizing:"border-box",verticalAlign:"top"}),q=[],r,s,t=this.makeButton("Registry","Browse compatible datasources from the DAS registry");q.push(t);for(var p in this.mappableSources)(function(a){var b=m.makeButton(m.chains[a].srcTag,"Browse datasources mapped from "+m.chains[a].srcTag);q.push(b);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();activateButton(q,b);r(m.mappableSources[a],a)},!1)})(p);var u=function(b){if(m.coordSystem.ucscName&&
b.genomes[m.coordSystem.ucscName]){var d=makeElement("i",null,{className:"icon-remove"}),e=makeElement("span",[b.shortLabel," ",d]),h=m.makeButton(e,b.longLabel);q.push(h);h.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();b.genomes[m.coordSystem.ucscName].getTracks(function(b,c){c&&console.log(c);activateButton(q,h);a(b)})},!1);d.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();for(a=0;a<m.hubs.length;++a)if(m.hubs[a]==b.url){console.log("index "+
a);m.hubs.splice(a,1);break}for(a=0;a<m.hubObjects.length;++a)if(m.hubObjects[a].url==b.url){m.hubObjects.splice(a,1);break}E.removeChild(h);activateButton(q,A);c()},!1);return h}},v=this.makeButton("Defaults","Browse the default set of data for this browser");q.push(v);var w=this.makeButton("Custom","Add arbitrary DAS data");q.push(w);var x=this.makeButton("Binary","Add data in bigwig or bigbed format");q.push(x);for(p=0;p<this.hubObjects.length;++p)u(this.hubObjects[p]);var A=this.makeButton("+",
"Connect to a new track-hub");q.push(A);activateButton(q,t);var E=makeElement("ul",q,{className:"nav nav-tabs"},{marginBottom:"0px"});o.appendChild(E);var y,G,B,F,C,I,M,D=!1,J=null;p=makeElement("form",null,{},{display:"inline-block",width:"100%"});p.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();e();return!1},!0);var z=makeElement("div");z.style.position="relative";z.style.overflow="scroll";p.appendChild(z);var K,H;r=function(a,b){N.style.display="none";L.style.display=
"none";O.style.display="none";H&&H.removeListener(s);K=b;H=a;H.addListenerAndFire(s)};s=function(a){function b(){for(var a=0;a<c.length;++a){var d=c[a];d.checked=m.currentlyActive(d.dalliance_source)}}D=!1;var c=[];removeChildren(z);if(a){for(var d=makeElement("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),e=makeElement("table",d,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),h=0,i=[],j=0;j<a.length;++j)i.push(a[j]);i.sort(function(a,
b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(j=0;j<i.length;++j){var a=i[j],l=makeElement("tr"),o=makeElement("td",null,{},{width:"30px"});o.style.textAlign="center";if(!a.props||a.props.cors){var p=makeElement("input");p.type="checkbox";p.dalliance_source=a;K&&(p.dalliance_mapping=K);o.appendChild(p);c.push(p);p.addEventListener("change",function(a){a.target.checked?m.addTier(a.target.dalliance_source):m.removeTier(a.target.dalliance_source)})}else o.appendChild(document.createTextNode("!")),
m.makeTooltip(o,makeElement("span",["This data source isn't accessible because it doesn't support ",makeElement("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));l.appendChild(o);o=makeElement("td");o.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&m.makeTooltip(o,a.desc);l.appendChild(o);d.appendChild(l);++h}b();m.addTierListener(function(){b()});z.appendChild(e)}else z.appendChild(makeElement("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};
t.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();activateButton(q,t);r(m.availableSources)},!1);v.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();activateButton(q,v);r(new Observed(m.defaultSources))},!1);x.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();b()},!1);A.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c()},!1);w.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();
d()},!1);var L=makeElement("button","Add",{className:"btn btn-primary"});L.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();e()},!1);var R=function(a,b){var c=m.knownSpace;if(c){var d=Math.max(c.min,(c.min+c.max-100)/2)|0,c=new DASSegment(c.chr,d,Math.min(d+99,c.max));a.features(c,{},function(c,d){if(d)b?(removeChildren(z),z.appendChild(makeElement("h2","Custom data not found")),z.appendChild(makeElement("p","DAS uri: "+a.uri+" is not answering features requests")),D="reset"):
(dlog("retrying with credentials"),a.credentials=!0,R(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);h(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},Q=function(a){(a.bwgURI?new URLFetchable(a.bwgURI):new BlobFetchable(a.bwgBlob)).slice(0,65536).fetch(function(b,c){if(b){var d=new Uint8Array(b),e=readInt(d,0);if(e==BIG_WIG_MAGIC||e==BIG_BED_MAGIC){if(d=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/.exec(a.bwgURI||a.bwgBlob.name))a.name=d[1];return P(a,!1,!1,!0)}if(31!=
d[0]||139!=d[1])return l();d=unbgzf(b);d=new Uint8Array(d);e=readInt(d,0);return e==BAM_MAGIC?a.bwgBlob?j(a):i(a):l()}removeChildren(z);z.appendChild(makeElement("h2","Custom data not found"));a.bwgURI?z.appendChild(makeElement("p","Data URI: "+a.bwgURI+" is not accessible.")):z.appendChild(makeElement("p","File access failed, are you using an up-to-date browser?"));c&&z.appendChild(makeElement("p",""+c));z.appendChild(makeElement("p","If in doubt, please check that the server where the file is hosted supports CORS."));
D="reset-bin"})},P=function(a,b,c,d){N.style.display="none";L.style.display="inline";O.style.display="inline";removeChildren(z);z.appendChild(makeElement("h2","Add custom data: step 2"));z.appendChild(document.createTextNode("Label: "));G=makeElement("input","",{value:a.name});z.appendChild(G);I=makeElement("input","");M=makeElement("input","");z.appendChild(makeElement("br"));z.appendChild(makeElement("br"));z.appendChild(makeElement("h4","Coordinate system: "));B=makeElement("select",null);B.appendChild(makeElement("option",
m.coordSystem.auth+m.coordSystem.version,{value:"__default__"}));if(m.chains)for(var e in m.chains){var h=m.chains[e].coords;B.appendChild(makeElement("option",h.auth+h.version,{value:e}))}B.value=a.mapping||"__default__";z.appendChild(B);b?z.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):(z.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),z.appendChild(makeElement("p",
"If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));d||(z.appendChild(document.createTextNode("Quantitative: ")),F=makeElement("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(F.checked=a.maxbins),z.appendChild(F),c?z.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):z.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));
a.bwgBlob&&z.appendChild(makeElement("p",[makeElement("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));G.focus();D="finalize";J=a},O=makeElement("button","Cancel",{className:"btn"});O.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b()},!1);var N=makeElement("button","Refresh",{className:"btn"});N.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();m.queryRegistry(K)},
!1);this.makeTooltip(N,"Click to re-fetch data from the DAS registry");var S=makeElement("div",[L," ",O," ",N]);S.style.margin="10px";p.appendChild(S);o.appendChild(p);r(m.availableSources);this.showToolPanel(o);this.setUiMode("add")}};var TWOBIT_MAGIC=440477507;function TwoBitFile(){}
function makeTwoBit(a,b){var c=new TwoBitFile;c.data=a;c.data.slice(0,1024).fetch(function(a){if(!a)return b(null,"Couldn't access data");a=new Uint8Array(a);if(readInt(a,0)!=TWOBIT_MAGIC)return b(null,"Not a .2bit fie");var e=readInt(a,4);if(0!=e)return b(null,"Unsupported version "+e);c.seqCount=readInt(a,8);c.seqDict={};for(var e=16,h=0;h<c.seqCount;++h){for(var j=a[e++],i="",l=1;l<=j;++l)i+=String.fromCharCode(a[e++]);j=readInt(a,e);e+=4;c.seqDict[i]=new TwoBitSeq(c,j)}return b(c)})}
TwoBitFile.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};TwoBitFile.prototype.fetch=function(a,b,c,d){var e=this.getSeq(a);if(e)e.fetch(b,c,d);else return d(null,"Couldn't find "+a)};function TwoBitSeq(a,b){this.tbf=a;this.offset=b}
TwoBitSeq.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b._length=readInt(c,0);b.nBlockCnt=readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");for(var c=new Uint8Array(c),e=null,h=0;h<b.nBlockCnt;++h)var j=readInt(c,4*h),i=readInt(c,4*(h+b.nBlockCnt)),j=new Range(j,j+i-1),e=e?union(e,j):j;b.nBlocks=e;b.mBlockCnt=readInt(c,8*b.nBlockCnt);
b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var TWOBIT_TABLE=["T","C","A","G"];
TwoBitSeq.prototype.fetch=function(a,b,c){--a;--b;var d=this;this.init(function(e){if(e)return c(null,e);var h=a>>2,e=b+3>>2;if(0>h||e>d.seqLength)return c("Coordinates out of bounds: "+a+":"+b);d.tbf.data.slice(d.seqOffset+h,e-h).fetch(function(e){function i(a){for(;q<=a;){var b=q&3,c=l[(q>>2)-h];o+=TWOBIT_TABLE[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++q}}if(null==e)return c("SeqFetch failed");var l=new Uint8Array(e),e=[];if(d.nBlocks){var m=intersection(new Range(a,b),d.nBlocks);m&&(e=m.ranges())}for(var o=
"",q=a,m=0;m<e.length;++m){var r=e[m];if(q>r.min())throw"N mismatch...";for(q<r.min()&&i(r.min()-1);q<r.max();)o+="N",++q}q<b&&i(b);return c(o)})})};TwoBitSeq.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};var NUM_REGEXP=/[0-9]+/;function stringToNumbersArray(a){for(var b=[],c;c=NUM_REGEXP.exec(a);)b.push(c[0]),a=a.substring(c.index+c[0].length);return b}var STRICT_NUM_REGEXP=/^[0-9]+$/;
function stringToInt(a){a=a.replace(RegExp(",","g"),"");return!STRICT_NUM_REGEXP.test(a)?null:a|0}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function pusho(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function pushnewo(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==c)return;d.push(c)}else a[b]=[c]}function pick(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}
function maybeConcat(a,b){var c=[];if(a)for(var d=0;d<a.length;++d)pushnew(c,a[d]);if(b)for(d=0;d<b.length;++d)pushnew(c,b[d]);return c}function arrayIndexOf(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function arrayRemove(a,b){var c=arrayIndexOf(a,b);return 0<=c?(a.splice(c,1),!0):!1}
function makeElement(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var e=0;e<b.length;++e){var h=b[e];"string"==typeof h&&(h=document.createTextNode(h));a.appendChild(h)}}if(c)for(var j in c)a[j]=c[j];if(d)for(j in d)a.style[j]=d[j];return a}function makeElementNS(a,b,c,d){a=document.createElementNS(a,b);if(c){c instanceof Array||(c=[c]);for(b=0;b<c.length;++b){var e=c[b];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}}setAttrs(a,d);return a}
var attr_name_cache={};function setAttr(a,b,c){var d=attr_name_cache[b];if(!d){for(var d="",e=0;e<b.length;++e)var h=b.substring(e,e+1),j=h.toLowerCase(),d=j!=h?d+"-"+j:d+h;attr_name_cache[b]=d}a.setAttribute(d,c)}function setAttrs(a,b){if(b)for(var c in b)setAttr(a,c,b[c])}function removeChildren(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}
function miniJSONify(a,b){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var c=null,d=0;d<a.length;++d)c=(null==c?"":c+", ")+miniJSONify(a[d],b);return"["+(c?c:"")+"]"}b=b||{};c=null;for(d in a)b[d]||void 0!=d&&"function"!=typeof a[d]&&(c=(null==c?"":c+", ")+d+": "+miniJSONify(a[d],b));return"{"+(c?c:"")+"}"}return typeof a}
function shallowCopy(a){n={};for(k in a)n[k]=a[k];return n}function Observed(a){this.value=a;this.listeners=[]}Observed.prototype.addListener=function(a){this.listeners.push(a)};Observed.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};Observed.prototype.removeListener=function(a){arrayRemove(this.listeners,a)};Observed.prototype.get=function(){return this.value};Observed.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
function Awaited(){this.queue=[]}Awaited.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a)};Awaited.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};
function textXHR(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(300<=c.status?b(null,"Error code "+c.status):b(c.responseText))};c.open("GET",a,!0);c.responseType="text";c.send("")}function relativeURL(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,c+1)+b:b}"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
var VERSION={CONFIG:3,MAJOR:0,MINOR:10,MICRO:5,PATCH:"",BRANCH:"",toString:function(){var a=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(a=a+this.PATCH);this.BRANCH&&this.BRANCH!=""&&(a=a+"-"+this.BRANCH);return a}};function formatLongInt(a){return(a|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function parseLocCardinal(a,b){var c=a.replace(/,/g,"");return b==="k"||b==="K"?c*1E3:b=="m"||b==="M"?c*1E6:c}
Browser.prototype.initUI=function(a,b){document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/bootstrap-scoped.css"}));document.head.appendChild(makeElement("link","",{rel:"stylesheet",href:this.uiPrefix+"css/dalliance-scoped.css"}));var c=this,d=/([\d+,\w,\.,\_,\-]+):([0-9,]+)([KkMmGg])?([\-,\,.]+([0-9,]+)([KkMmGg])?)?/;c.disableDefaultFeaturePopup||this.addFeatureListener(function(a,b,d,e){c.featurePopup(a,b,d,e)});a.classList.add("dalliance");var e=makeElement("div",
null,{className:"btn-toolbar toolbar"}),h=c.coordSystem.speciesName+" "+c.coordSystem.auth+c.coordSystem.version;if(this.setDocumentTitle)document.title=h+" :: dalliance";var j=makeElement("input","",{className:"loc-field"});c.makeTooltip(j,"Enter a genomic location or gene name");var i=makeElement("p","",{className:"loc-status"}),l=makeElement("a",[makeElement("i",null,{className:"icon-zoom-in"})],{className:"btn"}),m=makeElement("input","",{type:"range",min:100,max:250},{className:"zoom-slider"}),
o=makeElement("a",[makeElement("i",null,{className:"icon-zoom-out"})],{className:"btn"}),q=makeElement("a",[makeElement("i",null,{className:"icon-plus"})],{className:"btn"}),r=makeElement("a",[makeElement("i",null,{className:"icon-bookmark"})],{className:"btn"}),s=makeElement("a",[makeElement("i",null,{className:"icon-print"})],{className:"btn"}),t=makeElement("a",[makeElement("i",null,{className:"icon-refresh"})],{className:"btn"}),p=makeElement("div",[makeElement("i",null,{className:"icon-cog"})],
{className:"btn"}),u=makeElement("div",[makeElement("i",null,{className:"icon-info-sign"})],{className:"btn"}),v=makeElement("div",[q,p,u],{className:"btn-group pull-right"});this.setUiMode=function(a){this.uiMode=a;var b={help:u,add:q,opts:p},c;for(c in b)c==a?b[c].classList.add("active"):b[c].classList.remove("active")};e.appendChild(v);this.noTitle||e.appendChild(makeElement("div",makeElement("h4",h,{},{margin:"0px"}),{className:"btn-group title"}));e.appendChild(makeElement("div",[j,i],{className:"btn-group loc-group"}));
e.appendChild(makeElement("div",[l,makeElement("span",m,{className:"btn"}),o],{className:"btn-group"}));e.appendChild(makeElement("div",[s,t],{className:"btn-group"}));a.appendChild(e);a.appendChild(b);this.addViewListener(function(a,b,d,e,h){j.value="";j.placeholder="chr"+a+":"+formatLongInt(b)+".."+formatLongInt(d);m.min=h.min;m.max=h.max;m.value=h.current;c.storeStatus&&c.storeViewStatus()});this.addTierListener(function(){c.storeStatus&&c.storeTierStatus()});j.addEventListener("keydown",function(a){if(a.keyCode==
40){a.preventDefault();a.stopPropagation();c.setSelectedTier(0)}if(a.keyCode==10||a.keyCode==13){a.preventDefault();var b=j.value,e=d.exec(b),h=function(a){i.innerText=a?""+a:""};if(e){var a=e[1],l;if(e[5]){l=parseLocCardinal(e[2],e[3]);e=parseLocCardinal(e[5],e[6])}else{var m=c.viewEnd-c.viewStart+1;l=parseLocCardinal(e[2],e[3])-m/2|0;e=l+m-1}c.setLocation(a,l,e,h)}else{if(!b||b.length==0)return false;c.searchEndpoint.features(null,{group:b,type:"transcript"},function(a){a||(a=[]);for(var d=5E8,
e=-1E8,j=null,l=0;l<a.length;++l){var m=a[l];if(m.label.toLowerCase()==b.toLowerCase()){if(j==null)j=m.segment;d=Math.min(d,m.min);e=Math.max(e,m.max)}}if(j){c.highlightRegion(j,d,e);a=Math.max(2500,0.3*(e-d+1)|0);c.setLocation(j,d-a,e+a,h)}else i.innerText="no match for '"+b+"' (search should improve soon!)"},false)}}},false);this.addRegionSelectListener(function(){});this.addTierListener(function(){c.storeStatus&&c.storeStatus()});var w;q.addEventListener("click",function(a){w&&w.displayed?c.removeAllPopups():
w=c.showTrackAdder(a)},false);c.makeTooltip(q,"Add a new track from the registry or an indexed file.");l.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(-10)},false);c.makeTooltip(l,"Zoom in");o.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.zoomStep(10)},false);c.makeTooltip(o,"Zoom out");m.addEventListener("change",function(){c.zoomSliderValue=1*m.value;c.zoom(Math.exp(1*m.value/c.zoomExpt))},false);m.min=c.zoomMin;m.max=c.zoomMax;
r.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},false);c.makeTooltip(r,"Favourite regions");s.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.saveSVG()},false);c.makeTooltip(s,"Export publication-quality SVG.");t.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=c.tiers.length-1;a>=0;--a)c.removeTier({index:a});for(a=0;a<c.defaultSources.length;++a)c.addTier(c.defaultSources[a]);c.setLocation(c.defaultChr,
c.defaultStart,c.defaultEnd)},false);c.makeTooltip(t,"Reset to default tracks and view.");p.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleOptsPopup(a)},false);c.makeTooltip(p,"Configure options.");u.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();c.toggleHelpPopup(a)});c.makeTooltip(u,"Help; Keyboard shortcuts.");c.addTierSelectionWrapListener(function(a){if(a<0){c.setSelectedTier(null);j.focus()}});var x=function(a){if(a.keyCode==
65||a.keyCode==97){a.preventDefault();a.stopPropagation();c.showTrackAdder()}else if(a.keyCode==72||a.keyCode==104){a.stopPropagation();a.preventDefault();c.toggleHelpPopup(a)}};a.addEventListener("focus",function(){a.addEventListener("keydown",x,false)},false);a.addEventListener("blur",function(){a.removeEventListener("keydown",x,false)},false)};
Browser.prototype.showToolPanel=function(a,b){this.activeToolPanel&&this.svgHolder.removeChild(this.activeToolPanel);var c;c=b?a:makeElement("div",a,{},{overflowY:"auto",width:"100%"});this.activeToolPanel=makeElement("div",[makeElement("div",null,{className:"tool-divider"}),c],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer()};
Browser.prototype.hideToolPanel=function(){this.svgHolder.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};Browser.prototype.toggleHelpPopup=function(){if(this.uiMode==="help"){this.hideToolPanel();this.setUiMode("none")}else{this.showToolPanel(makeElement("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.uiPrefix+"help/index.html",seamless:"seamless",className:"help-panel"}),true);this.setUiMode("help")}};
Browser.prototype.toggleOptsPopup=function(){var a=this;if(this.uiMode==="opts"){this.hideToolPanel();this.setUiMode("none")}else{var b=makeElement("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"}),c=makeElement("table");c.cellPadding=5;var d=makeElement("input","",{type:"checkbox",checked:a.reverseScrolling});d.addEventListener("change",function(){a.reverseScrolling=d.checked},false);c.appendChild(makeElement("tr",
[makeElement("td","Reverse trackpad scrolling",{align:"right"}),makeElement("td",d)]));var e=makeElement("select");e.appendChild(makeElement("option","Left",{value:"left"}));e.appendChild(makeElement("option","Center",{value:"center"}));e.appendChild(makeElement("option","Right",{value:"right"}));e.appendChild(makeElement("option","None",{value:"none"}));e.value=a.rulerLocation;e.addEventListener("change",function(){a.rulerLocation=e.value;a.positionRuler();for(var b=0;b<a.tiers.length;++b)a.tiers[b].paintQuant()},
false);c.appendChild(makeElement("tr",[makeElement("td","Vertical guideline",{align:"right"}),makeElement("td",e)]));b.appendChild(c);this.showToolPanel(b);this.setUiMode("opts")}};function BoxGlyph(a,b,c,d,e,h,j,i){this.x=a;this.y=b;this._width=c;this._height=d;this.fill=e;this.stroke=h;this._alpha=j;this._radius=i||0}
BoxGlyph.prototype.draw=function(a){var b=this._radius;a.beginPath();if(b>0){a.moveTo(this.x+b,this.y);a.lineTo(this.x+this._width-b,this.y);a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b);a.lineTo(this.x+this._width,this.y+this._height-b);a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,b);a.lineTo(this.x+b,this.y+this._height);a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b);a.lineTo(this.x,this.y+b);a.arcTo(this.x,this.y,
this.x+b,this.y,b)}else{a.lineJoin="miter";a.lineCap="square";a.moveTo(this.x,this.y);a.lineTo(this.x+this._width,this.y);a.lineTo(this.x+this._width,this.y+this._height);a.lineTo(this.x,this.y+this._height);a.lineTo(this.x,this.y)}a.closePath();if(this._alpha!=null){a.save();a.globalAlpha=this._alpha}if(this.fill){a.fillStyle=this.fill;a.fill()}if(this.stroke){a.strokeStyle=this.stroke;a.lineWidth=0.5;a.stroke()}this._alpha!=null&&a.restore()};
BoxGlyph.prototype.toSVG=function(){var a=makeElementNS(NS_SVG,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});this._alpha!=null&&a.setAttribute("opacity",this._alpha);return a};BoxGlyph.prototype.min=function(){return this.x};BoxGlyph.prototype.max=function(){return this.x+this._width};BoxGlyph.prototype.height=function(){return this.y+this._height};
function GroupGlyph(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();var c=new Range(a[0].min(),a[0].max());for(g=1;g<a.length;++g){var d=a[g],c=union(c,new Range(d.min(),d.max()));this.h=Math.max(this.h,d.height())}this.coverage=c}
GroupGlyph.prototype.draw=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];c.draw(a)}for(var b=this.coverage.ranges(),d=1;d<b.length;++d){var c=b[d],e=b[d-1];if(e&&c.min()>e.max()){var e=e.max(),c=c.min(),h=(e+c)/2;a.beginPath();if(this.connector==="hat+"){a.moveTo(e,this.h/2);a.lineTo(h,0);a.lineTo(c,this.h/2)}else if(this.connector==="hat-"){a.moveTo(e,this.h/2);a.lineTo(h,this.h);a.lineTo(c,this.h/2)}else if(this.connector==="collapsed+"){a.moveTo(e,this.h/2);a.lineTo(c,this.h/
2);if(c-e>4){a.moveTo(h-2,this.h/2-5);a.lineTo(h+2,this.h/2);a.lineTo(h-2,this.h/2+5)}}else if(this.connector==="collapsed-"){a.moveTo(e,this.h/2);a.lineTo(c,this.h/2);if(c-e>4){a.moveTo(h+2,this.h/2-5);a.lineTo(h-2,this.h/2);a.lineTo(h+2,this.h/2+5)}}else{a.moveTo(e,this.h/2);a.lineTo(c,this.h/2)}a.stroke()}}};function SVGPath(){this.ops=[]}SVGPath.prototype.moveTo=function(a,b){this.ops.push("M "+a+" "+b)};SVGPath.prototype.lineTo=function(a,b){this.ops.push("L "+a+" "+b)};
SVGPath.prototype.closePath=function(){this.ops.push("Z")};SVGPath.prototype.toPathData=function(){return this.ops.join(" ")};
GroupGlyph.prototype.toSVG=function(){for(var a=makeElementNS(NS_SVG,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());for(var b=this.coverage.ranges(),c=1;c<b.length;++c){var d=b[c],e=b[c-1];if(e&&d.min()>e.max()){var e=e.max(),d=d.min(),h=(e+d)/2,j=new SVGPath;if(this.connector==="hat+"){j.moveTo(e,this.h/2);j.lineTo(h,0);j.lineTo(d,this.h/2)}else if(this.connector==="hat-"){j.moveTo(e,this.h/2);j.lineTo(h,this.h);j.lineTo(d,this.h/2)}else if(this.connector==="collapsed+"){j.moveTo(e,
this.h/2);j.lineTo(d,this.h/2);if(d-e>4){j.moveTo(h-2,this.h/2-5);j.lineTo(h+2,this.h/2);j.lineTo(h-2,this.h/2+5)}}else if(this.connector==="collapsed-"){j.moveTo(e,this.h/2);j.lineTo(d,this.h/2);if(d-e>4){j.moveTo(h+2,this.h/2-5);j.lineTo(h-2,this.h/2);j.lineTo(h+2,this.h/2+5)}}else{j.moveTo(e,this.h/2);j.lineTo(d,this.h/2)}e=makeElementNS(NS_SVG,"path",null,{d:j.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5});a.appendChild(e)}}return a};GroupGlyph.prototype.min=function(){return this.coverage.min()};
GroupGlyph.prototype.max=function(){return this.coverage.max()};GroupGlyph.prototype.height=function(){return this.h};function LineGraphGlyph(a,b,c){this.points=a;this.color=b;this._height=c||50}LineGraphGlyph.prototype.min=function(){return this.points[0]};LineGraphGlyph.prototype.max=function(){return this.points[this.points.length-2]};LineGraphGlyph.prototype.height=function(){return this._height};
LineGraphGlyph.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b=b+2){var c=this.points[b],d=this.points[b+1];b==0?a.moveTo(c,d):a.lineTo(c,d)}a.stroke();a.restore()};LineGraphGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<this.points.length;b=b+2){var c=this.points[b],d=this.points[b+1];b==0?a.moveTo(c,d):a.lineTo(c,d)}return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};
function LabelledGlyph(a,b){this.glyph=a;this.text=b;this.textLen=GLOBAL_GC.measureText(b).width+10;this.bump=a.bump}LabelledGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"g",[this.glyph.toSVG(),makeElementNS(NS_SVG,"text",this.text,{x:this.glyph.min(),y:this.glyph.height()+15})])};LabelledGlyph.prototype.min=function(){return this.glyph.min()};LabelledGlyph.prototype.max=function(){return Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen)};
LabelledGlyph.prototype.height=function(){return this.glyph.height()+20};LabelledGlyph.prototype.draw=function(a){this.glyph.draw(a);a.fillStyle="black";a.fillText(this.text,this.glyph.min(),this.glyph.height()+15)};function CrossGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}CrossGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};
CrossGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};CrossGlyph.prototype.min=function(){return this._x-this._height/2};CrossGlyph.prototype.max=function(){return this._x+this._height/2};CrossGlyph.prototype.height=function(){return this._height};
function ExGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}ExGlyph.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};
ExGlyph.prototype.toSVG=function(){var a=this._height/2,b=new SVGPath;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};ExGlyph.prototype.min=function(){return this._x-this._height/2};ExGlyph.prototype.max=function(){return this._x+this._height/2};ExGlyph.prototype.height=function(){return this._height};
function TriangleGlyph(a,b,c,d,e){this._x=a;this._height=b;this._dir=c;this._width=d;this._stroke=e}
TriangleGlyph.prototype.drawPath=function(a){var b=this._height/2,c=this._width/2;if(this._dir==="S"){a.moveTo(this._x,this._height);a.lineTo(this._x-c,0);a.lineTo(this._x+c,0)}else if(this._dir==="W"){a.moveTo(this._x+c,b);a.lineTo(this._x-c,0);a.lineTo(this._x-c,this._height)}else if(this._dir==="E"){a.moveTo(this._x-c,b);a.lineTo(this._x+c,0);a.lineTo(this._x+c,this._height)}else{a.moveTo(this._x,0);a.lineTo(this._x+c,this._height);a.lineTo(this._x-c,this._height)}a.closePath()};
TriangleGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.fillStyle=this._stroke;a.fill()};TriangleGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._stroke})};TriangleGlyph.prototype.min=function(){return this._x-this._height/2};TriangleGlyph.prototype.max=function(){return this._x+this._height/2};TriangleGlyph.prototype.height=function(){return this._height};
function DotGlyph(a,b,c){this._x=a;this._height=b;this._stroke=c}DotGlyph.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);a.fill()};DotGlyph.prototype.toSVG=function(){var a=this._height/2;return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:a,r:a,fill:this._stroke,strokeWidth:"1px"})};DotGlyph.prototype.min=function(){return this._x-this._height/2};DotGlyph.prototype.max=function(){return this._x+this._height/2};
DotGlyph.prototype.height=function(){return this._height};function PaddedGlyph(a,b,c){this.glyph=a;this._min=b;this._max=c;if(a)this.bump=a.bump}PaddedGlyph.prototype.draw=function(a){this.glyph&&this.glyph.draw(a)};PaddedGlyph.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():makeElementNS(NS_SVG,"g")};PaddedGlyph.prototype.min=function(){return this._min};PaddedGlyph.prototype.max=function(){return this._max};
PaddedGlyph.prototype.height=function(){return this.glyph?this.glyph.height():1};function AArrowGlyph(a,b,c,d,e,h){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e;this._ori=h}AArrowGlyph.prototype.min=function(){return this._min};AArrowGlyph.prototype.max=function(){return this._max};AArrowGlyph.prototype.height=function(){return this._height};
AArrowGlyph.prototype.makePath=function(a){var b=this._max,c=this._min,d=this._height,e=0,h=0,j=this._height+2,i=0.333333*this._height;this._ori&&(this._ori==="+"?h=0.5*this._height:this._ori==="-"&&(e=0.5*this._height));if(b-c<j){c=(b+c-j)/2;b=c+j}a.moveTo(c+e,0+i);a.lineTo(b-h,0+i);a.lineTo(b-h,0);a.lineTo(b,0+this._height/2);a.lineTo(b-h,0+d);a.lineTo(b-h,0+i+i);a.lineTo(c+e,0+i+i);a.lineTo(c+e,0+d);a.lineTo(c,0+d/2);a.lineTo(c+e,0);a.lineTo(c+e,0+i)};
AArrowGlyph.prototype.draw=function(a){a.beginPath();this.makePath(a);if(this._fill){a.fillStyle=this._fill;a.fill()}if(this._stroke){a.strokeStyle=this._stroke;a.stroke()}};AArrowGlyph.prototype.toSVG=function(){var a=new SVGPath;this.makePath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};function SpanGlyph(a,b,c,d){this._min=a;this._max=b;this._height=c;this._stroke=d}SpanGlyph.prototype.min=function(){return this._min};
SpanGlyph.prototype.max=function(){return this._max};SpanGlyph.prototype.height=function(){return this._height};SpanGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,e);a.lineTo(c,e);a.moveTo(b,0);a.lineTo(b,d);a.moveTo(c,0);a.lineTo(c,d)};SpanGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;a.stroke()};
SpanGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"})};function LineGlyph(a,b,c,d,e,h){this._min=a;this._max=b;this._height=c;this._style=d;this._strand=e;this._stroke=h}LineGlyph.prototype.min=function(){return this._min};LineGlyph.prototype.max=function(){return this._max};LineGlyph.prototype.height=function(){return this._height};
LineGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;if(this._style==="hat"){a.moveTo(b,e);a.lineTo((b+c)/2,this._strand==="-"?d:0)}else a.moveTo(b,e);a.lineTo(c,e)};LineGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;if(this._style==="dashed"&&a.setLineDash){a.save();a.setLineDash([3]);a.stroke();a.restore()}else a.stroke()};
LineGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};this._style==="dashed"&&(a.strokeDasharray="3");return makeElementNS(NS_SVG,"path",null,a)};function PrimersGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}PrimersGlyph.prototype.min=function(){return this._min};PrimersGlyph.prototype.max=function(){return this._max};PrimersGlyph.prototype.height=function(){return this._height};
PrimersGlyph.prototype.drawStemPath=function(a){var b=this._max,c=this._height/2;a.moveTo(this._min,c);a.lineTo(b,c)};PrimersGlyph.prototype.drawTrigsPath=function(a){var b=this._min,c=this._max,d=this._height,e=d/2;a.moveTo(b,0);a.lineTo(b+d,e);a.lineTo(b,d);a.lineTo(b,0);a.moveTo(c,0);a.lineTo(c-d,e);a.lineTo(c,d);a.lineTo(c,0)};
PrimersGlyph.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};PrimersGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawStemPath(a);var b=new SVGPath;this.drawTrigsPath(b);return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),makeElementNS(NS_SVG,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};
function ArrowGlyph(a,b,c,d,e,h,j){this._min=a;this._max=b;this._height=c;this._color=d;this._parallel=e;this._sw=h;this._ne=j}ArrowGlyph.prototype.min=function(){return this._min};ArrowGlyph.prototype.max=function(){return this._max};ArrowGlyph.prototype.height=function(){return this._height};
ArrowGlyph.prototype.drawPath=function(a){var b=this._min,c=this._max,d=this._height;if(this._parallel){var e=d/2,h=0.4*d;if(this._sw){a.moveTo(b+e,d-h);a.lineTo(b+e,d);a.lineTo(b,e);a.lineTo(b+e,0);a.lineTo(b+e,h)}else{a.moveTo(b,d-h);a.lineTo(b,h)}if(this._ne){a.lineTo(c-e,h);a.lineTo(c-e,0);a.lineTo(c,e);a.lineTo(c-e,d);a.lineTo(c-e,d-h)}else{a.lineTo(c,h);a.lineTo(c,d-h)}}else{var e=(b+c)/2,h=0.4*(c-b),j=d/3;if(this._ne){a.moveTo(b+h,j);a.lineTo(b,j);a.lineTo(e,0);a.lineTo(c,j);a.lineTo(c-h,j)}else{a.moveTo(b+
h,0);a.lineTo(c-h,0)}if(this._sw){a.lineTo(c-h,d-j);a.lineTo(c,d-j);a.lineTo(e,d);a.lineTo(b,d-j);a.lineTo(b+h,d-j)}else{a.lineTo(c-h,d);a.lineTo(b+h,d)}}a.closePath()};ArrowGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.fillStyle=this._color;a.fill()};ArrowGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._color})};
function TooManyGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._stroke=e}TooManyGlyph.prototype.min=function(){return this._min};TooManyGlyph.prototype.max=function(){return this._max};TooManyGlyph.prototype.height=function(){return this._height};TooManyGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};
TooManyGlyph.prototype.draw=function(a){if(this._fill){a.fillStyle=this._fill;a.fillRect(this._min,0,this._max-this._min,this._height)}if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var b=2;b<this._height;b=b+3){a.moveTo(this._min,b);a.lineTo(this._max,b)}a.stroke()}};function TextGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._fill=d;this._string=e;this._textLen=GLOBAL_GC.measureText(e).width}
TextGlyph.prototype.min=function(){return this._min};TextGlyph.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};TextGlyph.prototype.height=function(){return this._height};TextGlyph.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};TextGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"text",this._string,{x:this._min,y:this._height-4})};
function SequenceGlyph(a,b,c,d,e){this._min=a;this._max=b;this._height=c;this._seq=d;this._ref=e}SequenceGlyph.prototype.min=function(){return this._min};SequenceGlyph.prototype.max=function(){return this._max};SequenceGlyph.prototype.height=function(){return this._height};
SequenceGlyph.prototype.draw=function(a){for(var b=this._seq,c=(this._max-this._min+1)/this._seq.length,d=0;d<b.length;++d){var e=b.substr(d,1).toUpperCase(),h=baseColors[e];h||(h="gray");a.fillStyle=h;c>=8?a.fillText(e,this._min+d*c,8):a.fillRect(this._min+d*c,0,c,this._height)}};
SequenceGlyph.prototype.toSVG=function(){for(var a=this._seq,b=(this._max-this._min+1)/this._seq.length,c=makeElementNS(NS_SVG,"g"),d=0;d<a.length;++d){var e=a.substr(d,1).toUpperCase(),h=baseColors[e];h||(h="gray");b>=8?c.appendChild(makeElementNS(NS_SVG,"text",e,{x:this._min+d*b,y:8,fill:h})):c.appendChild(makeElementNS(NS_SVG,"rect",null,{x:this._min+d*b,y:0,width:b,height:this._height,fill:h}))}return c};function TranslatedGlyph(a,b,c,d){this.glyph=a;this._height=d;this._x=b;this._y=c}
TranslatedGlyph.prototype.height=function(){return this._height};TranslatedGlyph.prototype.min=function(){return this.glyph.min()+this._x};TranslatedGlyph.prototype.max=function(){return this.glyph.max()+this._x};TranslatedGlyph.prototype.draw=function(a){a.save();a.translate(this._x,this._y);this.glyph.draw(a);a.restore()};TranslatedGlyph.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};
function PointGlyph(a,b,c,d){this._x=a;this._y=b;this._height=c;this._fill=d}PointGlyph.prototype.min=function(){return this._x-2};PointGlyph.prototype.max=function(){return this._x+2};PointGlyph.prototype.height=function(){return this._height};PointGlyph.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};
PointGlyph.prototype.toSVG=function(){return makeElementNS(NS_SVG,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};function GridGlyph(a){this._height=a||50}GridGlyph.prototype.notSelectable=!0;GridGlyph.prototype.min=function(){return-1E5};GridGlyph.prototype.max=function(){return 1E5};GridGlyph.prototype.height=function(){return this._height};
GridGlyph.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=0;b<=this._height;b=b+10){a.moveTo(-5E3,b);a.lineTo(5E3,b)}a.stroke();a.restore()};GridGlyph.prototype.toSVG=function(){for(var a=new SVGPath,b=0;b<=this._height;b=b+10){a.moveTo(-5E3,b);a.lineTo(5E3,b)}return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};
function StarGlyph(a,b,c,d,e){this._x=a;this._r=b;this._points=c;this._fill=d;this._stroke=e}StarGlyph.prototype.min=function(){return this._x-this._r};StarGlyph.prototype.max=function(){return this._x+this._r};StarGlyph.prototype.height=function(){return 2*this._r};
StarGlyph.prototype.drawPath=function(a){for(var b=this._x,c=this._r,d=this._r,e=0;e<this._points;++e){var h=e*6.28/this._points,j=b+d*Math.sin(h),h=c-d*Math.cos(h);e==0?a.moveTo(j,h):a.lineTo(j,h);h=(e+0.5)*6.28/this._points;j=b+0.4*d*Math.sin(h);h=c-0.4*d*Math.cos(h);a.lineTo(j,h)}a.closePath()};StarGlyph.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.fillStyle=this._fill;a.fill()};
StarGlyph.prototype.toSVG=function(){var a=new SVGPath;this.drawPath(a);return makeElementNS(NS_SVG,"path",null,{d:a.toPathData(),fill:this._fill})};
Browser.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};
Browser.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};Browser.prototype.storeViewStatus=function(){if(this.cookieKey&&!this.noPersist){localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr;localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0;localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0;if(this.currentSeqMax)localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax}};
Browser.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var a=[],b=0;b<this.tiers.length;++b)this.tiers[b].dasSource.noPersist||a.push(this.tiers[b].dasSource);localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(a);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(this.hubs);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+
this.cookieKey+".version"]=VERSION.CONFIG}};
Browser.prototype.restoreStatus=function(){if(!this.noPersist){var a=localStorage["dalliance."+this.cookieKey+".version"];if(VERSION.CONFIG==(a?a|0:-100)){var a=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=hex_sha1(miniJSONify({sources:this.sources,hubs:this.hubs}));if(b!=a)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{a={};for(b=0;b<this.sources.length;++b){var c=this.sources[b];a[hex_sha1(miniJSONify(c))]=c}var b=localStorage["dalliance."+this.cookieKey+".view-chr"],
c=localStorage["dalliance."+this.cookieKey+".view-start"]|0,d=localStorage["dalliance."+this.cookieKey+".view-end"]|0;if(b&&c&&d){this.chr=b;this.viewStart=c;this.viewEnd=d;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&b=="true";if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){this.sources=
JSON.parse(b);for(b=0;b<this.sources.length;++b){c=this.sources[b];d=hex_sha1(miniJSONify(c,{props:true,coords:true}));if((d=a[d])&&d.featureInfoPlugin)c.featureInfoPlugin=d.featureInfoPlugin}}if(a=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(a)}}}};
DasTier.prototype.initSources=function(){var a=new DummyFeatureSource,b;this.dasSource.tier_type=="sequence"?b=this.dasSource.twoBitURI?new TwoBitSequenceSource(this.dasSource):new DASSequenceSource(this.dasSource):a=this.browser.createFeatureSource(this.dasSource);this.featureSource=a;this.sequenceSource=b};
Browser.prototype.createFeatureSource=function(a){var b=this.sourceCache.get(a);if(b)return b;if(a.bwgURI||a.bwgBlob)b=new BWGFeatureSource(a);else if(a.bamURI||a.bamBlob)b=new BAMFeatureSource(a);else if(a.bamblrURI)b=new BamblrFeatureSource(a);else if(a.jbURI)b=new JBrowseFeatureSource(a);else if(a.tier_type=="ensembl")b=new EnsemblFeatureSource(a);else if(a.uri||a.features_uri)b=new DASFeatureSource(a);if(a.overlay){var c=[];b&&c.push(b);for(b=0;b<a.overlay.length;++b)c.push(this.createFeatureSource(a.overlay[b]));
b=new OverlayFeatureSource(c,a)}a.mapping&&(b=new MappedFeatureSource(b,this.chains[a.mapping]));if(a.name&&!b.name)b.name=a.name;if(b!=null){b=new CachingFeatureSource(b);this.sourceCache.put(a,b)}return b};function SourceCache(){this.sourcesByURI={}}SourceCache.prototype.get=function(a){var b=this.sourcesByURI[sourceDataURI(a)];if(b)for(var c=0;c<b.configs.length;++c)if(sourcesAreEqual(b.configs[c],a))return b.sources[c]};
SourceCache.prototype.put=function(a,b){var c=sourceDataURI(a),d=this.sourcesByURI[c];if(!d){d={configs:[],sources:[]};this.sourcesByURI[c]=d}d.configs.push(a);d.sources.push(b)};var __cfs_id_seed=0;function CachingFeatureSource(a){this.source=a;this.cfsid="cfs"+ ++__cfs_id_seed;if(a.name)this.name=a.name}CachingFeatureSource.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};CachingFeatureSource.prototype.getScales=function(){return this.source.getScales()};
CachingFeatureSource.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};CachingFeatureSource.prototype.findNextFeature=function(a,b,c,d){this.source.findNextFeature(a,b,c,d)};CachingFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){this.source.quantFindNextFeature(a,b,c,d,e)};CachingFeatureSource.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};
CachingFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){var i=h.awaitedFeatures[this.cfsid];if(!i){i=new Awaited;h.awaitedFeatures[this.cfsid]=i;this.source.fetch(a,b,c,d,e,h,function(a,b,c){i.res||i.provide({status:a,features:b,scale:c})})}i.await(function(a){j(a.status,a.features,a.scale)})};function DASFeatureSource(a){this.dasSource=a;this.busy=0;this.activityListeners=[]}DASFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
DASFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};DASFeatureSource.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};
DASFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){if(e&&e.length==0)j(null,[],d);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return j(null,this.cachedStaticFeatures,this.cachedStaticScale);var i=this.dasSource.maxbins!==false,e={type:e};if(i)e.maxbins=1+((c-b)/d|0);var l=this;l.busy++;l.notifyActivity();this.dasSource.features(new DASSegment(a,b,c),e,function(a,b){l.busy--;l.notifyActivity();var c=d;i||(c=0.1);if(!b&&
l.dasSource.dasStaticFeatures){l.cachedStaticFeatures=a;l.cachedStaticScale=c}j(b,a,c)})}};
DASFeatureSource.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,c,d){if(this.dasSource.capabilities&&arrayIndexOf(this.dasSource.capabilities,"das1:adjacent-feature")>=0){var e=this;if(this.dasAdjLock)return dlog("Already looking for a next feature, be patient!");this.dasAdjLock=true;a={adjacent:a+":"+(b|0)+":"+(c>0?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=b;thisTier.dasSource.features(null,a,function(a){e.dasAdjLock=false;if(a.length>0&&a[0]!=null){dlog("DAS adjacent seems to be working...");
d(a[0])}})}};function DASSequenceSource(a){this.dasSource=a;this.awaitedEntryPoints=new Awaited;var b=this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}DASSequenceSource.prototype.fetch=function(a,b,c,d,e){this.dasSource.sequence(new DASSegment(a,b,c),function(a){return a.length==1?e(null,a[0]):e("Didn't get sequence")})};
DASSequenceSource.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(c){for(var d=0;d<c.length;++d)if(c[d].name==a)return b({length:c[d].end});return b()})};function TwoBitSequenceSource(a){var b=this;this.source=a;this.twoBit=new Awaited;makeTwoBit(new URLFetchable(a.twoBitURI),function(a,d){d?dlog(d):b.twoBit.provide(a)})}
TwoBitSequenceSource.prototype.fetch=function(a,b,c,d,e){this.twoBit.await(function(d){d.fetch(a,b,c,function(d,h){if(h)return e(h,null);var l=new DASSequence(a,b,c,"DNA",d);return e(null,l)})})};TwoBitSequenceSource.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(c){c.getSeq(a)?c.getSeq(a).length(function(a){b({length:a})}):b()})};DASFeatureSource.prototype.getScales=function(){return[]};var bwg_preflights={};
function BWGFeatureSource(a){var b=this;this.bwgSource=this.opts=a;b.bwgHolder=new Awaited;this.busy=0;this.activityListeners=[];if(this.opts.preflight){var c=bwg_preflights[this.opts.preflight];if(!c){c=new Awaited;bwg_preflights[this.opts.preflight]=c;var d=new XMLHttpRequest;d.onreadystatechange=function(){d.readyState==4&&(d.status==200?c.provide("success"):c.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),true);if(this.opts.credentials)d.withCredentials=
true;d.send("")}c.await(function(a){a==="success"&&b.init()})}else b.init()}BWGFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};BWGFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
BWGFeatureSource.prototype.init=function(){var a=this,b,c;if(this.bwgSource.bwgURI){b=makeBwgFromURL;c=this.bwgSource.bwgURI}else{b=makeBwgFromFile;c=this.bwgSource.bwgBlob}b(c,function(b){a.bwgHolder.provide(b)},this.opts.credentials)};BWGFeatureSource.prototype.capabilities=function(){var a={leap:true};if(this.bwgHolder.res&&this.bwgHolder.res.type=="bigwig")a.quantLeap=true;return a};
BWGFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){var i=this;this.bwgHolder.await(function(h){if(h==null)return j("Can't access binary file",null,null);var m;m=!e||e.length==0||arrayIndexOf(e,"density")>=0;i.opts.clientBin&&(m=false);if(h.type=="bigwig"||m||typeof i.opts.forceReduction!=="undefined"){m=-1;for(var o=0;o<h.zoomLevels.length;++o)if(h.zoomLevels[o].reduction<=d)m=o;else break;if(typeof i.opts.forceReduction!=="undefined")m=i.opts.forceReduction;m=m<0?h.getUnzoomedView():h.getZoomedView(m)}else m=
h.getUnzoomedView();i.busy++;i.notifyActivity();m.readWigData(a,b,c,function(a){i.busy--;i.notifyActivity();var d=1E9;if(h.type==="bigwig"){var e=(c-b)/a.length/2;e<d&&(d=e)}if(i.opts.link)for(e=0;e<a.length;++e){var m=a[e];if(m.label)m.links=[new DASLink("Link",i.opts.link.replace(/\$\$/,m.label))]}j(null,a,d)})})};
BWGFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){var h=this;h.busy++;h.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,c,d,function(a,b){h.busy--;h.notifyActivity();return e(a,b)})};BWGFeatureSource.prototype.findNextFeature=function(a,b,c,d){var e=this;e.busy++;e.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,c,function(a){e.busy--;e.notifyActivity();a.length>0&&a[0]!=null&&d(a[0])})};
BWGFeatureSource.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],c=0;c<a.zoomLevels.length;++c)b.push(a.zoomLevels[c].reduction);return b}return null};
BWGFeatureSource.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new DASStylesheet;if(b.type=="bigbed"){b=new DASStyle;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=true;b.LABEL=true;b.ZINDEX=20;c.pushStyle({type:"bigwig"},null,b);b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=10;b.BUMP=true;b.ZINDEX=20;c.pushStyle({type:"bb-translation"},null,b);b=new DASStyle;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";
b.HEIGHT=10;b.ZINDEX=10;b.BUMP=true;b.LABEL=true;c.pushStyle({type:"bb-transcript"},null,b);b=new DASStyle;b.glyph="HISTOGRAM";b.COLOR1="white";b.COLOR2="black";b.HEIGHT=30;c.pushStyle({type:"density"},null,b)}else{b=new DASStyle;b.glyph="HISTOGRAM";b.COLOR1="white";b.COLOR2="black";b.HEIGHT=30;c.pushStyle({type:"default"},null,b)}return a(c)})};function BamblrFeatureSource(a){this.bamblr=a.bamblrURI}BamblrFeatureSource.prototype.getScales=function(){return[]};
BamblrFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"default"},null,c);return a(b)};
BamblrFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){var i=d|0;i<1&&(i=1);(new URLFetchable(this.bamblr+"?seq="+a+"&min="+b+"&max="+c+"&rez="+i)).fetch(function(c){if(c==null)dlog("failing bamblr");else{for(var c=new Int32Array(c),d=[],e=0;e<c.length;++e){var h=new DASFeature;h.min=b+e*i;h.max=h.min+i-1;h.segment=a;h.type="bamblr";h.score=c[e];d.push(h)}j(null,d,i)}})};
function BAMFeatureSource(a){var b=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight};this.bamHolder=new Awaited;this.busy=0;this.activityListeners=[];if(this.opts.preflight){var c=bwg_preflights[this.opts.preflight];if(!c){c=new Awaited;bwg_preflights[this.opts.preflight]=c;var d=new XMLHttpRequest;d.onreadystatechange=function(){d.readyState==4&&(d.status==200?c.provide("success"):c.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),
true);if(this.opts.credentials)d.withCredentials="true";d.send("")}c.await(function(a){a==="success"&&b.init()})}else b.init()}BAMFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};BAMFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
BAMFeatureSource.prototype.init=function(){var a=this,b,c;if(this.bamSource.bamBlob){b=new BlobFetchable(this.bamSource.bamBlob);c=new BlobFetchable(this.bamSource.baiBlob)}else{b=new URLFetchable(this.bamSource.bamURI,{credentials:this.opts.credentials});c=new URLFetchable(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials})}makeBam(b,c,function(b){a.bamHolder.provide(b)})};
BAMFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){var i=this;i.busy++;i.notifyActivity();this.bamHolder.await(function(d){d.fetch(a,b,c,function(a,b){i.busy--;i.notifyActivity();if(b)j(b,null,null);else{for(var c=[],d=0;d<a.length;++d){var e=a[d],h=new DASFeature;h.min=e.pos+1;h.max=e.pos+e.seq.length;h.segment=e.segment;h.type="bam";h.id=e.readName;h.notes=["Sequence="+e.seq,"CIGAR="+e.cigar,"MQ="+e.mq];h.seq=e.seq;c.push(h)}j(null,c,1E9)}})})};BAMFeatureSource.prototype.getScales=function(){return 1E9};
BAMFeatureSource.prototype.getStyleSheet=function(a){this.bamHolder.await(function(){var b=new DASStylesheet,c=new DASStyle;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new DASStyle;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=true;c.LABEL=false;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};
function MappedFeatureSource(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}MappedFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};MappedFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};MappedFeatureSource.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};MappedFeatureSource.prototype.getScales=function(){return this.source.getScales()};
MappedFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){var i=this;i.busy++;i.notifyActivity();this.mapping.sourceBlocksForRange(a,b,c,function(b){if(b.length==0){i.busy--;i.notifyActivity();j("No mapping available for this regions",[],d)}else{b=b[0];i.source.fetch(b.name,b.start,b.end,d,e,h,function(b,c,d){i.busy--;i.notifyActivity();var e=[];if(c)for(var h=0;h<c.length;++h){var l=c[h],p=l.segment;p.indexOf("chr")==0&&(p=p.substr(3));var u=i.mapping.mapPoint(p,l.min),p=i.mapping.mapPoint(p,l.max);
if(!u||!p||u.seq!=p.seq||u.seq!=a)l.parts&&l.parts.length>0&&e.push(l);else{l.segment=u.seq;l.min=u.pos;l.max=p.pos;if(l.min>l.max){p=l.max;l.max=l.min;l.min=p}if(u.flipped)if(l.orientation=="-")l.orientation="+";else if(l.orientation=="+")l.orientation="-";e.push(l)}}j(b,e,d)})}})};function DummyFeatureSource(){}DummyFeatureSource.prototype.getScales=function(){return null};DummyFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){return j(null,[],1E9)};
DummyFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};function DummySequenceSource(){}DummySequenceSource.prototype.fetch=function(a,b,c,d,e){return e(null,null)};function JBrowseFeatureSource(a){this.store=new JBrowseStore(a.jbURI,a.jbQuery)}JBrowseFeatureSource.prototype.getScales=function(){return null};
JBrowseFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=true;c.LABEL=true;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};JBrowseFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){e&&e.length==0?j(null,[],d):this.store.features(new DASSegment(a,b,c),{},function(a,b){j(b,a,1E5)})};function sourceAdapterIsCapable(a,b){return a.capabilities?a.capabilities()[b]:false}
function JBrowseStore(a,b){this.base=a;this.query=b}var topLevelResp;
JBrowseStore.prototype.features=function(a,b,c){url=this.base+"/features/"+a.name;b=[];this.query&&b.push(this.query);if(a.isBounded){b.push("start="+a.start);b.push("end="+a.end)}b.length>0&&(url=url+"?"+b.join("&"));var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status>=300)c(null,"Error code "+d.status);else{var b=JSON.parse(d.response).features,h=[];for(fi=0;fi<b.length;++fi){var j=b[fi],i=new DASFeature;i.segment=a;i.min=(j.start|0)+1;i.max=j.end|0;if(j.name)i.label=
j.name;i.type=j.type||"unknown";h.push(i)}c(h)}};d.open("GET",url,true);d.responseType="text";d.send("")};function EnsemblFeatureSource(a){this.source=a;this.base=a.uri||"http://beta.rest.ensembl.org";this.species=a.species||"human";this.activityListeners=[];this.busy=0;this.type=typeof a.type==="string"?[a.type]:a.type||["regulatory"]}EnsemblFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
EnsemblFeatureSource.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
EnsemblFeatureSource.prototype.getStyleSheet=function(a){var b=new DASStylesheet,c=new DASStyle;c.glyph="__NONE";this.type.indexOf("exon")>=0&&b.pushStyle({type:"transcript"},null,c);(this.type.indexOf("exon")>=0||this.type.indexOf("transcript")>=0)&&b.pushStyle({type:"gene"},null,c);c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=8;c.BUMP=true;c.LABEL=true;c.ZINDEX=10;b.pushStyle({type:"cds"},null,c);c=new DASStyle;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="orange";c.HEIGHT=
8;c.BUMP=true;c.LABEL=true;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};EnsemblFeatureSource.prototype.getScales=function(){return[]};
EnsemblFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){var i=this;url=this.base+"/feature/region/"+this.species+"/"+a+":"+b+"-"+c;b=[];for(c=0;c<this.type.length;++c)b.push("feature="+this.type[c]);b.push("content-type=application/json");url=url+"?"+b.join(";");var l=new XMLHttpRequest;l.onreadystatechange=function(){i.busy--;i.notifyActivity();if(l.readyState==4)if(l.status>=300)j("Error code "+l.status,null);else{var b=JSON.parse(l.response),c=[];for(fi=0;fi<b.length;++fi){var d=b[fi],e=new DASFeature;
e.segment=a;e.min=d.start|0;e.max=d.end|0;e.type=d.feature_type||"unknown";e.id=d.ID;if(d.Parent){var h=new DASGroup;h.id=d.Parent;e.groups=[h]}if(d.strand)if(d.strand<0)e.orientation="-";else if(d.strand>0)e.orientation="+";c.push(e)}j(null,c)}};i.busy++;i.notifyActivity();l.open("GET",url,true);l.responseType="text";l.send("")};
function OverlayFeatureSource(a,b){this.sources=a;this.opts=b||{};this.activityListeners=[];this.business=[];for(var c=0;c<this.sources.length;++c)this.initN(c);this.merge=b.merge=="concat"?OverlayFeatureSource_merge_concat:OverlayFeatureSource_merge_byKey}OverlayFeatureSource.prototype.initN=function(a){var b=this.sources[a],c=this;this.business[a]=0;b.addActivityListener&&b.addActivityListener(function(b){c.business[a]=b;c.notifyActivity()})};OverlayFeatureSource.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
OverlayFeatureSource.prototype.notifyActivity=function(){for(var a=0,b=0;b<this.business.length;++b)a=a+this.business[b];for(b=0;b<this.activityListeners.length;++b)try{this.activityListeners[b](a)}catch(c){console.log(c)}};OverlayFeatureSource.prototype.getScales=function(){return this.sources[0].getScales()};OverlayFeatureSource.prototype.getStyleSheet=function(a){return this.sources[0].getStyleSheet(a)};
OverlayFeatureSource.prototype.capabilities=function(){var a=this.sources[0];return a.capabilities?a.capabilities():{}};OverlayFeatureSource.prototype.fetch=function(a,b,c,d,e,h,j){for(var j=new OverlayBaton(this,j,this.sources.length),i=0;i<this.sources.length;++i)this.fetchN(j,i,a,b,c,d,e,h)};OverlayFeatureSource.prototype.fetchN=function(a,b,c,d,e,h,j,i){this.sources[b].fetch(c,d,e,h,j,i,function(c,d,e){return a.completed(b,c,d,e)})};
OverlayFeatureSource.prototype.quantFindNextFeature=function(a,b,c,d,e){return this.sources[0].quantFindNextFeature(a,b,c,d,e)};OverlayFeatureSource.prototype.findNextFeature=function(a,b,c,d){return this.sources[0].findNextFeature(a,b,c,d)};function OverlayBaton(a,b,c){this.source=a;this.callback=b;this.count=c;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}
OverlayBaton.prototype.completed=function(a,b,c,d){if(this.scale==null||a==0)this.scale=d;if(this.returns[a])throw"Multiple returns for source "+a;this.returns[a]=true;this.returnCount++;this.features[a]=c;if(b){this.statuses[a]=b;this.statusCount++}if(this.returnCount==this.count){if(this.statusCount>0){a="";for(b=0;b<this.count;++b){c=this.statuses[b];if(c!=0){a.length>0&&(a=a+", ");a=a+c}}return this.callback(a,null,this.scale)}this.callback(null,this.source.merge(this.features),this.scale)}};
OverlayFeatureSource.prototype.keyForFeature=function(a){return""+a.min+".."+a.max};function OverlayFeatureSource_merge_byKey(a){for(var b={},c=a[1],d=0;d<c.length;++d)b[this.keyForFeature(c[d])]=c[d];for(var e=[],a=a[0],d=0;d<a.length;++d){var h=a[d];if(c=b[this.keyForFeature(h)]){if(c.id)h.id=c.id;if(c.label)h.label=c.label}e.push(h)}return e}
function OverlayFeatureSource_merge_concat(a){for(var b=[],c=0;c<a.length;++c)for(var d=a[c],e=this.sources[c].name,h=0;h<d.length;++h){var j=d[h];j.method=e;b.push(j)}return b}Browser.prototype.mergeSelectedTiers=function(){for(var a=[],b=0;b<this.selectedTiers.length;++b)a.push(shallowCopy(this.tiers[this.selectedTiers[b]].dasSource));this.addTier({name:"Merged",merge:"concat",overlay:a,noDownsample:true});this.setSelectedTier(this.tiers.length-1)};
var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],
IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,
7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,
9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,
125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,
82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,
8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,
0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,
9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,
5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,
129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ZStream(){}ZStream.prototype.inflateInit=function(a,b){a||(a=DEF_WBITS);b&&(b=false);this.istate=new Inflate;return this.istate.inflateInit(this,b?-a:a)};ZStream.prototype.inflate=function(a){return this.istate==null?Z_STREAM_ERROR:this.istate.inflate(this,a)};
ZStream.prototype.inflateEnd=function(){if(this.istate==null)return Z_STREAM_ERROR;var a=istate.inflateEnd(this);this.istate=null;return a};ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)};ZStream.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};function Inflate(){this.was=[0]}
Inflate.prototype.inflateReset=function(a){if(a==null||a.istate==null)return Z_STREAM_ERROR;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=a.istate.nowrap!=0?BLOCKS:METHOD;a.istate.blocks.reset(a,null);return Z_OK};Inflate.prototype.inflateEnd=function(a){this.blocks!=null&&this.blocks.free(a);this.blocks=null;return Z_OK};
Inflate.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;if(b<0){b=-b;nowrap=1}if(b<8||b>15){this.inflateEnd(a);return Z_STREAM_ERROR}this.wbits=b;a.istate.blocks=new InfBlocks(a,a.istate.nowrap!=0?null:this,1<<b);this.inflateReset(a);return Z_OK};
Inflate.prototype.inflate=function(a,b){var c,d;if(a==null||a.istate==null||a.next_in==null)return Z_STREAM_ERROR;b=b==Z_FINISH?Z_BUF_ERROR:Z_OK;for(c=Z_BUF_ERROR;;)switch(a.istate.mode){case METHOD:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.next_in[a.next_in_index++])&15)!=Z_DEFLATED){a.istate.mode=BAD;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=BAD;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=FLAG;case FLAG:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(((a.istate.method<<8)+d)%31!=0){a.istate.mode=BAD;a.msg="incorrect header check";a.istate.marker=5;break}if((d&PRESET_DICT)==0){a.istate.mode=BLOCKS;break}a.istate.mode=DICT4;case DICT4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=DICT3;case DICT3:if(a.avail_in==0)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<16&16711680);a.istate.mode=DICT2;case DICT2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<8&65280);a.istate.mode=DICT1;case DICT1:if(a.avail_in==0)return c;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+(a.next_in[a.next_in_index++]&255);a.adler=a.istate.need;a.istate.mode=DICT0;return Z_NEED_DICT;case DICT0:a.istate.mode=BAD;a.msg="need dictionary";
a.istate.marker=0;return Z_STREAM_ERROR;case BLOCKS:c=a.istate.blocks.proc(a,c);if(c==Z_DATA_ERROR){a.istate.mode=BAD;a.istate.marker=0;break}c==Z_OK&&(c=b);if(c!=Z_STREAM_END)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(a.istate.nowrap!=0){a.istate.mode=DONE;break}a.istate.mode=CHECK4;case CHECK4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=CHECK3;case CHECK3:if(a.avail_in==0)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<16&16711680);a.istate.mode=CHECK2;case CHECK2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<8&65280);a.istate.mode=CHECK1;case CHECK1:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+(a.next_in[a.next_in_index++]&255);if(a.istate.was[0]!=a.istate.need){a.istate.mode=BAD;a.msg="incorrect data check";a.istate.marker=
5;break}a.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}};Inflate.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(a==null||a.istate==null||a.istate.mode!=DICT0)return Z_STREAM_ERROR;if(a._adler.adler32(1,b,0,c)!=a.adler)return Z_DATA_ERROR;a.adler=a._adler.adler32(0,null,0,0);if(e>=1<<a.istate.wbits){e=(1<<a.istate.wbits)-1;d=c-e}a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=BLOCKS;return Z_OK};var mark=[0,0,255,255];
Inflate.prototype.inflateSync=function(a){var b,c,d;if(a==null||a.istate==null)return Z_STREAM_ERROR;if(a.istate.mode!=BAD){a.istate.mode=BAD;a.istate.marker=0}if((b=a.avail_in)==0)return Z_BUF_ERROR;c=a.next_in_index;for(d=a.istate.marker;b!=0&&d<4;){a.next_in[c]==mark[d]?d++:d=a.next_in[c]!=0?0:4-d;c++;b--}a.total_in=a.total_in+(c-a.next_in_index);a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(d!=4)return Z_DATA_ERROR;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=
c;a.istate.mode=BLOCKS;return Z_OK};Inflate.prototype.inflateSyncPoint=function(a){return a==null||a.istate==null||a.istate.blocks==null?Z_STREAM_ERROR:a.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
function InfBlocks(a,b,c){this.hufts=new Int32Array(MANY*3);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=IB_TYPE;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new InfCodes;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new InfTree}
InfBlocks.prototype.reset=function(a,b){if(b)b[0]=this.check;this.mode==IB_CODES&&this.codes.free(a);this.mode=IB_TYPE;this.read=this.write=this.bitb=this.bitk=0;if(this.checkfn)a.adler=this.check=a._adler.adler32(0,null,0,0)};
InfBlocks.prototype.proc=function(a,b){var c,d,e,h,j,i,l;h=a.next_in_index;j=a.avail_in;d=this.bitb;e=this.bitk;i=this.write;for(l=i<this.read?this.read-i-1:this.end-i;;)switch(this.mode){case IB_TYPE:for(;e<3;){if(j!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}j--;d=d|(a.next_in[h++]&255)<<e;e=e+8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d=d>>>3;e=e-3;c=e&7;d=d>>>c;e=e-c;this.mode=IB_LENS;
break;case 1:var m=new Int32Array(1),o=new Int32Array(1),q=[],r=[];inflate_trees_fixed(m,o,q,r,a);this.codes.init(m[0],o[0],q[0],0,r[0],0,a);d=d>>>3;e=e-3;this.mode=IB_CODES;break;case 2:d=d>>>3;e=e-3;this.mode=IB_TABLE;break;case 3:d=d>>>3;e=e-3;this.mode=BAD;a.msg="invalid block type";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}break;case IB_LENS:for(;e<32;){if(j!=0)b=Z_OK;else{this.bitb=
d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}j--;d=d|(a.next_in[h++]&255)<<e;e=e+8}if((~d>>>16&65535)!=(d&65535)){this.mode=BAD;a.msg="invalid stored block lengths";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}this.left=d&65535;d=e=0;this.mode=left!=0?IB_STORED:this.last!=0?IB_DRY:IB_TYPE;break;case IB_STORED:if(j==
0){this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;write=i;return this.inflate_flush(a,b)}if(l==0){if(i==end&&read!=0){i=0;l=i<this.read?this.read-i-1:this.end-i}if(l==0){this.write=i;b=this.inflate_flush(a,b);i=this.write;l=i<this.read?this.read-i-1:this.end-i;if(i==this.end&&this.read!=0){i=0;l=i<this.read?this.read-i-1:this.end-i}if(l==0){this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=
i;return this.inflate_flush(a,b)}}}b=Z_OK;c=this.left;c>j&&(c=j);c>l&&(c=l);arrayCopy(a.next_in,h,window,i,c);h=h+c;j=j-c;i=i+c;l=l-c;if((this.left=this.left-c)!=0)break;this.mode=this.last!=0?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;e<14;){if(j!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}j--;d=d|(a.next_in[h++]&255)<<e;e=e+8}this.table=c=d&16383;if((c&31)>29||(c>>5&31)>29){this.mode=IB_BAD;
a.msg="too many length or distance symbols";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}c=258+(c&31)+(c>>5&31);if(this.blens==null||this.blens.length<c)this.blens=new Int32Array(c);else for(l=0;l<c;l++)this.blens[l]=0;d=d>>>14;e=e-14;this.index=0;mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;e<3;){if(j!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=
a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}j--;d=d|(a.next_in[h++]&255)<<e;e=e+8}this.blens[INFBLOCKS_BORDER[this.index++]]=d&7;d=d>>>3;e=e-3}for(;this.index<19;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=Z_OK){b=c;if(b==Z_DATA_ERROR){this.blens=null;this.mode=IB_BAD}this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=
h;write=i;return this.inflate_flush(a,b)}this.index=0;this.mode=IB_DTREE;case IB_DTREE:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];e<c;){if(j!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}j--;d=d|(a.next_in[h++]&255)<<e;e=e+8}c=this.hufts[(this.tb[0]+(d&inflate_mask[c]))*3+1];o=this.hufts[(this.tb[0]+(d&inflate_mask[c]))*3+2];if(o<16){d=d>>>c;e=e-c;this.blens[this.index++]=
o}else{l=o==18?7:o-14;for(m=o==18?11:3;e<c+l;){if(j!=0)b=Z_OK;else{this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}j--;d=d|(a.next_in[h++]&255)<<e;e=e+8}d=d>>>c;e=e-c;m=m+(d&inflate_mask[l]);d=d>>>l;e=e-l;l=this.index;c=this.table;if(l+m>258+(c&31)+(c>>5&31)||o==16&&l<1){this.blens=null;this.mode=IB_BAD;a.msg="invalid bit length repeat";b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+
(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}o=o==16?this.blens[l-1]:0;do this.blens[l++]=o;while(--m!=0);this.index=l}}this.tb[0]=-1;m=new Int32Array(1);o=new Int32Array(1);q=new Int32Array(1);r=new Int32Array(1);m[0]=9;o[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,m,o,q,r,this.hufts,a);if(c!=Z_OK){if(c==Z_DATA_ERROR){this.blens=null;this.mode=BAD}b=c;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);
a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}this.codes.init(m[0],o[0],this.hufts,q[0],this.hufts,r[0],a);this.mode=IB_CODES;case IB_CODES:this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;if((b=this.codes.proc(this,a,b))!=Z_STREAM_END)return this.inflate_flush(a,b);b=Z_OK;this.codes.free(a);h=a.next_in_index;j=a.avail_in;d=this.bitb;e=this.bitk;i=this.write;l=i<this.read?this.read-i-1:this.end-i;if(this.last==0){this.mode=
IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:this.write=i;b=this.inflate_flush(a,b);i=this.write;if(this.read!=this.write){this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}mode=DONE;case IB_DONE:b=Z_STREAM_END;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b);case IB_BAD:b=Z_DATA_ERROR;this.bitb=d;this.bitk=e;a.avail_in=
j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b);default:b=Z_STREAM_ERROR;this.bitb=d;this.bitk=e;a.avail_in=j;a.total_in=a.total_in+(h-a.next_in_index);a.next_in_index=h;this.write=i;return this.inflate_flush(a,b)}};InfBlocks.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};InfBlocks.prototype.set_dictionary=function(a,b,c){arrayCopy(a,b,window,0,c);this.read=this.write=c};
InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS};
InfBlocks.prototype.inflate_flush=function(a,b){var c,d,e;d=a.next_out_index;e=this.read;c=(e<=this.write?this.write:this.end)-e;if(c>a.avail_out)c=a.avail_out;c!=0&&b==Z_BUF_ERROR&&(b=Z_OK);a.avail_out=a.avail_out-c;a.total_out=a.total_out+c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,e,c);arrayCopy(this.window,e,a.next_out,d,c);d=d+c;e=e+c;if(e==this.end){e=0;if(this.write==this.end)this.write=0;c=this.write-e;if(c>a.avail_out)c=a.avail_out;c!=0&&b==Z_BUF_ERROR&&
(b=Z_OK);a.avail_out=a.avail_out-c;a.total_out=a.total_out+c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,e,c);arrayCopy(this.window,e,a.next_out,d,c);d=d+c;e=e+c}a.next_out_index=d;this.read=e;return b};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;function InfCodes(){}
InfCodes.prototype.init=function(a,b,c,d,e,h){this.mode=IC_START;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=h;this.tree=null};
InfCodes.prototype.proc=function(a,b,c){var d,e,h=0,j=0,i=0,l,m,o,i=b.next_in_index;l=b.avail_in;h=a.bitb;j=a.bitk;m=a.write;for(o=m<a.read?a.read-m-1:a.end-m;;)switch(this.mode){case IC_START:if(o>=258&&l>=10){a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b);i=b.next_in_index;l=b.avail_in;h=a.bitb;j=a.bitk;m=a.write;o=m<a.read?a.read-m-1:a.end-
m;if(c!=Z_OK){this.mode=c==Z_STREAM_END?IC_WASH:IC_BADCODE;break}}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=IC_LEN;case IC_LEN:for(d=this.need;j<d;){if(l!=0)c=Z_OK;else{a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}l--;h=h|(b.next_in[i++]&255)<<j;j=j+8}d=(this.tree_index+(h&inflate_mask[d]))*3;h=h>>>this.tree[d+1];j=j-this.tree[d+1];e=this.tree[d];if(e==0){this.lit=this.tree[d+
2];this.mode=IC_LIT;break}if((e&16)!=0){this.get=e&15;this.len=this.tree[d+2];this.mode=IC_LENEXT;break}if((e&64)==0){this.need=e;this.tree_index=d/3+this.tree[d+2];break}if((e&32)!=0){this.mode=IC_WASH;break}this.mode=IC_BADCODE;b.msg="invalid literal/length code";c=Z_DATA_ERROR;a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c);case IC_LENEXT:for(d=this.get;j<d;){if(l!=0)c=Z_OK;else{a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=
b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}l--;h=h|(b.next_in[i++]&255)<<j;j=j+8}this.len=this.len+(h&inflate_mask[d]);h=h>>d;j=j-d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=IC_DIST;case IC_DIST:for(d=this.need;j<d;){if(l!=0)c=Z_OK;else{a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}l--;h=h|(b.next_in[i++]&255)<<j;j=j+8}d=(this.tree_index+
(h&inflate_mask[d]))*3;h=h>>this.tree[d+1];j=j-this.tree[d+1];e=this.tree[d];if((e&16)!=0){this.get=e&15;this.dist=this.tree[d+2];this.mode=IC_DISTEXT;break}if((e&64)==0){this.need=e;this.tree_index=d/3+this.tree[d+2];break}this.mode=IC_BADCODE;b.msg="invalid distance code";c=Z_DATA_ERROR;a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c);case IC_DISTEXT:for(d=this.get;j<d;){if(l!=0)c=Z_OK;else{a.bitb=h;a.bitk=j;b.avail_in=
l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}l--;h=h|(b.next_in[i++]&255)<<j;j=j+8}this.dist=this.dist+(h&inflate_mask[d]);h=h>>d;j=j-d;this.mode=IC_COPY;case IC_COPY:for(d=m-this.dist;d<0;)d=d+a.end;for(;this.len!=0;){if(o==0){if(m==a.end&&a.read!=0){m=0;o=m<a.read?a.read-m-1:a.end-m}if(o==0){a.write=m;c=a.inflate_flush(b,c);m=a.write;o=m<a.read?a.read-m-1:a.end-m;if(m==a.end&&a.read!=0){m=0;o=m<a.read?a.read-m-1:a.end-m}if(o==0){a.bitb=h;a.bitk=
j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}}}a.window[m++]=a.window[d++];o--;d==a.end&&(d=0);this.len--}this.mode=IC_START;break;case IC_LIT:if(o==0){if(m==a.end&&a.read!=0){m=0;o=m<a.read?a.read-m-1:a.end-m}if(o==0){a.write=m;c=a.inflate_flush(b,c);m=a.write;o=m<a.read?a.read-m-1:a.end-m;if(m==a.end&&a.read!=0){m=0;o=m<a.read?a.read-m-1:a.end-m}if(o==0){a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=
i;a.write=m;return a.inflate_flush(b,c)}}}c=Z_OK;a.window[m++]=this.lit;o--;this.mode=IC_START;break;case IC_WASH:if(j>7){j=j-8;l++;i--}a.write=m;c=a.inflate_flush(b,c);m=a.write;if(a.read!=a.write){a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}this.mode=IC_END;case IC_END:c=Z_STREAM_END;a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c);
case IC_BADCODE:c=Z_DATA_ERROR;a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c);default:c=Z_STREAM_ERROR;a.bitb=h;a.bitk=j;b.avail_in=l;b.total_in=b.total_in+(i-b.next_in_index);b.next_in_index=i;a.write=m;return a.inflate_flush(b,c)}};InfCodes.prototype.free=function(){};
InfCodes.prototype.inflate_fast=function(a,b,c,d,e,h,j,i){var l,m,o,q,r,s,t,p,u,v,w,x;s=i.next_in_index;t=i.avail_in;q=j.bitb;r=j.bitk;p=j.write;u=p<j.read?j.read-p-1:j.end-p;a=inflate_mask[a];v=inflate_mask[b];do{for(;r<20;){t--;q=q|(i.next_in[s++]&255)<<r;r=r+8}l=q&a;m=c;o=d;x=(o+l)*3;if((b=m[x])==0){q=q>>m[x+1];r=r-m[x+1];j.window[p++]=m[x+2];u--}else{do{q=q>>m[x+1];r=r-m[x+1];if((b&16)!=0){b=b&15;w=m[x+2]+(q&inflate_mask[b]);q=q>>b;for(r=r-b;r<15;){t--;q=q|(i.next_in[s++]&255)<<r;r=r+8}l=q&v;
m=e;o=h;x=(o+l)*3;b=m[x];do{q=q>>m[x+1];r=r-m[x+1];if((b&16)!=0){for(b=b&15;r<b;){t--;q=q|(i.next_in[s++]&255)<<r;r=r+8}l=m[x+2]+(q&inflate_mask[b]);q=q>>b;r=r-b;u=u-w;if(p>=l){l=p-l;j.window[p++]=j.window[l++];j.window[p++]=j.window[l++];w=w-2}else{l=p-l;do l=l+j.end;while(l<0);b=j.end-l;if(w>b){w=w-b;if(p-l>0&&b>p-l){do j.window[p++]=j.window[l++];while(--b!=0)}else{arrayCopy(j.window,l,j.window,p,b);p=p+b}l=0}}do j.window[p++]=j.window[l++];while(--w!=0);break}else if((b&64)==0){l=l+m[x+2];l=l+
(q&inflate_mask[b]);x=(o+l)*3;b=m[x]}else{i.msg="invalid distance code";w=i.avail_in-t;w=r>>3<w?r>>3:w;t=t+w;s=s-w;r=r-(w<<3);j.bitb=q;j.bitk=r;i.avail_in=t;i.total_in=i.total_in+(s-i.next_in_index);i.next_in_index=s;j.write=p;return Z_DATA_ERROR}}while(1);break}if((b&64)==0){l=l+m[x+2];l=l+(q&inflate_mask[b]);x=(o+l)*3;if((b=m[x])==0){q=q>>m[x+1];r=r-m[x+1];j.window[p++]=m[x+2];u--;break}}else{if((b&32)!=0){w=i.avail_in-t;w=r>>3<w?r>>3:w;t=t+w;s=s-w;r=r-(w<<3);j.bitb=q;j.bitk=r;i.avail_in=t;i.total_in=
i.total_in+(s-i.next_in_index);i.next_in_index=s;j.write=p;return Z_STREAM_END}i.msg="invalid literal/length code";w=i.avail_in-t;w=r>>3<w?r>>3:w;t=t+w;s=s-w;r=r-(w<<3);j.bitb=q;j.bitk=r;i.avail_in=t;i.total_in=i.total_in+(s-i.next_in_index);i.next_in_index=s;j.write=p;return Z_DATA_ERROR}}while(1)}}while(u>=258&&t>=10);w=i.avail_in-t;w=r>>3<w?r>>3:w;s=s-w;j.bitb=q;j.bitk=r-(w<<3);i.avail_in=t+w;i.total_in=i.total_in+(s-i.next_in_index);i.next_in_index=s;j.write=p;return Z_OK};
function InfTree(){}
InfTree.prototype.huft_build=function(a,b,c,d,e,h,j,i,l,m,o){var q,r,s,t,p,u,v,w,x;u=0;r=c;do{this.c[a[b+u]]++;u++;r--}while(r!=0);if(this.c[0]==c){j[0]=-1;i[0]=0;return Z_OK}p=i[0];for(s=1;s<=BMAX;s++)if(this.c[s]!=0)break;t=s;p<s&&(p=s);for(r=BMAX;r!=0;r--)if(this.c[r]!=0)break;m=r;p>r&&(p=r);i[0]=p;for(i=1<<s;s<r;s++,i=i<<1)if((i=i-this.c[s])<0)return Z_DATA_ERROR;if((i=i-this.c[r])<0)return Z_DATA_ERROR;this.c[r]=this.c[r]+i;this.x[1]=s=0;u=1;for(v=2;--r!=0;){this.x[v]=s=s+this.c[u];v++;u++}u=
r=0;do{if((s=a[b+u])!=0)this.v[this.x[s]++]=r;u++}while(++r<c);c=this.x[m];u=this.x[0]=r=0;b=-1;w=-p;for(x=v=this.u[0]=0;t<=m;t++)for(a=this.c[t];a--!=0;){for(;t>w+p;){b++;w=w+p;x=m-w;x=x>p?p:x;if((q=1<<(s=t-w))>a+1){q=q-(a+1);v=t;if(s<x)for(;++s<x;){if((q=q<<1)<=this.c[++v])break;q=q-this.c[v]}}x=1<<s;if(this.hn[0]+x>MANY)return Z_DATA_ERROR;this.u[b]=v=this.hn[0];this.hn[0]=this.hn[0]+x;if(b!=0){this.x[b]=r;this.r[0]=s;this.r[1]=p;s=r>>>w-p;this.r[2]=v-this.u[b-1]-s;arrayCopy(this.r,0,l,(this.u[b-
1]+s)*3,3)}else j[0]=v}this.r[1]=t-w;if(u>=c)this.r[0]=192;else if(o[u]<d){this.r[0]=this.v[u]<256?0:96;this.r[2]=this.v[u++]}else{this.r[0]=h[this.v[u]-d]+16+64;this.r[2]=e[this.v[u++]-d]}q=1<<t-w;for(s=r>>>w;s<x;s=s+q)arrayCopy(this.r,0,l,(v+s)*3,3);for(s=1<<t-1;(r&s)!=0;s=s>>>1)r=r^s;r=r^s;for(s=(1<<w)-1;(r&s)!=this.x[b];){b--;w=w-p;s=(1<<w)-1}}return i!=0&&m!=1?Z_BUF_ERROR:Z_OK};
InfTree.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(a==Z_DATA_ERROR)e.msg="oversubscribed dynamic bit lengths tree";else if(a==Z_BUF_ERROR||b[0]==0){e.msg="incomplete dynamic bit lengths tree";a=Z_DATA_ERROR}return a};
InfTree.prototype.inflate_trees_dynamic=function(a,b,c,d,e,h,j,i,l){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,cplens,cplext,h,d,i,this.hn,this.v);if(h!=Z_OK||d[0]==0){if(h==Z_DATA_ERROR)l.msg="oversubscribed literal/length tree";else if(h!=Z_MEM_ERROR){l.msg="incomplete literal/length tree";h=Z_DATA_ERROR}return h}this.initWorkArea(288);h=this.huft_build(c,a,b,0,cpdist,cpdext,j,e,i,this.hn,this.v);if(h!=Z_OK||e[0]==0&&a>257){if(h==Z_DATA_ERROR)l.msg="oversubscribed distance tree";
else if(h==Z_BUF_ERROR){l.msg="incomplete distance tree";h=Z_DATA_ERROR}else if(h!=Z_MEM_ERROR){l.msg="empty distance tree with lengths";h=Z_DATA_ERROR}return h}return Z_OK};function inflate_trees_fixed(a,b,c,d){a[0]=fixed_bl;b[0]=fixed_bd;c[0]=fixed_tl;d[0]=fixed_td;return Z_OK}
InfTree.prototype.initWorkArea=function(a){if(this.hn==null){this.hn=new Int32Array(1);this.v=new Int32Array(a);this.c=new Int32Array(BMAX+1);this.r=new Int32Array(3);this.u=new Int32Array(BMAX);this.x=new Int32Array(BMAX+1)}if(this.v.length<a)this.v=new Int32Array(a);for(var b=0;b<a;b++)this.v[b]=0;for(b=0;b<BMAX+1;b++)this.c[b]=0;for(b=0;b<3;b++)this.r[b]=0;arrayCopy(this.c,0,this.u,0,BMAX);arrayCopy(this.c,0,this.x,0,BMAX+1)};
var testArray=new Uint8Array(1),hasSubarray="function"===typeof testArray.subarray,hasSlice=!1;function arrayCopy(a,b,c,d,e){if(e!=0){if(a){if(!c)throw"Undef dest";}else throw"Undef src";b==0&&e==a.length?arrayCopy_fast(a,c,d):hasSubarray?arrayCopy_fast(a.subarray(b,b+e),c,d):a.BYTES_PER_ELEMENT==1&&e>100?arrayCopy_fast(new Uint8Array(a.buffer,a.byteOffset+b,e),c,d):arrayCopy_slow(a,b,c,d,e)}}function arrayCopy_slow(a,b,c,d,e){for(var h=0;h<e;++h)c[d+h]=a[b+h]}
function arrayCopy_fast(a,b,c){b.set(a,c)}var ADLER_BASE=65521,ADLER_NMAX=5552;
function adler32(a,b,c,d){if(b==null)return 1;for(var e=a&65535,a=a>>16&65535,h;d>0;){h=d<ADLER_NMAX?d:ADLER_NMAX;for(d=d-h;h>=16;){e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;e=e+(b[c++]&255);a=a+e;h=
h-16}if(h!=0){do{e=e+(b[c++]&255);a=a+e}while(--h!=0)}e=e%ADLER_BASE;a=a%ADLER_BASE}return a<<16|e}
function jszlib_inflate_buffer(a,b,c,d){a=b?new Uint8Array(a,b,c):new Uint8Array(a);c=new ZStream;c.inflateInit(DEF_WBITS,true);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;for(var a=[],e=0;;){var h=new Uint8Array(32E3);c.next_out=h;c.next_out_index=0;c.avail_out=h.length;var j=c.inflate(Z_NO_FLUSH);if(j!=Z_OK&&j!=Z_STREAM_END)throw c.msg;if(c.avail_out!=0){var i=new Uint8Array(h.length-c.avail_out);arrayCopy(h,0,i,0,h.length-c.avail_out);h=i}a.push(h);e=e+h.length;if(j==Z_STREAM_END)break}d&&
(d[0]=(b||0)+c.next_in_index);if(a.length==1)return a[0].buffer;b=new Uint8Array(e);for(c=d=0;c<a.length;++c){e=a[c];arrayCopy(e,0,b,d,e.length);d=d+e.length}return b.buffer}
(function(){var a,b,c;function d(){s.call(document.querySelectorAll("input[type=range]"),h);(new MutationObserver(function(a){a.forEach(function(a){a.addedNodes&&s.call(a.addedNodes,function(a){e(a);a.childElementCount&&s.call(a.querySelectorAll("input"),e)})})})).observe(document,{childList:true,subtree:true})}function e(a){a.localName=="input"&&(a.type!="range"&&a.getAttribute("type")=="range")&&h(a)}function h(c){function d(b){var c=(parseFloat(getComputedStyle(this,0).width)-a)/K;if(c){I=I+(b.clientX-
M)/c;M=b.clientX;B=true;this.value=I}}function e(){this.removeEventListener("mousemove",d,true);this.removeEventListener("mouseup",e,true)}function h(){if(!F)this.style.boxShadow=!m?"0 0 0 2px #fb0":"inset 0 0 20px rgba(0,127,255,.1), 0 0 1px rgba(0,127,255,.4)"}function i(a){return!isNaN(a)&&+a==parseFloat(a)}function s(){D=i(c.min)?+c.min:0;J=i(c.max)?+c.max:100;J<D&&(J=D>100?D:100);z=i(c.step)&&c.step>0?+c.step:1;K=J-D;E(true)}function E(a){!y&&!G&&(H=c.getAttribute("value"));i(H)||(H=(D+J)/2);
H=Math.round((H-D)/z)*z+D;H<D?H=D:H>J&&(H=D+~~(K/z)*z);B&&H!=C&&c.dispatchEvent(t);B=false;if(a||H!=C){C=H;j(c,{background:"-moz-element(#__sliderthumb__) "+(K?(H-D)/K*100:0)+"% no-repeat, "+o})}}var y,G,B,F,C,I,M,D,J,z,K,H=c.value;if(!l){l=document.body.appendChild(document.createElement("hr"));j(l,{"-moz-appearance":m?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"});document.mozSetImageElement("__sliderthumb__",l)}var L=
function(){return""+H};c.__defineGetter__("value",L);c.__defineSetter__("value",function Q(a){H=""+a;y=true;E();delete c.value;c.value=H;c.__defineGetter__("value",L);c.__defineSetter__("value",Q)});c.__defineGetter__("type",function(){return"range"});["min","max","step"].forEach(function(a){c.hasAttribute(a)&&(G=true);c.__defineGetter__(a,function(){return this.hasAttribute(a)?this.getAttribute(a):""});c.__defineSetter__(a,function(b){b===null?this.removeAttribute(a):this.setAttribute(a,b)})});c.readOnly=
true;j(c,q);s();(new MutationObserver(function(a){a.forEach(function(a){if(a.attributeName!="value"){s();G=true}else if(!y){H=c.getAttribute("value");E()}})})).observe(c,r);c.addEventListener("mousedown",function(c){F=true;setTimeout(function(){F=false},0);if(!c.button&&K){var h=(parseFloat(getComputedStyle(this,0).width)-a)/K;if(h){var i=c.clientX-this.getBoundingClientRect().left-a/2-(H-D)*h;if(Math.abs(i)>b){B=true;this.value=this.value- -i/h}I=H;M=c.clientX;this.addEventListener("mousemove",d,
true);this.addEventListener("mouseup",e,true)}}},true);c.addEventListener("keydown",function(a){if(a.keyCode>36&&a.keyCode<41){h.call(this);B=true;this.value=H+(a.keyCode==38||a.keyCode==39?z:-z)}},true);c.addEventListener("focus",h,true);c.addEventListener("blur",function(){this.style.boxShadow=""},true)}function j(a,b){for(var c in b)a.style.setProperty(c,b[c],"important")}c=document.createElement("input");try{c.type="range";if(c.type=="range")return}catch(i){return}c.style.background="linear-gradient(red, red)";
if(c.style.backgroundImage&&"MozAppearance"in c.style&&document.mozSetImageElement&&this.MutationObserver){var l,m=navigator.platform=="MacIntel";b=m?9:6;a=m?22:12;c=m?16:20;var o="linear-gradient(transparent "+(m?"6px, #999 6px, #999 7px, #ccc 8px, #bbb 9px, #bbb 10px, transparent 10px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)",q={"min-width":a+"px","min-height":c+"px","max-height":c+"px",padding:"0 0 "+(m?"2px":"1px"),border:0,"border-radius":0,cursor:"default","text-indent":"-999999px"},
r={attributes:true,attributeFilter:["min","max","step","value"]},s=Array.prototype.forEach,t=document.createEvent("HTMLEvents");t.initEvent("change",true,false);document.readyState=="loading"?document.addEventListener("DOMContentLoaded",d,true):d()}})();
